<!DOCTYPE html><html><head><title>Coverage</title><script>

headings = [];

onload = function(){
  headings = document.querySelectorAll('h2');
};

onscroll = function(e){
  var heading = find(window.scrollY);
  if (!heading) return;
  var links = document.querySelectorAll('#menu a')
    , link;

  for (var i = 0, len = links.length; i < len; ++i) {
    link = links[i];
    link.className = link.getAttribute('href') == '#' + heading.id
      ? 'active'
      : '';
  }
};

function find(y) {
  var i = headings.length
    , heading;

  while (i--) {
    heading = headings[i];
    if (y >= heading.offsetTop) {
      return heading;
    }
  }
}
</script>
<style>

body {
  font: 14px/1.6 "Helvetica Neue", Helvetica, Arial, sans-serif;
  margin: 0;
  color: #2C2C2C;
  border-top: 2px solid #ddd;
}

#coverage {
  padding: 60px;
}

h1 a {
  color: inherit;
  font-weight: inherit;
}

h1 a:hover {
  text-decoration: none;
}

.onload h1 {
  opacity: 1;
}

h2 {
  width: 80%;
  margin-top: 80px;
  margin-bottom: 0;
  font-weight: 100;
  letter-spacing: 1px;
  border-bottom: 1px solid #eee;
}

a {
  color: #8A6343;
  font-weight: bold;
  text-decoration: none;
}

a:hover {
  text-decoration: underline;
}

ul {
  margin-top: 20px;
  padding: 0 15px;
  width: 100%;
}

ul li {
  float: left;
  width: 40%;
  margin-top: 5px;
  margin-right: 60px;
  list-style: none;
  border-bottom: 1px solid #eee;
  padding: 5px 0;
  font-size: 12px;
}

ul::after {
  content: '.';
  height: 0;
  display: block;
  visibility: hidden;
  clear: both;
}

code {
  font: 12px monaco, monospace;
}

pre {
  margin: 30px;
  padding: 30px;
  border: 1px solid #eee;
  border-bottom-color: #ddd;
  -webkit-border-radius: 2px;
  -moz-border-radius: 2px;
  -webkit-box-shadow: inset 0 0 10px #eee;
  -moz-box-shadow: inset 0 0 10px #eee;
  overflow-x: auto;
}

img {
  margin: 30px;
  padding: 1px;
  -webkit-border-radius: 3px;
  -moz-border-radius: 3px;
  -webkit-box-shadow: 0 3px 10px #dedede, 0 1px 5px #888;
  -moz-box-shadow: 0 3px 10px #dedede, 0 1px 5px #888;
  max-width: 100%;
}

footer {
  background: #eee;
  width: 100%;
  padding: 50px 0;
  text-align: right;
  border-top: 1px solid #ddd;
}

footer span {
  display: block;
  margin-right: 30px;
  color: #888;
  font-size: 12px;
}

#menu {
  position: fixed;
  font-size: 12px;
  overflow-y: auto;
  top: 0;
  right: 0;
  margin: 0;
  height: 100%;
  padding: 15px 0;
  text-align: right;
  border-left: 1px solid #eee;
  -moz-box-shadow: 0 0 2px #888
     , inset 5px 0 20px rgba(0,0,0,.5)
     , inset 5px 0 3px rgba(0,0,0,.3);
  -webkit-box-shadow: 0 0 2px #888
     , inset 5px 0 20px rgba(0,0,0,.5)
     , inset 5px 0 3px rgba(0,0,0,.3);
  -webkit-font-smoothing: antialiased;
  background: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGYAAABmCAMAAAAOARRQAAABelBMVEUjJSU6OzshIyM5OjoqKy02NjgsLS01NTYjJCUzNTUgISMlJSc0NTUvMDA6PDwlJyg1NjYoKis2NjYrLS02ODkpKyw0NDYrLC04ODovLzA4Ojo0NDUtLy86OjwjIyU4OTosLS82ODgtLS8hIyQvMTEnKCooKSsrKy0qLCwkJSUnKCkrLCwpKiwwMjIxMzMqLC0tLS0pKissLC00NTYwMDIwMTQpKysoKSovMDEtLzA2OTkxMzUrKywvLy8qKyszNTY5OzsqKiw6OjswMDExNDUoKiozNDUvMDIyNDY1Njg2Njk5OTozMzU0NjY4ODkiIyUiIyQ4OTkuMDEmKCowMjQwMTErLS4qKywwMTMhIiMpKiopKy0tLjAkJScxNDQvLzExNDYyNDQmKCk5OTslJig5OjskJSYxMzQrLS8gISIwMTIoKCk1NTUlJSUnJygwMDA4ODgiIiMhISI8PDw6Ojo5OTkpKSojIyQ7OzsyMjIpKSssLCw6Ozw1NjlrfLakAAAg2UlEQVR42jR6i3ea6rYvPgANIAhVXh8WvkQlioUiFlFcBtAmoiRNdzxqu9p0J7vrdK29zuPeex77nnvO/35n1r1ndHRktI0jTOacv/l7lCBK5UqVpOha/YxmWK7BC4TQFKVXrbYsnimqxuuMVlOQ0XltWjUdCwRJ1M+tC1KudOs9q6+da2adUewG0SC0SwELfHtgDds93VEuydEbl3QMWeNoYkR7b/0x1ZRobGI3mLwzAhePqTAwhg6aogjNsGy7/jwQ4rkdqe7CWLxF8k9LfMVFyRS7VJqtkrW8Vt/bkR8FZJao16ipknbC3Yw2lM7laO6HBEOadEZ2tpf65c4v8e3u7FyU6qbiNNyCuzXZ6pawgnwgmrpTT/Q7w2EZmiIJ0dzWDI7mhQ80IfRnMu2kzA5r5r1pIFoia+/d93HRYp1GV8TbrkWoU/+jdI0Ff6yGwTjT1Hn8J+8m1rKpGiYPuNiHnMtNMIv+zpsk84MYTNW1/+DpwXLvckdOCMYowVNPREe0QlM8xRHXXFhcNDzupwsSmb5pH+0t0RP2Qk+QtI7F1Qm6JRC6ZPBtPq/dq/kH+jxtCljn9TIpW6rQIgmSVyj6lPICIw4N/taka41PFUInth0je9+jO6Kt1G4/a7V2LEgG02B0pHVuCZrgltSKMuIl5SyufUv9mYuQi+mFgzbBEtFo2g+Dh4sSTrLNu8JPh00sQydpb00tqXBvqRN7Q7kqzcnIxCGnvZt/WmJacoOEO6Dcn8Qre03pOCSQxbMOXUuDNx9SxuLz4W1I18gvjViQ67zV0rxdWL8Te/TQkuo8STS41DR48W7L6YP2uWIqiUV8rd6Gbf/rnegKZeG8TpAM6afhGze9JAOxbLjsnUXEbrZ9vLYd7MT32cPF5mKKxmjy7huaoD9n62GOxni3iIJwv0IzZAZjdZkUtolCNLVfYZNaquFjGszVVf+J0vrz4CawoKdHnOzb0NMH7CDBOybfYNJ4rfeMyFNjkFYVTzMFs87rnPGXLUOeNKRVc0LnU7/UIgelzsy3CMuth0YfvnY0wsD3vODUL3eJcKqHQpm8yM3XZQWJxO6Un9iYloyyLpOwN2obHy6W6gbpcb44XmyC+mg+itAcaprGcrwZCqMj/GmtKn0zPvpTz/Cv1dw21XwP3cRupg3H3MF/S71eTKj1YrdwKdc2Mw0fRmb2sFf8lW3aU6JbIZSEPqvXvjM7G/aApyXlXeqKfMq0g/Su3rUGJPSPrtGElgknrZM3xUXqsAP6zMCNVn5u8aJnSNpJv2uru7t2jfRziW2+GuhqfldUNbPk71olwo+46ePUo1U3WKk/e5YK07F/wGRgcpODmQnIlVeHCWBE4puBi2jq28UKpqiN1/4UOrGz59TNYrrQHtd+11sG40BGD+pXdelNqGOg4NXe8W4eacJV/NS9/2Umtym6WQqveqR9xdCMElpxnbkalM4Vf9uaEcWZaKdyibEIjWKxJZPN95niCL3GiaXyssIrHxoLkqkzLCXULN46/f2h3tQJgyip+Tk9EAjJ9aJshq7t8X45aowSKspMSvPf7r9R8yxNptIaHS5ozuEm6luPDApugyNP8OaqiQ4BjaequXA54SLC83eHIY2r+CZp4409Xqw8Aa2oI7XkCrQi+in0w5AqF/kLNrcUz+qkl/lAobY1jSnx5OJNhyXIz3qfNFlXc0TKaglNwdWkWYt9QQ1Kr6W8zue21iNrdJk+N5oCr2O9nEtWKC7IS5J/zdDEYrmnAYfg6agCy+qcgz7ZofeDc4PbUWSvkshWuAc7OjiUyLkj+RAtdlwXJcjxdpkTTHDhK8lBCi8+JtvDVL1W6elmOM++YS0LuSlaP1oUvAeiW3cFnvTr8EbTz1tsSMYdGeZe40sRWu5uAfj7q+ZoKv2FNQ0p5XY1lmlcigHZqTPpabufEVrNuNPi165w3uCVQJHyJqmSJ7ZHnguqwtCmwViIJijj04ba2JNYtB+yORf5gg1/9t9iw4vUpeqiunSAbf+IBdj/b+iG2qrHvuNP0Vd/+ThVZT/lrvHYjjgDbbyxaqgHNM2uhxa1GW3UedZYhMMwM4mQhltouK+IV4NdbIQNM+8Yv311RZk9kT4tiYR4LkyFcuPpdcjuhUuFqBAWRZa11lcZ3gEBlXywsNhrt+plISZP5DlsV9l4EgY6J3yZPTUcMrgaWAT3oI79eSbGEbcJpr6BD8kyDiVt+G0/hXosQN4NFXKlfWIfsIs0BHODVok1/IGnKFHJYIquh8Xo+2+bkQNTGgWmN/fZ0Y33LSj6lr1GyV7mWIKg7ZTRZPGuhF/zjRNcQ1UPtSYgnWQxSs0yrVhwNDcdGMNSNe2JT3WuzbAM3HykyAajS3Uphf6STKEqxLas9EnmnhA/lyj9Uj+JoY7SVgVmGLl46Rm2u98sbkap2lzAdKBG4r6LgulQOSSjQv1GWdQ0jtDUK/mAaqM1Uqjpu4k3Rvfvxv7YTxLSK+wN3E5jVIzmF23uZ7hiH/sVP49D7tvoKp4S8b1LuvRlivVB/algbhcFITYVXvDpLzpDfplR2uD5V4XJFxpjmIpLc9Y5sB2TpBRix7Bme6GZIq+06v3XzNeTcA4obQIKxrnT4C2JpOqD92dbmSX8MGazly5EsZVMvSU1f4RZwyu8iQXbVdeLlZrjuTT1jrY1uk5c7iZ7RsvhhluqAkq4JpVQAg7RJFtSu+xgJ8Pv6O1j5DkLxT8mkbfyRW5DrQmG7hiDIjCgBsADbjuof6YHLGeV6a5Q1Smx9joUXPpdaaDx97A/Wq00oJkdR7ZYuQRfS533JtxO1erduqWOYIt3wh0wpbLuCNIYkwxbswbikCUu2CDCS+Q+7rgVtfRcm+SOcdKPRlZ/rE7wNVUEE39KTS5uvUKN1PUnkloPkyzhyGQ8qkouEjJ3H/VXdqG6asSRiw3ecMlBvDDt8dDhBHXMwZ2Cajzjr7/76T+IavqPYvz6r7//E/3X3+N//h/0QozbjPgPiir69P/8X3/9F/yv8b/827/++98WItPu5/Hvwd8YPf5bp/2/lX/T/+Of/0MJ/lYTa+L/Ef+d9vN/3/2T6P/+jyTzu/evf6U7vxN7B6pJkRtAF6jUr8I+P8RsP/ptGhfqFk+pQ/DgAy6NJtRYJdXmp4gK7WLqLKJ+MaKhGjOojvL+SnIWrkpy0SLHDe4QuyNzaEA15mLMCcmE8Em+4HdOihW4/ZWuppJEmzeAwcDtv7MuLc9y2V5atvxXNe3S4DUMt5/Qy2LM9kSYKiVWBuKlfp4nxTntpuW03JbIlkiRvBXmT23g1I2OYe6IizUHPIq6zm6mbfsbteKmi/sg9J+ocQBMctGFO7iljo8TPN+z3jxw4do+ZwfqoR9dkNTKHyM305GpTkfhcHexVkPVGEbUOjuo9f0UMPHBFlGEx0SLvJvVRKTwW7PSew5oPme+E42+frJa9cGt2njS3dK5kIif2eYbhuSEQXEqMVfUjhGIuin0G0/W5ezJyJQy3SpMLai4M0JUWb5u1k9tny5bd1pPwYBpQuDCXZl62xg4CdVEAtflXHs6JKmP/pH6mOl796Lgopj0o8d5kKh00hxG3OSdEE/QBo9Hgr8JJqAeLDwJohG5j/DGh61Rc/+tf22/8kEnxHNCEjo0ElvvGfESZkqmz2BDcKV1H1buSkhkdg7p1IMGs2s17nYjpblrWuE2K9WEO/hcRp5e9oOF/QBmOaDtgil+oaU6szPrdwW65fOB0KUTsVUn7LFU7J8e6cxJIl9+FHw5MQMzuQJ+4oxMH3iW/5GK+hWuG0T+gTLs+fAjdtUd58TmIUq04EeyRCYCjkldow234aIgR5bqwrtZosZ+6YEqAmDqatJ9lWasz4IquKALPtd92hGI3Z2BdzzZue+REl1Om4DIWD+RrtUTOJLI+S0jHowXXdAxsGLSd40zYNuEUlOGhrwL6c7tcOtUOvpJCP7QBQS19H+GvZn05ewjlVLz+IGKoC9TyfQjLMBNmXCuqqtTdOSukZW48B0HqgSTCBrBnlFvF4CG2Su7yFzqmJFURK3UmTT3ru050r0ptUpMilYnBJWfl2Bv6kPlUuE1kxxpdzui9AubsR2N2boVSu81OulAwBqoSr1LZ0LLYOomyZHmjqnXlP72s8LnDouEJjtodBvdHaG1jMySYO7crWd90MpCRyCG14vb5IE7Arupw/y/RcCm/Tm3zK6zYj8PYNaGldiUfkB/LHWcmf2lVM+mwyU27a0qq2tscrQ/vzBjN26DnntIrOyGizzXK35yKQdYnUABkyN4saz3WD/viF+eCcsXnIajdWYJWaYHRstIis9CS+tqnFGmz2j5uzfr3Z4prqgK4XOT/PyftvjZqIm8lhkfxJ7Ol3CJF1piYBGAG8wtAk56Drw1YwmOpcz+NdfkSpSLplRXLXHL0Rquj6YW/gabqgK7Dgr6NwtH0B/AN7XrN+MVJ6AmXmUuqmQulrNNYPmH0RoDogydOKLo/QbfYNARSQQKISRCzRXU+q9WWJFL3LZW6u34CkeG97xC0NNGaJ0bvK6SnZS3zPskr5EtuCgjMWR5o2x5BqhKmDWJPRe7JMEOyRb5uUKlHaGVtq5ivSOaSliSXp9SQm2qk8MRJh10MAp9QQ2H5t59J8rjiwSZtoIfMGjlLPVNdYl/LBR0AO6WLGDmkLkIPRE45Y9MftdAK/yNu1Hn6tzOQTesgQ+8fSzB19wO91vCnO23vOWQdwJ63SJrYjdfKFW6W281PKs2k8iT9ai1cgJ4sa3xqdvmtxR8/+D1B8AKc2u+6JftryRhMWSQtoSBgIyyQGyxcnELuAasXN12oSriU4RMz1DD6RL0TSV+om7i1Yt+jEE/jnawM8cX/UhN4nkiv/w9eALrzNhXuQfOzFL0Fi6SjF7/4Qn8rLYBoa85cvgAnkCEBP+HPbEnquVXCZsMS/yzYw2Vru60P/+nJPYKkzZFjmbykzUoEqV836T5q3fP/L383dF82tx18/AZgZczMAgyeWYKmSZIqtHL+e+O4ZRcq9VI3g/qPeCoiK4pcgEqdbS0S/Be54sbVQOuJVPNBblIghzeasNu7h/g+Sz1IdhI5lCwq1nUb3Ji4OCIcqQZqtqJ5w7rXrg/DA9IgVmEGhDgGecEwnCTHffXcXs0V3OCEVzYDKS1vp/oX+ng+6XVU86UjA6FMO2RXOOOrqY1GgPvrAk9HV/BXtCu5RuwF8qgdGDLsBcui4E33ymdBip1X8uKyhIWT8qNRDsXz+gvO9UiEC0d8RG4Tf2x8H4slljgHtCBcxHLTWOYJm5H/fCPCzOgf9qgOUxTRZ0Pc6ha5yLuLVT9ntvIa6gacE99mCovdUumTQdRP4RPsS9129eEe2uSvvGh0bV4Y3QPPhPZMqhZWSMa5R0Hc1SGO4IVOQc0FrirlibTVfKRrYkD8kz3b+X65/QkUNaZdrdl3mCap0Hf3YcCw/LiouJYNbqz88UqeDYv93yO7vvXtgl4XCyAO4ODkY6W+83+LZU//p3/zXNGGrUKClCiOnL27iJZbNWDF02XXAOeFlB7IaADoMH1Yqr+UP9biyZDEa/iJt4MDeIz6GKTdLVBfWGVtRN4fdT2rgReX8UXwF2zOrradm4J0nyTgdPnai3RvzpZvCKDUqjOwD/QA6EDaMCLewX6QWYVnHY1sx1bd8ovYnPm1ZvPH+rE20lWjOCnZ66/xDt0QAl15FjfBcZp+i9OU0RNPQ0t3x2pSNWo8eiYudwsnuP1Hq6iH1LJCJynkYsfgJ0p3pF6SoQk2l+jqE8CPk+ziGJRSKjs+W5AO185umPdkYzlK4wl7TC9NxyyDP7ZoyYVoXiuS6SjnInlLWrwz1i8bGTKXX0AVQWkSfIlglW3zRJRJ8bg5VgE6ZEnqNu9B++0GNQvDQJvFize4ESNKBJP+8vA3LM4AX5SIBq08Mob+7QMTCZx4nwP/64+4BnlZC+8WtlP/CXw6t1PwMwkJ3jhP1FiXLhDF/3I6FGUzO2DSi9ABxKyyL9paZxSEz40ZCPQToDAJu1959k7QdbVxgB4icsu2s4zsTPJhcEDo+N1GX4zSk/wriRh8AqwL62972i9HJHd1ydaLXVzvKvOfGGw5RVcUVMiKXFH4APdkQU/dc5BX0YfKTNZYXCW9mb8bc8mufoQP6BbdQmT99ZjoYfr/go4TgQX9IDgztim7wyFeGMfbNaeqj8Dzs38pgcqwSv2hbqB3oSGKWKy+sesY7p57wAHldqE6NDudk/W7s/zjrK4rZFlFvaGxnSZdHbc1y47qDN6xkoK8O3bfr2j41dlJZ71rB4dlDqapPFa8N6xBrprUdtenUCHwxKNhw1uuTBh+9uU45k4REpQABN2bAO9DSLqoIL26gNroWgup5pUMxHUNSq4Gyz47vBPvilpo5f9OYI2ddAqTqmnxXERxQJ3UK8fHbVE9HagHi3+tqNRoNsArdmAxHA5LwtQo9ZAaNKUTljnokljo2x8scqVpEEIPc01fPCdHOCg0DeWBz8D5TVAAfx8aRH5X2ZYNI3ebKDZdeJ+oBDAxmRqJ30Eh2/DaeAy5diVNMpEDmXiPDsGTzBLXy8eVDdJoIafgx/gxMyQi454QrW56nCyeELgSuNNEmYkflF+t3CZQOVRWjKhIuCclmQSlAXT3+4JGG75B4t/5hQ+ldMP4LsAW6z3XmU6IJJwpnGVnsgUZhoY1fZlwTR8wSU7xRejf2uCx9Z5trVTRRJP9KnEb134dEieil6eCOGWgboI7xsqsqM99jfJLTePjygKlH2CVxxsse9QRzTBFjD/Kjqitr/CCTBt/SJ6nLxz7cKP9pFqBpp0lN5y+adKNsZjrPuroemZauH9aTTFD3EKHW8S55XBLFQAt1jgxTQCTwxmx/JyfsZDN1RroN3VaxpSenpIX7K+ZbL8VdlQDcI4Cbzg3QJLa9yVqNxUelu+EtxLVqeekaAvSJkO6sSVqbUajxqhKshNpvZqoeApF0k/0P0ikkwUcbdwc4A1ejN7Oo0O15kG7hTMoK3hZRBCX7YYeLW0wvcXx/18n/u37yLgzBYVBUvORGli+sfRcX/74uD6P4hq+7xu54TlWJLFzT63uwUDwuEDdOjJQqx7JV+ZjaEAPi7t0MMrR4Q8Rkf18uxD6RK0RKh0hL8YU+DeL97i4pa5ZSyAfXKwZRS/8gXcxdZXm62RBDj8U3sN8x95b5PpPs/mCBKYvpaA50pN5Ct/499AFTtwQ5vgeSh+NHrKIi4NVpwM/XzRaNfJD856lPE6M21zWPguFsH7jbLVyEDfRmt4VwrhCJ5VTYmcSPfGgO5clfN+vbaDZ7sakU5+2vZ2WCDY031NxJarVytfDDVtiafcTGO2rJ/taoL3zChN2qmjxofczTOYQPPVQPh0JVtYgdUQINcSiNEEy58UdYXX1MpWUCEBx7LbcGtAm8XWRQTVOaoV3ySri4RShhs/B/0m4jX6OAwXOvcA09bNSG4czEGv/Wey6V/jbTCNTW6awXdNTcA1GsPe1E9fZdGl7R0vyoVpIdJtfC6d32NNErrvq/R+d65VG+YOwRXppXxOCYyGNSf1K3x6VxAW/vtz4EC1SgCOSPdN62sLsoIzuDfg8GwZAbquVO8HIuFP/ToVoeUB7nnwMF35a1wK1tI6fkrqFKhQdeJpwyls0pIy8AZde3/6LUUbFaYJthyUJSU/kqDXTLQElnn0Jr4B2RVghNrmNmoEn7pXIeshPguXVsvwoTdmClq49JJU3LWhHyWTrJL9bRP6VKv3tZoA/th77p5Jw++OEENvyvWy/pNeExiDUVQaXIRGh8xySZTI36yueFaSXo1uJY0RnXYgEOoWWOJHeaVuX/bGNhHsh2yinznl/++NJcE9j6fBPRcBdq9hb8awNw8U7Bl6GM7x69EDOIIbX/npZ++amlHR9L/35mE/2Ss4gb0xCcY4VyTFLRE796vHysLAamqcyO+aFQyJIDBNslbH2/MrAvZiSEIedc/cqjmv4fbda2pXbv+F5a2szSsdkm9noiNURXt8edUhGUF6fSZWd1IJaXKFwD+49R6eCXD4Bkef7j9tRtNMVgW8BhRz/Qpy1TmeYk0doyjZoJSbePOReVHgkFsCFuQJ+Lgc4BxeAsK/cOiNDRmdNw0ctYhn/nQ498dYI5znzGLoJi1rav7Cn88rL3wLePVtDK5gl77Tki3gHEsIAQ2+IKgarj7Y8W1IQzV5V9N+0TjLqbg68WfKcOmBCOj3JkwJhVIkwDhc+JorXuZEPMEh0vvH3x7iqf+VAwXgd4diZiaJD1zHL9Snx6Wfg4IugreyhabQkcir+y5XgDtdx3Avs7lkeeCBwDvZoTUCXx5QrZkcEqWfYEiEYRs/EphmRALSNGR1Iclgdr5VFoELpzF4++f35w3/j0t5ucW3n2ch4PQCLuUXupsPRR7UA5FjSKrMtPcKAZJfagO4lGE7FH3YKMjorpK0ZxAv+i2JkJhtAMWWWFej4RhPR/cJ3DxwocCvXDi4SGZU4cu+K32XndiFWgopAl+0GApcwf1XvymJcFs39jExIBO4yUjU9MExBLQYc9H+W7+IgdESPRpciT+rKZPebVtaVq+1GYO/5xTAL3HASjNTGIgMvdjWbgc7JvdE1zIFpuC0U9ESiZyzBixzxWxj4Kwh8My34q+FK3KNLtmsA1qyrmKSNQOXCPUZd+ONelBTvFoUI/CYsqa/RhtKiyMf2CgSFqEPk59Y3uqnlZ8gFpswfSYyko23yVZYxzKGxGm49Zqxg1l8oz5Ra9XaRwHkuxepmgyhm0SoNy2KlbcEqK+9QqS9PNx9Ihm9U7gsR55SSJ1FBDNnkuWKxIZ0SDpXuOGwZdoUbOMDPHP4vBAgz2VlSEJAHZGJVbYIg7l/FO5KfIVvxC8pPPxMGcNMoevFDeStt2iqztE10n2TA4dgJH76YS9HDhKHD3iCx6ieFX84BAI3QQnngh76f5ruPQVbr5qZmck/5UjDc26lfrOvUBWy0Ogl8bCoOkMOns81TnC3cuUS9KW8+9A+fe3XYZOFUPG1u5epSSmDLw0s5s2F0W30ANeo+zJkJQz9SPZgzwYpEoktofhGVfmLOAB20boCbW1QWq/NpET/hnMecw/uSyAH4NJc3ECOU4nnkK1fj3S/i5dwb3R7k00AqQQUwt7Ie1qV0aY/VQX0J8hLPy7eBNXMHYZYDNxHZ2Qh6AuXJxq+AeRec/Q+JLhZV6hpXwQEzw7bf5v9uUf2vpq3qlhmy0IIGTkwYdCfSAFmqbdo+3XvDTDjFJde0mbeQLcn2n31xaAqJ0ixO/CLsT4I4G4DoncVTgRGNBtsCcjISWT+oeXZ4Iedw/8OsJI1aPnNKLX/60VvcZb94uasRxCkqlPQ11u1Sa2hHvB80WQENxVyzjns0/PiEByyil21Te6oisk3mNCEMrhouCFO3yEZTHHOCMy9eb/4Tmi8cVf3Lf7P53SY2hX3PSN033As3ETIMLHWumWEO9JXHA2y2SIBlIPpLGG2qvNsCIlIr+B1SWAqRKm2w6Blf7U+zCSBwJrfHG5i8J5Gax/cVonMlon7aHJX/gSvucIncRP93XCqkv7D8IFKFsLiBgHqUpXhE3pYjEcV1dk/JD9zFVCfEaQIVX8Jmfz7IIofcBKQ4OaG+C3xC2veX9CD+iAFXDNaGg9eTVxvkbJRJlW4Nk9Wk13kn696jWppRDe/8pDrYMO9ZyxZ98ReKSz9kWKLLyk2zCZgAniCkLJVX3n1M9DYbomyahWiv/KixRIV9hj/oFz87I+HLznbPTjpa+D+bZQnMuRsljTpv90vQUt/pK7jCFnA30B/jtroSF2/m/gpWn1aQs5WeA6ghzF8SdqWI20fghdSeDOCSCmLgTkfaGgGDmw7nHFkRzGtag57IHS2na06I+gzEphXo1w/Zx2BM/jKL2nZoFjHggtFQjYi8nSVRSXIE58RPbBObXk7uuIL9+rs/5Zo7suJInEUxgsiZZAWS25iBtpEiZeBgDtghEoAE0sjcayNq85M4tbu/LF5h51335PsGzQ09O875+vUS89lkWMyNOFoip2PuyWyMP/iU2XIZdfCCJNDjebDoBLQdpy7QQZC7s9c0wjHJervQNDu2jWzBW5MSAJMr7bP+Iv92BkS/GGgzjEn7MF1IRKFwwzbjbS4/slGOmhx9cZrFu7HSEefojNv3r0UaKfKOWzXsq1zEugbzlMDFsacRJJI/iJlK3vtkZ+PLZIVMFlKA32wbq2Kd5T0uCLZ1CPkAfCdzkz2EYscjDcZq2AWfziN2covN4kXE1lQXPPLTNM1xx3tbiepcO/t3SWm4w87qfh99SL0ZnY+LKFPLPeXVM2mIIoVWt+9Nk0I7nY4O79iGYqxZ8RVz289an6NVdJWnSKZvJQCAuHNiVaDxPAFoH392t9wot5t0/qmU95eEWNbU2udUW5sN9JVqcYlvAIfLeYC33oUzzxZgSktsv21mA7Uly1FA5VnoJFh6N244Wmv3YJGFv/TCPryaw+ZORlpZjQdq/2DYXr3EZskfed0G61P09ipTKmlTQ1067Rg5+PAk5FlQ9e0SWbGf2B/08kqymOTMVOznsALHHNFH4LFRKl2F/NOiYFl9khNHnSu9Ak5sq26Ynl/i2fdTle29Y1ugqmR5Yj4YT9pvslFyYCbw0mNFr5rVQm1LvkG27QMq9ph3t8fmn6r6SQ4oSbr5tz+J1kIawGzDxb6VYOvvWhobDTXfBeNv3b4aNm5XUinsCGqG2q/45m3+LoCOsddFceYhRx1Tsss9PLdPfJdErFMjYd3gddjiP0+XQjcRadZP6bwNLySvunFf20Czy6JqdEW2a96KxdYdOryBv1BjbuUq2yCHeh+6sk7fGmmPi50pe/1l5TyPe5oHW9oPnhPswLyf2TFDdCyYlhwBCstv5C1HwlW7xWoGT9XZt4qVj5WryLPLLD6h/5cMLEjWzgCeAIKNsLak92aBqBsHl4AJwl2N4jfvbSkBExGimv0nFvv09uDScQbjx+w4kPQjgjlW+g9ws9VEJvI2k8N6XxVu0uIwovgTFdunG24gBtaDi+y1YLQwZ8mwbip5fVlO3k0n0AEr/ETbtu8Vjkm+nNSiEb7X/3fMjBL5A8PdgG+/FnbexbFFExmEfetXAnisEKy5z44WVPpQZjSy/jzeGn4yDRsFGqhh87QPaDBWhlo37IFbe/C0xynS91d2tP/AJoJS0sVF6iwAAAAAElFTkSuQmCC");
}

#menu::after {
  display: block;
  content: '';
  padding-top: 80px;
}

#logo {
  position: fixed;
  bottom: 10px;
  right: 10px;
  background: rgba(255,255,255,.1);
  font-size: 11px;
  display: block;
  width: 20px;
  height: 20px;
  line-height: 20px;
  text-align: center;
  -webkit-border-radius: 20px;
  -moz-border-radius: 20px;
  -webkit-box-shadow: 0 0 3px rgba(0,0,0,.2);
  -moz-box-shadow: 0 0 3px rgba(0,0,0,.2);
  color: inherit;
}

#menu li a {
  display: block;
  color: white;
  padding: 0 35px 0 25px;
  -webkit-transition: background 300ms;
  -moz-transition: background 300ms;
}

#menu li {
  position: relative;
  list-style: none;
}

#menu a:hover,
#menu a.active {
  text-decoration: none;
  background: rgba(255,255,255,.1);
}

#menu li:hover .cov {
  opacity: 1;
}

#menu li .dirname {
  opacity: .60;
  padding-right: 2px;
}

#menu li .basename {
  opacity: 1;
}

#menu .cov {
  background: rgba(0,0,0,.4);
  position: absolute;
  top: 0;
  right: 8px;
  font-size: 9px;
  opacity: .6;
  text-align: left;
  width: 17px;
  -webkit-border-radius: 10px;
  -moz-border-radius: 10px;
  padding: 2px 3px;
  text-align: center;
}

#stats:nth-child(2n) {
  display: inline-block;
  margin-top: 15px;
  border: 1px solid #eee;
  padding: 10px;
  -webkit-box-shadow: inset 0 0 2px #eee;
  -moz-box-shadow: inset 0 0 2px #eee;
  -webkit-border-radius: 5px;
  -moz-border-radius: 5px;
}

#stats div {
  float: left;
  padding: 0 5px;
}

#stats::after {
  display: block;
  content: '';
  clear: both;
}

#stats .sloc::after {
  content: ' SLOC';
  color: #b6b6b6;
}

#stats .percentage::after {
  content: ' coverage';
  color: #b6b6b6;
}

#stats .hits,
#stats .misses {
  display: none;
}

.high {
  color: #00d4b4;
}
.medium {
  color: #e87d0d;
}
.low {
  color: #d4081a;
}
.terrible {
  color: #d4081a;
  font-weight: bold;
}

table {
  width: 80%;
  margin-top: 10px;
  border-collapse: collapse;
  border: 1px solid #cbcbcb;
  color: #363636;
  -webkit-border-radius: 3px;
  -moz-border-radius: 3px;
}

table thead {
  display: none;
}

table td.line,
table td.hits {
  width: 20px;
  background: #eaeaea;
  text-align: center;
  font-size: 11px;
  padding: 0 10px;
  color: #949494;
}

table td.hits {
  width: 10px;
  padding: 2px 5px;
  color: rgba(0,0,0,.2);
  background: #f0f0f0;
}

tr.miss td.line,
tr.miss td.hits {
  background: #e6c3c7;
}

tr.miss td {
  background: #f8d5d8;
}

td.source {
  padding-left: 15px;
  line-height: 15px;
  white-space: pre;
  font: 12px monaco, monospace;
}

code .comment { color: #ddd }
code .init { color: #2F6FAD }
code .string { color: #5890AD }
code .keyword { color: #8A6343 }
code .number { color: #2F6FAD }
</style></head><body><div id="coverage"><h1 id="overview">Coverage</h1><div id="menu"><li><a href="#overview">overview</a></li><li><span class="cov high">100</span><a href="#/lib/dateformatter.js"><span class="dirname">/lib/</span><span class="basename">dateformatter.js</span></a></li><li><span class="cov high">99</span><a href="#/lib/filters.js"><span class="dirname">/lib/</span><span class="basename">filters.js</span></a></li><li><span class="cov high">96</span><a href="#/lib/lexer.js"><span class="dirname">/lib/</span><span class="basename">lexer.js</span></a></li><li><span class="cov high">94</span><a href="#/lib/loaders/filesystem.js"><span class="dirname">/lib/loaders/</span><span class="basename">filesystem.js</span></a></li><li><span class="cov high">100</span><a href="#/lib/loaders/index.js"><span class="dirname">/lib/loaders/</span><span class="basename">index.js</span></a></li><li><span class="cov high">100</span><a href="#/lib/loaders/memory.js"><span class="dirname">/lib/loaders/</span><span class="basename">memory.js</span></a></li><li><span class="cov high">99</span><a href="#/lib/parser.js"><span class="dirname">/lib/</span><span class="basename">parser.js</span></a></li><li><span class="cov high">99</span><a href="#/lib/swig.js"><span class="dirname">/lib/</span><span class="basename">swig.js</span></a></li><li><span class="cov high">100</span><a href="#/lib/tags/autoescape.js"><span class="dirname">/lib/tags/</span><span class="basename">autoescape.js</span></a></li><li><span class="cov high">100</span><a href="#/lib/tags/block.js"><span class="dirname">/lib/tags/</span><span class="basename">block.js</span></a></li><li><span class="cov high">100</span><a href="#/lib/tags/else.js"><span class="dirname">/lib/tags/</span><span class="basename">else.js</span></a></li><li><span class="cov high">100</span><a href="#/lib/tags/elseif.js"><span class="dirname">/lib/tags/</span><span class="basename">elseif.js</span></a></li><li><span class="cov high">100</span><a href="#/lib/tags/extends.js"><span class="dirname">/lib/tags/</span><span class="basename">extends.js</span></a></li><li><span class="cov high">100</span><a href="#/lib/tags/filter.js"><span class="dirname">/lib/tags/</span><span class="basename">filter.js</span></a></li><li><span class="cov high">100</span><a href="#/lib/tags/for.js"><span class="dirname">/lib/tags/</span><span class="basename">for.js</span></a></li><li><span class="cov high">100</span><a href="#/lib/tags/if.js"><span class="dirname">/lib/tags/</span><span class="basename">if.js</span></a></li><li><span class="cov high">100</span><a href="#/lib/tags/import.js"><span class="dirname">/lib/tags/</span><span class="basename">import.js</span></a></li><li><span class="cov high">100</span><a href="#/lib/tags/include.js"><span class="dirname">/lib/tags/</span><span class="basename">include.js</span></a></li><li><span class="cov high">100</span><a href="#/lib/tags/index.js"><span class="dirname">/lib/tags/</span><span class="basename">index.js</span></a></li><li><span class="cov high">100</span><a href="#/lib/tags/macro.js"><span class="dirname">/lib/tags/</span><span class="basename">macro.js</span></a></li><li><span class="cov high">94</span><a href="#/lib/tags/parent.js"><span class="dirname">/lib/tags/</span><span class="basename">parent.js</span></a></li><li><span class="cov high">100</span><a href="#/lib/tags/raw.js"><span class="dirname">/lib/tags/</span><span class="basename">raw.js</span></a></li><li><span class="cov high">97</span><a href="#/lib/tags/set.js"><span class="dirname">/lib/tags/</span><span class="basename">set.js</span></a></li><li><span class="cov high">100</span><a href="#/lib/tags/spaceless.js"><span class="dirname">/lib/tags/</span><span class="basename">spaceless.js</span></a></li><li><span class="cov high">83</span><a href="#/lib/utils.js"><span class="dirname">/lib/</span><span class="basename">utils.js</span></a></li><a id="logo" href="http://visionmedia.github.io/mocha/">m</a></div><div id="stats" class="high"><div class="percentage">98%</div><div class="sloc">1202</div><div class="hits">1184</div><div class="misses">18</div></div><div id="files"><div class="file"><h2 id="/lib/dateformatter.js">/lib/dateformatter.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">105</div><div class="hits">105</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr class="hit"><td class="line">1</td><td class="hits">1</td><td class="source">var utils = require('./utils');</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">3</td><td class="hits">1</td><td class="source">var _months = {</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source">    full: ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'],</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source">    abbr: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec']</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source">  _days = {</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source">    full: ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'],</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source">    abbr: ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'],</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source">    alt: {'-1': 'Yesterday', 0: 'Today', 1: 'Tomorrow'}</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source">  };</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source">/*</td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source">DateZ is licensed under the MIT License:</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source">Copyright (c) 2011 Tomo Universalis (http://tomouniversalis.com)</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source">Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the &quot;Software&quot;), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source">The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source">*/</td></tr><tr class="hit"><td class="line">20</td><td class="hits">1</td><td class="source">exports.tzOffset = 0;</td></tr><tr class="hit"><td class="line">21</td><td class="hits">1</td><td class="source">exports.DateZ = function () {</td></tr><tr class="hit"><td class="line">22</td><td class="hits">64</td><td class="source">  var members = {</td></tr><tr><td class="line">23</td><td class="hits"></td><td class="source">      'default': ['getUTCDate', 'getUTCDay', 'getUTCFullYear', 'getUTCHours', 'getUTCMilliseconds', 'getUTCMinutes', 'getUTCMonth', 'getUTCSeconds', 'toISOString', 'toGMTString', 'toUTCString', 'valueOf', 'getTime'],</td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source">      z: ['getDate', 'getDay', 'getFullYear', 'getHours', 'getMilliseconds', 'getMinutes', 'getMonth', 'getSeconds', 'getYear', 'toDateString', 'toLocaleDateString', 'toLocaleTimeString']</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source">    },</td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source">    d = this;</td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">28</td><td class="hits">64</td><td class="source">  d.date = d.dateZ = (arguments.length &gt; 1) ? new Date(Date.UTC.apply(Date, arguments) + ((new Date()).getTimezoneOffset() * 60000)) : (arguments.length === 1) ? new Date(new Date(arguments['0'])) : new Date();</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">30</td><td class="hits">64</td><td class="source">  d.timezoneOffset = d.dateZ.getTimezoneOffset();</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">32</td><td class="hits">64</td><td class="source">  utils.each(members.z, function (name) {</td></tr><tr class="hit"><td class="line">33</td><td class="hits">768</td><td class="source">    d[name] = function () {</td></tr><tr class="hit"><td class="line">34</td><td class="hits">70</td><td class="source">      return d.dateZ[name]();</td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source">    };</td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source">  });</td></tr><tr class="hit"><td class="line">37</td><td class="hits">64</td><td class="source">  utils.each(members['default'], function (name) {</td></tr><tr class="hit"><td class="line">38</td><td class="hits">832</td><td class="source">    d[name] = function () {</td></tr><tr class="hit"><td class="line">39</td><td class="hits">15</td><td class="source">      return d.date[name]();</td></tr><tr><td class="line">40</td><td class="hits"></td><td class="source">    };</td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source">  });</td></tr><tr><td class="line">42</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">43</td><td class="hits">64</td><td class="source">  this.setTimezoneOffset(exports.tzOffset);</td></tr><tr><td class="line">44</td><td class="hits"></td><td class="source">};</td></tr><tr class="hit"><td class="line">45</td><td class="hits">1</td><td class="source">exports.DateZ.prototype = {</td></tr><tr><td class="line">46</td><td class="hits"></td><td class="source">  getTimezoneOffset: function () {</td></tr><tr class="hit"><td class="line">47</td><td class="hits">4</td><td class="source">    return this.timezoneOffset;</td></tr><tr><td class="line">48</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">49</td><td class="hits"></td><td class="source">  setTimezoneOffset: function (offset) {</td></tr><tr class="hit"><td class="line">50</td><td class="hits">127</td><td class="source">    this.timezoneOffset = offset;</td></tr><tr class="hit"><td class="line">51</td><td class="hits">127</td><td class="source">    this.dateZ = new Date(this.date.getTime() + this.date.getTimezoneOffset() * 60000 - this.timezoneOffset * 60000);</td></tr><tr class="hit"><td class="line">52</td><td class="hits">127</td><td class="source">    return this;</td></tr><tr><td class="line">53</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">54</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">55</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">56</td><td class="hits"></td><td class="source">// Day</td></tr><tr class="hit"><td class="line">57</td><td class="hits">1</td><td class="source">exports.d = function (input) {</td></tr><tr class="hit"><td class="line">58</td><td class="hits">3</td><td class="source">  return (input.getDate() &lt; 10 ? '0' : '') + input.getDate();</td></tr><tr><td class="line">59</td><td class="hits"></td><td class="source">};</td></tr><tr class="hit"><td class="line">60</td><td class="hits">1</td><td class="source">exports.D = function (input) {</td></tr><tr class="hit"><td class="line">61</td><td class="hits">2</td><td class="source">  return _days.abbr[input.getDay()];</td></tr><tr><td class="line">62</td><td class="hits"></td><td class="source">};</td></tr><tr class="hit"><td class="line">63</td><td class="hits">1</td><td class="source">exports.j = function (input) {</td></tr><tr class="hit"><td class="line">64</td><td class="hits">2</td><td class="source">  return input.getDate();</td></tr><tr><td class="line">65</td><td class="hits"></td><td class="source">};</td></tr><tr class="hit"><td class="line">66</td><td class="hits">1</td><td class="source">exports.l = function (input) {</td></tr><tr class="hit"><td class="line">67</td><td class="hits">1</td><td class="source">  return _days.full[input.getDay()];</td></tr><tr><td class="line">68</td><td class="hits"></td><td class="source">};</td></tr><tr class="hit"><td class="line">69</td><td class="hits">1</td><td class="source">exports.N = function (input) {</td></tr><tr class="hit"><td class="line">70</td><td class="hits">2</td><td class="source">  var d = input.getDay();</td></tr><tr class="hit"><td class="line">71</td><td class="hits">2</td><td class="source">  return (d &gt;= 1) ? d : 7;</td></tr><tr><td class="line">72</td><td class="hits"></td><td class="source">};</td></tr><tr class="hit"><td class="line">73</td><td class="hits">1</td><td class="source">exports.S = function (input) {</td></tr><tr class="hit"><td class="line">74</td><td class="hits">13</td><td class="source">  var d = input.getDate();</td></tr><tr class="hit"><td class="line">75</td><td class="hits">13</td><td class="source">  return (d % 10 === 1 &amp;&amp; d !== 11 ? 'st' : (d % 10 === 2 &amp;&amp; d !== 12 ? 'nd' : (d % 10 === 3 &amp;&amp; d !== 13 ? 'rd' : 'th')));</td></tr><tr><td class="line">76</td><td class="hits"></td><td class="source">};</td></tr><tr class="hit"><td class="line">77</td><td class="hits">1</td><td class="source">exports.w = function (input) {</td></tr><tr class="hit"><td class="line">78</td><td class="hits">1</td><td class="source">  return input.getDay();</td></tr><tr><td class="line">79</td><td class="hits"></td><td class="source">};</td></tr><tr class="hit"><td class="line">80</td><td class="hits">1</td><td class="source">exports.z = function (input, offset, abbr) {</td></tr><tr class="hit"><td class="line">81</td><td class="hits">3</td><td class="source">  var year = input.getFullYear(),</td></tr><tr><td class="line">82</td><td class="hits"></td><td class="source">    e = new exports.DateZ(year, input.getMonth(), input.getDate(), 12, 0, 0),</td></tr><tr><td class="line">83</td><td class="hits"></td><td class="source">    d = new exports.DateZ(year, 0, 1, 12, 0, 0);</td></tr><tr><td class="line">84</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">85</td><td class="hits">3</td><td class="source">  e.setTimezoneOffset(offset, abbr);</td></tr><tr class="hit"><td class="line">86</td><td class="hits">3</td><td class="source">  d.setTimezoneOffset(offset, abbr);</td></tr><tr class="hit"><td class="line">87</td><td class="hits">3</td><td class="source">  return Math.round((e - d) / 86400000);</td></tr><tr><td class="line">88</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">89</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">90</td><td class="hits"></td><td class="source">// Week</td></tr><tr class="hit"><td class="line">91</td><td class="hits">1</td><td class="source">exports.W = function (input) {</td></tr><tr class="hit"><td class="line">92</td><td class="hits">1</td><td class="source">  var target = new Date(input.valueOf()),</td></tr><tr><td class="line">93</td><td class="hits"></td><td class="source">    dayNr = (input.getDay() + 6) % 7,</td></tr><tr><td class="line">94</td><td class="hits"></td><td class="source">    fThurs;</td></tr><tr><td class="line">95</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">96</td><td class="hits">1</td><td class="source">  target.setDate(target.getDate() - dayNr + 3);</td></tr><tr class="hit"><td class="line">97</td><td class="hits">1</td><td class="source">  fThurs = target.valueOf();</td></tr><tr class="hit"><td class="line">98</td><td class="hits">1</td><td class="source">  target.setMonth(0, 1);</td></tr><tr class="hit"><td class="line">99</td><td class="hits">1</td><td class="source">  if (target.getDay() !== 4) {</td></tr><tr class="hit"><td class="line">100</td><td class="hits">1</td><td class="source">    target.setMonth(0, 1 + ((4 - target.getDay()) + 7) % 7);</td></tr><tr><td class="line">101</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">102</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">103</td><td class="hits">1</td><td class="source">  return 1 + Math.ceil((fThurs - target) / 604800000);</td></tr><tr><td class="line">104</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">105</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">106</td><td class="hits"></td><td class="source">// Month</td></tr><tr class="hit"><td class="line">107</td><td class="hits">1</td><td class="source">exports.F = function (input) {</td></tr><tr class="hit"><td class="line">108</td><td class="hits">2</td><td class="source">  return _months.full[input.getMonth()];</td></tr><tr><td class="line">109</td><td class="hits"></td><td class="source">};</td></tr><tr class="hit"><td class="line">110</td><td class="hits">1</td><td class="source">exports.m = function (input) {</td></tr><tr class="hit"><td class="line">111</td><td class="hits">3</td><td class="source">  return (input.getMonth() &lt; 9 ? '0' : '') + (input.getMonth() + 1);</td></tr><tr><td class="line">112</td><td class="hits"></td><td class="source">};</td></tr><tr class="hit"><td class="line">113</td><td class="hits">1</td><td class="source">exports.M = function (input) {</td></tr><tr class="hit"><td class="line">114</td><td class="hits">1</td><td class="source">  return _months.abbr[input.getMonth()];</td></tr><tr><td class="line">115</td><td class="hits"></td><td class="source">};</td></tr><tr class="hit"><td class="line">116</td><td class="hits">1</td><td class="source">exports.n = function (input) {</td></tr><tr class="hit"><td class="line">117</td><td class="hits">1</td><td class="source">  return input.getMonth() + 1;</td></tr><tr><td class="line">118</td><td class="hits"></td><td class="source">};</td></tr><tr class="hit"><td class="line">119</td><td class="hits">1</td><td class="source">exports.t = function (input) {</td></tr><tr class="hit"><td class="line">120</td><td class="hits">1</td><td class="source">  return 32 - (new Date(input.getFullYear(), input.getMonth(), 32).getDate());</td></tr><tr><td class="line">121</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">122</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">123</td><td class="hits"></td><td class="source">// Year</td></tr><tr class="hit"><td class="line">124</td><td class="hits">1</td><td class="source">exports.L = function (input) {</td></tr><tr class="hit"><td class="line">125</td><td class="hits">2</td><td class="source">  return new Date(input.getFullYear(), 1, 29).getDate() === 29;</td></tr><tr><td class="line">126</td><td class="hits"></td><td class="source">};</td></tr><tr class="hit"><td class="line">127</td><td class="hits">1</td><td class="source">exports.o = function (input) {</td></tr><tr class="hit"><td class="line">128</td><td class="hits">2</td><td class="source">  var target = new Date(input.valueOf());</td></tr><tr class="hit"><td class="line">129</td><td class="hits">2</td><td class="source">  target.setDate(target.getDate() - ((input.getDay() + 6) % 7) + 3);</td></tr><tr class="hit"><td class="line">130</td><td class="hits">2</td><td class="source">  return target.getFullYear();</td></tr><tr><td class="line">131</td><td class="hits"></td><td class="source">};</td></tr><tr class="hit"><td class="line">132</td><td class="hits">1</td><td class="source">exports.Y = function (input) {</td></tr><tr class="hit"><td class="line">133</td><td class="hits">3</td><td class="source">  return input.getFullYear();</td></tr><tr><td class="line">134</td><td class="hits"></td><td class="source">};</td></tr><tr class="hit"><td class="line">135</td><td class="hits">1</td><td class="source">exports.y = function (input) {</td></tr><tr class="hit"><td class="line">136</td><td class="hits">1</td><td class="source">  return (input.getFullYear().toString()).substr(2);</td></tr><tr><td class="line">137</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">138</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">139</td><td class="hits"></td><td class="source">// Time</td></tr><tr class="hit"><td class="line">140</td><td class="hits">1</td><td class="source">exports.a = function (input) {</td></tr><tr class="hit"><td class="line">141</td><td class="hits">2</td><td class="source">  return input.getHours() &lt; 12 ? 'am' : 'pm';</td></tr><tr><td class="line">142</td><td class="hits"></td><td class="source">};</td></tr><tr class="hit"><td class="line">143</td><td class="hits">1</td><td class="source">exports.A = function (input) {</td></tr><tr class="hit"><td class="line">144</td><td class="hits">1</td><td class="source">  return input.getHours() &lt; 12 ? 'AM' : 'PM';</td></tr><tr><td class="line">145</td><td class="hits"></td><td class="source">};</td></tr><tr class="hit"><td class="line">146</td><td class="hits">1</td><td class="source">exports.B = function (input) {</td></tr><tr class="hit"><td class="line">147</td><td class="hits">1</td><td class="source">  var hours = input.getUTCHours(), beats;</td></tr><tr class="hit"><td class="line">148</td><td class="hits">1</td><td class="source">  hours = (hours === 23) ? 0 : hours + 1;</td></tr><tr class="hit"><td class="line">149</td><td class="hits">1</td><td class="source">  beats = Math.abs(((((hours * 60) + input.getUTCMinutes()) * 60) + input.getUTCSeconds()) / 86.4).toFixed(0);</td></tr><tr class="hit"><td class="line">150</td><td class="hits">1</td><td class="source">  return ('000'.concat(beats).slice(beats.length));</td></tr><tr><td class="line">151</td><td class="hits"></td><td class="source">};</td></tr><tr class="hit"><td class="line">152</td><td class="hits">1</td><td class="source">exports.g = function (input) {</td></tr><tr class="hit"><td class="line">153</td><td class="hits">1</td><td class="source">  var h = input.getHours();</td></tr><tr class="hit"><td class="line">154</td><td class="hits">1</td><td class="source">  return h === 0 ? 12 : (h &gt; 12 ? h - 12 : h);</td></tr><tr><td class="line">155</td><td class="hits"></td><td class="source">};</td></tr><tr class="hit"><td class="line">156</td><td class="hits">1</td><td class="source">exports.G = function (input) {</td></tr><tr class="hit"><td class="line">157</td><td class="hits">2</td><td class="source">  return input.getHours();</td></tr><tr><td class="line">158</td><td class="hits"></td><td class="source">};</td></tr><tr class="hit"><td class="line">159</td><td class="hits">1</td><td class="source">exports.h = function (input) {</td></tr><tr class="hit"><td class="line">160</td><td class="hits">2</td><td class="source">  var h = input.getHours();</td></tr><tr class="hit"><td class="line">161</td><td class="hits">2</td><td class="source">  return ((h &lt; 10 || (12 &lt; h &amp;&amp; 22 &gt; h)) ? '0' : '') + ((h &lt; 12) ? h : h - 12);</td></tr><tr><td class="line">162</td><td class="hits"></td><td class="source">};</td></tr><tr class="hit"><td class="line">163</td><td class="hits">1</td><td class="source">exports.H = function (input) {</td></tr><tr class="hit"><td class="line">164</td><td class="hits">2</td><td class="source">  var h = input.getHours();</td></tr><tr class="hit"><td class="line">165</td><td class="hits">2</td><td class="source">  return (h &lt; 10 ? '0' : '') + h;</td></tr><tr><td class="line">166</td><td class="hits"></td><td class="source">};</td></tr><tr class="hit"><td class="line">167</td><td class="hits">1</td><td class="source">exports.i = function (input) {</td></tr><tr class="hit"><td class="line">168</td><td class="hits">2</td><td class="source">  var m = input.getMinutes();</td></tr><tr class="hit"><td class="line">169</td><td class="hits">2</td><td class="source">  return (m &lt; 10 ? '0' : '') + m;</td></tr><tr><td class="line">170</td><td class="hits"></td><td class="source">};</td></tr><tr class="hit"><td class="line">171</td><td class="hits">1</td><td class="source">exports.s = function (input) {</td></tr><tr class="hit"><td class="line">172</td><td class="hits">1</td><td class="source">  var s = input.getSeconds();</td></tr><tr class="hit"><td class="line">173</td><td class="hits">1</td><td class="source">  return (s &lt; 10 ? '0' : '') + s;</td></tr><tr><td class="line">174</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">175</td><td class="hits"></td><td class="source">//u = function () { return ''; },</td></tr><tr><td class="line">176</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">177</td><td class="hits"></td><td class="source">// Timezone</td></tr><tr><td class="line">178</td><td class="hits"></td><td class="source">//e = function () { return ''; },</td></tr><tr><td class="line">179</td><td class="hits"></td><td class="source">//I = function () { return ''; },</td></tr><tr class="hit"><td class="line">180</td><td class="hits">1</td><td class="source">exports.O = function (input) {</td></tr><tr class="hit"><td class="line">181</td><td class="hits">3</td><td class="source">  var tz = input.getTimezoneOffset();</td></tr><tr class="hit"><td class="line">182</td><td class="hits">3</td><td class="source">  return (tz &lt; 0 ? '-' : '+') + (tz / 60 &lt; 10 ? '0' : '') + Math.abs((tz / 60)) + '00';</td></tr><tr><td class="line">183</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">184</td><td class="hits"></td><td class="source">//T = function () { return ''; },</td></tr><tr class="hit"><td class="line">185</td><td class="hits">1</td><td class="source">exports.Z = function (input) {</td></tr><tr class="hit"><td class="line">186</td><td class="hits">1</td><td class="source">  return input.getTimezoneOffset() * 60;</td></tr><tr><td class="line">187</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">188</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">189</td><td class="hits"></td><td class="source">// Full Date/Time</td></tr><tr class="hit"><td class="line">190</td><td class="hits">1</td><td class="source">exports.c = function (input) {</td></tr><tr class="hit"><td class="line">191</td><td class="hits">1</td><td class="source">  return input.toISOString();</td></tr><tr><td class="line">192</td><td class="hits"></td><td class="source">};</td></tr><tr class="hit"><td class="line">193</td><td class="hits">1</td><td class="source">exports.r = function (input) {</td></tr><tr class="hit"><td class="line">194</td><td class="hits">1</td><td class="source">  return input.toUTCString();</td></tr><tr><td class="line">195</td><td class="hits"></td><td class="source">};</td></tr><tr class="hit"><td class="line">196</td><td class="hits">1</td><td class="source">exports.U = function (input) {</td></tr><tr class="hit"><td class="line">197</td><td class="hits">1</td><td class="source">  return input.getTime() / 1000;</td></tr><tr><td class="line">198</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">199</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="/lib/filters.js">/lib/filters.js</h2><div id="stats" class="high"><div class="percentage">99%</div><div class="sloc">159</div><div class="hits">158</div><div class="misses">1</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr class="hit"><td class="line">1</td><td class="hits">1</td><td class="source">var utils = require('./utils'),</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source">  dateFormatter = require('./dateformatter');</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * Helper method to recursively run a filter across an object/array and apply it to all of the object/array's values.</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> * @param  {*} input</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> * @return {*}</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source"> * @private</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">10</td><td class="hits">1</td><td class="source">function iterateFilter(input) {</td></tr><tr class="hit"><td class="line">11</td><td class="hits">404</td><td class="source">  var self = this,</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source">    out = {};</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">14</td><td class="hits">404</td><td class="source">  if (utils.isArray(input)) {</td></tr><tr class="hit"><td class="line">15</td><td class="hits">24</td><td class="source">    return utils.map(input, function (value) {</td></tr><tr class="hit"><td class="line">16</td><td class="hits">57</td><td class="source">      return self.apply(null, arguments);</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">20</td><td class="hits">380</td><td class="source">  if (typeof input === 'object') {</td></tr><tr class="hit"><td class="line">21</td><td class="hits">4</td><td class="source">    utils.each(input, function (value, key) {</td></tr><tr class="hit"><td class="line">22</td><td class="hits">5</td><td class="source">      out[key] = self.apply(null, arguments);</td></tr><tr><td class="line">23</td><td class="hits"></td><td class="source">    });</td></tr><tr class="hit"><td class="line">24</td><td class="hits">4</td><td class="source">    return out;</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">27</td><td class="hits">376</td><td class="source">  return;</td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source"> * Backslash-escape characters that need to be escaped.</td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source"> * @example</td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source"> * {{ &quot;\&quot;quoted string\&quot;&quot;|addslashes }}</td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source"> * // =&gt; \&quot;quoted string\&quot;</td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source"> * @param  {*}  input</td></tr><tr><td class="line">38</td><td class="hits"></td><td class="source"> * @return {*}        Backslash-escaped string.</td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">40</td><td class="hits">1</td><td class="source">exports.addslashes = function (input) {</td></tr><tr class="hit"><td class="line">41</td><td class="hits">6</td><td class="source">  var out = iterateFilter.apply(exports.addslashes, arguments);</td></tr><tr class="hit"><td class="line">42</td><td class="hits">6</td><td class="source">  if (out !== undefined) {</td></tr><tr class="hit"><td class="line">43</td><td class="hits">1</td><td class="source">    return out;</td></tr><tr><td class="line">44</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">45</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">46</td><td class="hits">5</td><td class="source">  return input.replace(/\\/g, '\\\\').replace(/\'/g, &quot;\\'&quot;).replace(/\&quot;/g, '\\&quot;');</td></tr><tr><td class="line">47</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">48</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">49</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">50</td><td class="hits"></td><td class="source"> * Upper-case the first letter of the input and lower-case the rest.</td></tr><tr><td class="line">51</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">52</td><td class="hits"></td><td class="source"> * @example</td></tr><tr><td class="line">53</td><td class="hits"></td><td class="source"> * {{ &quot;i like Burritos&quot;|capitalize }}</td></tr><tr><td class="line">54</td><td class="hits"></td><td class="source"> * // =&gt; I like burritos</td></tr><tr><td class="line">55</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">56</td><td class="hits"></td><td class="source"> * @param  {*} input  If given an array or object, each string member will be run through the filter individually.</td></tr><tr><td class="line">57</td><td class="hits"></td><td class="source"> * @return {*}        Returns the same type as the input.</td></tr><tr><td class="line">58</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">59</td><td class="hits">1</td><td class="source">exports.capitalize = function (input) {</td></tr><tr class="hit"><td class="line">60</td><td class="hits">5</td><td class="source">  var out = iterateFilter.apply(exports.capitalize, arguments);</td></tr><tr class="hit"><td class="line">61</td><td class="hits">5</td><td class="source">  if (out !== undefined) {</td></tr><tr class="hit"><td class="line">62</td><td class="hits">1</td><td class="source">    return out;</td></tr><tr><td class="line">63</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">64</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">65</td><td class="hits">4</td><td class="source">  return input.toString().charAt(0).toUpperCase() + input.toString().substr(1).toLowerCase();</td></tr><tr><td class="line">66</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">67</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">68</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">69</td><td class="hits"></td><td class="source"> * Format a date or Date-compatible string.</td></tr><tr><td class="line">70</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">71</td><td class="hits"></td><td class="source"> * @example</td></tr><tr><td class="line">72</td><td class="hits"></td><td class="source"> * // now = new Date();</td></tr><tr><td class="line">73</td><td class="hits"></td><td class="source"> * {{ now|date('Y-m-d') }}</td></tr><tr><td class="line">74</td><td class="hits"></td><td class="source"> * // =&gt; 2013-08-14</td></tr><tr><td class="line">75</td><td class="hits"></td><td class="source"> * @example</td></tr><tr><td class="line">76</td><td class="hits"></td><td class="source"> * // now = new Date();</td></tr><tr><td class="line">77</td><td class="hits"></td><td class="source"> * {{ now|date('jS \o\f F') }}</td></tr><tr><td class="line">78</td><td class="hits"></td><td class="source"> * // =&gt; 4th of July</td></tr><tr><td class="line">79</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">80</td><td class="hits"></td><td class="source"> * @param  {?(string|date)}   input</td></tr><tr><td class="line">81</td><td class="hits"></td><td class="source"> * @param  {string}           format  PHP-style date format compatible string. Escape characters with &lt;code&gt;\&lt;/code&gt; for string literals.</td></tr><tr><td class="line">82</td><td class="hits"></td><td class="source"> * @param  {number=}          offset  Timezone offset from GMT in minutes.</td></tr><tr><td class="line">83</td><td class="hits"></td><td class="source"> * @param  {string=}          abbr    Timezone abbreviation. Used for output only.</td></tr><tr><td class="line">84</td><td class="hits"></td><td class="source"> * @return {string}                   Formatted date string.</td></tr><tr><td class="line">85</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">86</td><td class="hits">1</td><td class="source">exports.date = function (input, format, offset, abbr) {</td></tr><tr class="hit"><td class="line">87</td><td class="hits">58</td><td class="source">  var l = format.length,</td></tr><tr><td class="line">88</td><td class="hits"></td><td class="source">    date = new dateFormatter.DateZ(input),</td></tr><tr><td class="line">89</td><td class="hits"></td><td class="source">    cur,</td></tr><tr><td class="line">90</td><td class="hits"></td><td class="source">    i = 0,</td></tr><tr><td class="line">91</td><td class="hits"></td><td class="source">    out = '';</td></tr><tr><td class="line">92</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">93</td><td class="hits">58</td><td class="source">  if (offset) {</td></tr><tr class="hit"><td class="line">94</td><td class="hits">57</td><td class="source">    date.setTimezoneOffset(offset, abbr);</td></tr><tr><td class="line">95</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">96</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">97</td><td class="hits">58</td><td class="source">  for (i; i &lt; l; i += 1) {</td></tr><tr class="hit"><td class="line">98</td><td class="hits">82</td><td class="source">    cur = format.charAt(i);</td></tr><tr class="hit"><td class="line">99</td><td class="hits">82</td><td class="source">    if (cur === '\\') {</td></tr><tr class="hit"><td class="line">100</td><td class="hits">8</td><td class="source">      i += 1;</td></tr><tr class="hit"><td class="line">101</td><td class="hits">8</td><td class="source">      out += (i &lt; l) ? format.charAt(i) : cur;</td></tr><tr class="hit"><td class="line">102</td><td class="hits">74</td><td class="source">    } else if (dateFormatter.hasOwnProperty(cur)) {</td></tr><tr class="hit"><td class="line">103</td><td class="hits">65</td><td class="source">      out += dateFormatter[cur](date, offset, abbr);</td></tr><tr><td class="line">104</td><td class="hits"></td><td class="source">    } else {</td></tr><tr class="hit"><td class="line">105</td><td class="hits">9</td><td class="source">      out += cur;</td></tr><tr><td class="line">106</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">107</td><td class="hits"></td><td class="source">  }</td></tr><tr class="hit"><td class="line">108</td><td class="hits">58</td><td class="source">  return out;</td></tr><tr><td class="line">109</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">110</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">111</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">112</td><td class="hits"></td><td class="source"> * If the input is `undefined`, `null`, or `false`, a default return value can be specified.</td></tr><tr><td class="line">113</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">114</td><td class="hits"></td><td class="source"> * @example</td></tr><tr><td class="line">115</td><td class="hits"></td><td class="source"> * {{ null_value|default('Tacos') }}</td></tr><tr><td class="line">116</td><td class="hits"></td><td class="source"> * // =&gt; Tacos</td></tr><tr><td class="line">117</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">118</td><td class="hits"></td><td class="source"> * @example</td></tr><tr><td class="line">119</td><td class="hits"></td><td class="source"> * {{ &quot;Burritos&quot;|default(&quot;Tacos&quot;) }}</td></tr><tr><td class="line">120</td><td class="hits"></td><td class="source"> * // =&gt; Burritos</td></tr><tr><td class="line">121</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">122</td><td class="hits"></td><td class="source"> * @param  {*}  input</td></tr><tr><td class="line">123</td><td class="hits"></td><td class="source"> * @param  {*}  def     Value to return if `input` is `undefined`, `null`, or `false`.</td></tr><tr><td class="line">124</td><td class="hits"></td><td class="source"> * @return {*}          `input` or `def` value.</td></tr><tr><td class="line">125</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">126</td><td class="hits">1</td><td class="source">exports[&quot;default&quot;] = function (input, def) {</td></tr><tr class="hit"><td class="line">127</td><td class="hits">21</td><td class="source">  return (typeof input !== 'undefined' &amp;&amp; (input || typeof input === 'number')) ? input : def;</td></tr><tr><td class="line">128</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">129</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">130</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">131</td><td class="hits"></td><td class="source"> * Force escape the output of the variable. Optionally use `e` as a shortcut filter name. This filter will be applied by default if autoescape is turned on.</td></tr><tr><td class="line">132</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">133</td><td class="hits"></td><td class="source"> * @example</td></tr><tr><td class="line">134</td><td class="hits"></td><td class="source"> * {{ &quot;&lt;blah&gt;&quot;|escape }}</td></tr><tr><td class="line">135</td><td class="hits"></td><td class="source"> * // =&gt; &lt;blah&gt;</td></tr><tr><td class="line">136</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">137</td><td class="hits"></td><td class="source"> * @example</td></tr><tr><td class="line">138</td><td class="hits"></td><td class="source"> * {{ &quot;&lt;blah&gt;&quot;|e(&quot;js&quot;) }}</td></tr><tr><td class="line">139</td><td class="hits"></td><td class="source"> * // =&gt; \u003Cblah\u003E</td></tr><tr><td class="line">140</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">141</td><td class="hits"></td><td class="source"> * @param  {*} input</td></tr><tr><td class="line">142</td><td class="hits"></td><td class="source"> * @param  {string} [type='html']   If you pass the string js in as the type, output will be escaped so that it is safe for JavaScript execution.</td></tr><tr><td class="line">143</td><td class="hits"></td><td class="source"> * @return {string}         Escaped string.</td></tr><tr><td class="line">144</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">145</td><td class="hits">1</td><td class="source">exports.escape = function (input, type) {</td></tr><tr class="hit"><td class="line">146</td><td class="hits">361</td><td class="source">  var out = iterateFilter.apply(exports.escape, arguments),</td></tr><tr><td class="line">147</td><td class="hits"></td><td class="source">    inp = input,</td></tr><tr><td class="line">148</td><td class="hits"></td><td class="source">    i = 0,</td></tr><tr><td class="line">149</td><td class="hits"></td><td class="source">    code;</td></tr><tr><td class="line">150</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">151</td><td class="hits">361</td><td class="source">  if (out !== undefined) {</td></tr><tr class="hit"><td class="line">152</td><td class="hits">18</td><td class="source">    return out;</td></tr><tr><td class="line">153</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">154</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">155</td><td class="hits">343</td><td class="source">  if (typeof input !== 'string') {</td></tr><tr class="hit"><td class="line">156</td><td class="hits">110</td><td class="source">    return input;</td></tr><tr><td class="line">157</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">158</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">159</td><td class="hits">233</td><td class="source">  out = '';</td></tr><tr><td class="line">160</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">161</td><td class="hits">233</td><td class="source">  switch (type) {</td></tr><tr><td class="line">162</td><td class="hits"></td><td class="source">  case 'js':</td></tr><tr class="hit"><td class="line">163</td><td class="hits">6</td><td class="source">    inp = inp.replace(/\\/g, '\\u005C');</td></tr><tr class="hit"><td class="line">164</td><td class="hits">6</td><td class="source">    for (i; i &lt; inp.length; i += 1) {</td></tr><tr class="hit"><td class="line">165</td><td class="hits">161</td><td class="source">      code = inp.charCodeAt(i);</td></tr><tr class="hit"><td class="line">166</td><td class="hits">161</td><td class="source">      if (code &lt; 32) {</td></tr><tr class="hit"><td class="line">167</td><td class="hits">6</td><td class="source">        code = code.toString(16).toUpperCase();</td></tr><tr class="hit"><td class="line">168</td><td class="hits">6</td><td class="source">        code = (code.length &lt; 2) ? '0' + code : code;</td></tr><tr class="hit"><td class="line">169</td><td class="hits">6</td><td class="source">        out += '\\u00' + code;</td></tr><tr><td class="line">170</td><td class="hits"></td><td class="source">      } else {</td></tr><tr class="hit"><td class="line">171</td><td class="hits">155</td><td class="source">        out += inp[i];</td></tr><tr><td class="line">172</td><td class="hits"></td><td class="source">      }</td></tr><tr><td class="line">173</td><td class="hits"></td><td class="source">    }</td></tr><tr class="hit"><td class="line">174</td><td class="hits">6</td><td class="source">    return out.replace(/&amp;/g, '\\u0026')</td></tr><tr><td class="line">175</td><td class="hits"></td><td class="source">      .replace(/&lt;/g, '\\u003C')</td></tr><tr><td class="line">176</td><td class="hits"></td><td class="source">      .replace(/&gt;/g, '\\u003E')</td></tr><tr><td class="line">177</td><td class="hits"></td><td class="source">      .replace(/\'/g, '\\u0027')</td></tr><tr><td class="line">178</td><td class="hits"></td><td class="source">      .replace(/&quot;/g, '\\u0022')</td></tr><tr><td class="line">179</td><td class="hits"></td><td class="source">      .replace(/\=/g, '\\u003D')</td></tr><tr><td class="line">180</td><td class="hits"></td><td class="source">      .replace(/-/g, '\\u002D')</td></tr><tr><td class="line">181</td><td class="hits"></td><td class="source">      .replace(/;/g, '\\u003B');</td></tr><tr><td class="line">182</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">183</td><td class="hits"></td><td class="source">  default:</td></tr><tr class="hit"><td class="line">184</td><td class="hits">227</td><td class="source">    return inp.replace(/&amp;(?!amp;|lt;|gt;|quot;|#39;)/g, '&amp;')</td></tr><tr><td class="line">185</td><td class="hits"></td><td class="source">      .replace(/&lt;/g, '&lt;')</td></tr><tr><td class="line">186</td><td class="hits"></td><td class="source">      .replace(/&gt;/g, '&gt;')</td></tr><tr><td class="line">187</td><td class="hits"></td><td class="source">      .replace(/&quot;/g, '&quot;')</td></tr><tr><td class="line">188</td><td class="hits"></td><td class="source">      .replace(/'/g, '&#39;');</td></tr><tr><td class="line">189</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">190</td><td class="hits"></td><td class="source">};</td></tr><tr class="hit"><td class="line">191</td><td class="hits">1</td><td class="source">exports.e = exports.escape;</td></tr><tr><td class="line">192</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">193</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">194</td><td class="hits"></td><td class="source"> * Get the first item in an array or character in a string. All other objects will attempt to return the first value available.</td></tr><tr><td class="line">195</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">196</td><td class="hits"></td><td class="source"> * @example</td></tr><tr><td class="line">197</td><td class="hits"></td><td class="source"> * // my_arr = ['a', 'b', 'c']</td></tr><tr><td class="line">198</td><td class="hits"></td><td class="source"> * {{ my_arr|first }}</td></tr><tr><td class="line">199</td><td class="hits"></td><td class="source"> * // =&gt; a</td></tr><tr><td class="line">200</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">201</td><td class="hits"></td><td class="source"> * @example</td></tr><tr><td class="line">202</td><td class="hits"></td><td class="source"> * // my_val = 'Tacos'</td></tr><tr><td class="line">203</td><td class="hits"></td><td class="source"> * {{ my_val|first }}</td></tr><tr><td class="line">204</td><td class="hits"></td><td class="source"> * // T</td></tr><tr><td class="line">205</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">206</td><td class="hits"></td><td class="source"> * @param  {*} input</td></tr><tr><td class="line">207</td><td class="hits"></td><td class="source"> * @return {*}        The first item of the array or first character of the string input.</td></tr><tr><td class="line">208</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">209</td><td class="hits">1</td><td class="source">exports.first = function (input) {</td></tr><tr class="hit"><td class="line">210</td><td class="hits">4</td><td class="source">  if (typeof input === 'object' &amp;&amp; !utils.isArray(input)) {</td></tr><tr class="hit"><td class="line">211</td><td class="hits">1</td><td class="source">    var keys = utils.keys(input);</td></tr><tr class="hit"><td class="line">212</td><td class="hits">1</td><td class="source">    return input[keys[0]];</td></tr><tr><td class="line">213</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">214</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">215</td><td class="hits">3</td><td class="source">  if (typeof input === 'string') {</td></tr><tr class="hit"><td class="line">216</td><td class="hits">1</td><td class="source">    return input.substr(0, 1);</td></tr><tr><td class="line">217</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">218</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">219</td><td class="hits">2</td><td class="source">  return input[0];</td></tr><tr><td class="line">220</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">221</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">222</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">223</td><td class="hits"></td><td class="source"> * Group an array of objects by a common key. If an array is not provided, the input value will be returned untouched.</td></tr><tr><td class="line">224</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">225</td><td class="hits"></td><td class="source"> * @example</td></tr><tr><td class="line">226</td><td class="hits"></td><td class="source"> * // people = [{ age: 23, name: 'Paul' }, { age: 26, name: 'Jane' }, { age: 23, name: 'Jim' }];</td></tr><tr><td class="line">227</td><td class="hits"></td><td class="source"> * {% for agegroup in people|groupBy('age') %}</td></tr><tr><td class="line">228</td><td class="hits"></td><td class="source"> *   &lt;h2&gt;{{ loop.key }}&lt;/h2&gt;</td></tr><tr><td class="line">229</td><td class="hits"></td><td class="source"> *   &lt;ul&gt;</td></tr><tr><td class="line">230</td><td class="hits"></td><td class="source"> *     {% for person in agegroup %}</td></tr><tr><td class="line">231</td><td class="hits"></td><td class="source"> *     &lt;li&gt;{{ person.name }}&lt;/li&gt;</td></tr><tr><td class="line">232</td><td class="hits"></td><td class="source"> *     {% endfor %}</td></tr><tr><td class="line">233</td><td class="hits"></td><td class="source"> *   &lt;/ul&gt;</td></tr><tr><td class="line">234</td><td class="hits"></td><td class="source"> * {% endfor %}</td></tr><tr><td class="line">235</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">236</td><td class="hits"></td><td class="source"> * @param  {*}      input Input object.</td></tr><tr><td class="line">237</td><td class="hits"></td><td class="source"> * @param  {string} key   Key to group by.</td></tr><tr><td class="line">238</td><td class="hits"></td><td class="source"> * @return {object}       Grouped arrays by given key.</td></tr><tr><td class="line">239</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">240</td><td class="hits">1</td><td class="source">exports.groupBy = function (input, key) {</td></tr><tr class="hit"><td class="line">241</td><td class="hits">2</td><td class="source">  if (!utils.isArray(input)) {</td></tr><tr class="hit"><td class="line">242</td><td class="hits">1</td><td class="source">    return input;</td></tr><tr><td class="line">243</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">244</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">245</td><td class="hits">1</td><td class="source">  var out = {};</td></tr><tr><td class="line">246</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">247</td><td class="hits">1</td><td class="source">  utils.each(input, function (value) {</td></tr><tr class="hit"><td class="line">248</td><td class="hits">3</td><td class="source">    if (!value.hasOwnProperty(key)) {</td></tr><tr class="miss"><td class="line">249</td><td class="hits">0</td><td class="source">      return;</td></tr><tr><td class="line">250</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">251</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">252</td><td class="hits">3</td><td class="source">    var keyname = value[key],</td></tr><tr><td class="line">253</td><td class="hits"></td><td class="source">      newVal = utils.extend({}, value);</td></tr><tr class="hit"><td class="line">254</td><td class="hits">3</td><td class="source">    delete value[key];</td></tr><tr><td class="line">255</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">256</td><td class="hits">3</td><td class="source">    if (!out[keyname]) {</td></tr><tr class="hit"><td class="line">257</td><td class="hits">2</td><td class="source">      out[keyname] = [];</td></tr><tr><td class="line">258</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">259</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">260</td><td class="hits">3</td><td class="source">    out[keyname].push(value);</td></tr><tr><td class="line">261</td><td class="hits"></td><td class="source">  });</td></tr><tr><td class="line">262</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">263</td><td class="hits">1</td><td class="source">  return out;</td></tr><tr><td class="line">264</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">265</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">266</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">267</td><td class="hits"></td><td class="source"> * Join the input with a string.</td></tr><tr><td class="line">268</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">269</td><td class="hits"></td><td class="source"> * @example</td></tr><tr><td class="line">270</td><td class="hits"></td><td class="source"> * // my_array = ['foo', 'bar', 'baz']</td></tr><tr><td class="line">271</td><td class="hits"></td><td class="source"> * {{ my_array|join(', ') }}</td></tr><tr><td class="line">272</td><td class="hits"></td><td class="source"> * // =&gt; foo, bar, baz</td></tr><tr><td class="line">273</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">274</td><td class="hits"></td><td class="source"> * @example</td></tr><tr><td class="line">275</td><td class="hits"></td><td class="source"> * // my_key_object = { a: 'foo', b: 'bar', c: 'baz' }</td></tr><tr><td class="line">276</td><td class="hits"></td><td class="source"> * {{ my_key_object|join(' and ') }}</td></tr><tr><td class="line">277</td><td class="hits"></td><td class="source"> * // =&gt; foo and bar and baz</td></tr><tr><td class="line">278</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">279</td><td class="hits"></td><td class="source"> * @param  {*}  input</td></tr><tr><td class="line">280</td><td class="hits"></td><td class="source"> * @param  {string} glue    String value to join items together.</td></tr><tr><td class="line">281</td><td class="hits"></td><td class="source"> * @return {string}</td></tr><tr><td class="line">282</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">283</td><td class="hits">1</td><td class="source">exports.join = function (input, glue) {</td></tr><tr class="hit"><td class="line">284</td><td class="hits">11</td><td class="source">  if (utils.isArray(input)) {</td></tr><tr class="hit"><td class="line">285</td><td class="hits">7</td><td class="source">    return input.join(glue);</td></tr><tr><td class="line">286</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">287</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">288</td><td class="hits">4</td><td class="source">  if (typeof input === 'object') {</td></tr><tr class="hit"><td class="line">289</td><td class="hits">3</td><td class="source">    var out = [];</td></tr><tr class="hit"><td class="line">290</td><td class="hits">3</td><td class="source">    utils.each(input, function (value) {</td></tr><tr class="hit"><td class="line">291</td><td class="hits">5</td><td class="source">      out.push(value);</td></tr><tr><td class="line">292</td><td class="hits"></td><td class="source">    });</td></tr><tr class="hit"><td class="line">293</td><td class="hits">3</td><td class="source">    return out.join(glue);</td></tr><tr><td class="line">294</td><td class="hits"></td><td class="source">  }</td></tr><tr class="hit"><td class="line">295</td><td class="hits">1</td><td class="source">  return input;</td></tr><tr><td class="line">296</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">297</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">298</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">299</td><td class="hits"></td><td class="source"> * Return a string representation of an JavaScript object.</td></tr><tr><td class="line">300</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">301</td><td class="hits"></td><td class="source"> * Backwards compatible with swig@0.x.x using `json_encode`.</td></tr><tr><td class="line">302</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">303</td><td class="hits"></td><td class="source"> * @example</td></tr><tr><td class="line">304</td><td class="hits"></td><td class="source"> * // val = { a: 'b' }</td></tr><tr><td class="line">305</td><td class="hits"></td><td class="source"> * {{ val|json }}</td></tr><tr><td class="line">306</td><td class="hits"></td><td class="source"> * // =&gt; {&quot;a&quot;:&quot;b&quot;}</td></tr><tr><td class="line">307</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">308</td><td class="hits"></td><td class="source"> * @example</td></tr><tr><td class="line">309</td><td class="hits"></td><td class="source"> * // val = { a: 'b' }</td></tr><tr><td class="line">310</td><td class="hits"></td><td class="source"> * {{ val|json(4) }}</td></tr><tr><td class="line">311</td><td class="hits"></td><td class="source"> * // =&gt; {</td></tr><tr><td class="line">312</td><td class="hits"></td><td class="source"> * //        &quot;a&quot;: &quot;b&quot;</td></tr><tr><td class="line">313</td><td class="hits"></td><td class="source"> * //    }</td></tr><tr><td class="line">314</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">315</td><td class="hits"></td><td class="source"> * @param  {*}    input</td></tr><tr><td class="line">316</td><td class="hits"></td><td class="source"> * @param  {number}  [indent]  Number of spaces to indent for pretty-formatting.</td></tr><tr><td class="line">317</td><td class="hits"></td><td class="source"> * @return {string}           A valid JSON string.</td></tr><tr><td class="line">318</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">319</td><td class="hits">1</td><td class="source">exports.json = function (input, indent) {</td></tr><tr class="hit"><td class="line">320</td><td class="hits">3</td><td class="source">  return JSON.stringify(input, null, indent || 0);</td></tr><tr><td class="line">321</td><td class="hits"></td><td class="source">};</td></tr><tr class="hit"><td class="line">322</td><td class="hits">1</td><td class="source">exports.json_encode = exports.json;</td></tr><tr><td class="line">323</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">324</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">325</td><td class="hits"></td><td class="source"> * Get the last item in an array or character in a string. All other objects will attempt to return the last value available.</td></tr><tr><td class="line">326</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">327</td><td class="hits"></td><td class="source"> * @example</td></tr><tr><td class="line">328</td><td class="hits"></td><td class="source"> * // my_arr = ['a', 'b', 'c']</td></tr><tr><td class="line">329</td><td class="hits"></td><td class="source"> * {{ my_arr|last }}</td></tr><tr><td class="line">330</td><td class="hits"></td><td class="source"> * // =&gt; c</td></tr><tr><td class="line">331</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">332</td><td class="hits"></td><td class="source"> * @example</td></tr><tr><td class="line">333</td><td class="hits"></td><td class="source"> * // my_val = 'Tacos'</td></tr><tr><td class="line">334</td><td class="hits"></td><td class="source"> * {{ my_val|last }}</td></tr><tr><td class="line">335</td><td class="hits"></td><td class="source"> * // s</td></tr><tr><td class="line">336</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">337</td><td class="hits"></td><td class="source"> * @param  {*} input</td></tr><tr><td class="line">338</td><td class="hits"></td><td class="source"> * @return {*}          The last item of the array or last character of the string.input.</td></tr><tr><td class="line">339</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">340</td><td class="hits">1</td><td class="source">exports.last = function (input) {</td></tr><tr class="hit"><td class="line">341</td><td class="hits">3</td><td class="source">  if (typeof input === 'object' &amp;&amp; !utils.isArray(input)) {</td></tr><tr class="hit"><td class="line">342</td><td class="hits">1</td><td class="source">    var keys = utils.keys(input);</td></tr><tr class="hit"><td class="line">343</td><td class="hits">1</td><td class="source">    return input[keys[keys.length - 1]];</td></tr><tr><td class="line">344</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">345</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">346</td><td class="hits">2</td><td class="source">  if (typeof input === 'string') {</td></tr><tr class="hit"><td class="line">347</td><td class="hits">1</td><td class="source">    return input.charAt(input.length - 1);</td></tr><tr><td class="line">348</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">349</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">350</td><td class="hits">1</td><td class="source">  return input[input.length - 1];</td></tr><tr><td class="line">351</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">352</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">353</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">354</td><td class="hits"></td><td class="source"> * Return the input in all lowercase letters.</td></tr><tr><td class="line">355</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">356</td><td class="hits"></td><td class="source"> * @example</td></tr><tr><td class="line">357</td><td class="hits"></td><td class="source"> * {{ &quot;FOOBAR&quot;|lower }}</td></tr><tr><td class="line">358</td><td class="hits"></td><td class="source"> * // =&gt; foobar</td></tr><tr><td class="line">359</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">360</td><td class="hits"></td><td class="source"> * @example</td></tr><tr><td class="line">361</td><td class="hits"></td><td class="source"> * // myObj = { a: 'FOO', b: 'BAR' }</td></tr><tr><td class="line">362</td><td class="hits"></td><td class="source"> * {{ myObj|lower|join('') }}</td></tr><tr><td class="line">363</td><td class="hits"></td><td class="source"> * // =&gt; foobar</td></tr><tr><td class="line">364</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">365</td><td class="hits"></td><td class="source"> * @param  {*}  input</td></tr><tr><td class="line">366</td><td class="hits"></td><td class="source"> * @return {*}          Returns the same type as the input.</td></tr><tr><td class="line">367</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">368</td><td class="hits">1</td><td class="source">exports.lower = function (input) {</td></tr><tr class="hit"><td class="line">369</td><td class="hits">8</td><td class="source">  var out = iterateFilter.apply(exports.lower, arguments);</td></tr><tr class="hit"><td class="line">370</td><td class="hits">8</td><td class="source">  if (out !== undefined) {</td></tr><tr class="hit"><td class="line">371</td><td class="hits">2</td><td class="source">    return out;</td></tr><tr><td class="line">372</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">373</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">374</td><td class="hits">6</td><td class="source">  return input.toString().toLowerCase();</td></tr><tr><td class="line">375</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">376</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">377</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">378</td><td class="hits"></td><td class="source"> * Deprecated in favor of &lt;a href=&quot;#safe&quot;&gt;safe&lt;/a&gt;.</td></tr><tr><td class="line">379</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">380</td><td class="hits">1</td><td class="source">exports.raw = function (input) {</td></tr><tr class="hit"><td class="line">381</td><td class="hits">2</td><td class="source">  return exports.safe(input);</td></tr><tr><td class="line">382</td><td class="hits"></td><td class="source">};</td></tr><tr class="hit"><td class="line">383</td><td class="hits">1</td><td class="source">exports.raw.safe = true;</td></tr><tr><td class="line">384</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">385</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">386</td><td class="hits"></td><td class="source"> * Returns a new string with the matched search pattern replaced by the given replacement string. Uses JavaScript's built-in String.replace() method.</td></tr><tr><td class="line">387</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">388</td><td class="hits"></td><td class="source"> * @example</td></tr><tr><td class="line">389</td><td class="hits"></td><td class="source"> * // my_var = 'foobar';</td></tr><tr><td class="line">390</td><td class="hits"></td><td class="source"> * {{ my_var|replace('o', 'e', 'g') }}</td></tr><tr><td class="line">391</td><td class="hits"></td><td class="source"> * // =&gt; feebar</td></tr><tr><td class="line">392</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">393</td><td class="hits"></td><td class="source"> * @example</td></tr><tr><td class="line">394</td><td class="hits"></td><td class="source"> * // my_var = &quot;farfegnugen&quot;;</td></tr><tr><td class="line">395</td><td class="hits"></td><td class="source"> * {{ my_var|replace('^f', 'p') }}</td></tr><tr><td class="line">396</td><td class="hits"></td><td class="source"> * // =&gt; parfegnugen</td></tr><tr><td class="line">397</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">398</td><td class="hits"></td><td class="source"> * @example</td></tr><tr><td class="line">399</td><td class="hits"></td><td class="source"> * // my_var = 'a1b2c3';</td></tr><tr><td class="line">400</td><td class="hits"></td><td class="source"> * {{ my_var|replace('\w', '0', 'g') }}</td></tr><tr><td class="line">401</td><td class="hits"></td><td class="source"> * // =&gt; 010203</td></tr><tr><td class="line">402</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">403</td><td class="hits"></td><td class="source"> * @param  {string} input</td></tr><tr><td class="line">404</td><td class="hits"></td><td class="source"> * @param  {string} search      String or pattern to replace from the input.</td></tr><tr><td class="line">405</td><td class="hits"></td><td class="source"> * @param  {string} replacement String to replace matched pattern.</td></tr><tr><td class="line">406</td><td class="hits"></td><td class="source"> * @param  {string} [flags]      Regular Expression flags. 'g': global match, 'i': ignore case, 'm': match over multiple lines</td></tr><tr><td class="line">407</td><td class="hits"></td><td class="source"> * @return {string}             Replaced string.</td></tr><tr><td class="line">408</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">409</td><td class="hits">1</td><td class="source">exports.replace = function (input, search, replacement, flags) {</td></tr><tr class="hit"><td class="line">410</td><td class="hits">11</td><td class="source">  var r = new RegExp(search, flags);</td></tr><tr class="hit"><td class="line">411</td><td class="hits">11</td><td class="source">  return input.replace(r, replacement);</td></tr><tr><td class="line">412</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">413</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">414</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">415</td><td class="hits"></td><td class="source"> * Reverse sort the input. This is an alias for &lt;code data-language=&quot;swig&quot;&gt;{{ input|sort(true) }}&lt;/code&gt;.</td></tr><tr><td class="line">416</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">417</td><td class="hits"></td><td class="source"> * @example</td></tr><tr><td class="line">418</td><td class="hits"></td><td class="source"> * // val = [1, 2, 3];</td></tr><tr><td class="line">419</td><td class="hits"></td><td class="source"> * {{ val|reverse }}</td></tr><tr><td class="line">420</td><td class="hits"></td><td class="source"> * // =&gt; 3,2,1</td></tr><tr><td class="line">421</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">422</td><td class="hits"></td><td class="source"> * @param  {array}  input</td></tr><tr><td class="line">423</td><td class="hits"></td><td class="source"> * @return {array}        Reversed array. The original input object is returned if it was not an array.</td></tr><tr><td class="line">424</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">425</td><td class="hits">1</td><td class="source">exports.reverse = function (input) {</td></tr><tr class="hit"><td class="line">426</td><td class="hits">10</td><td class="source">  return exports.sort(input, true);</td></tr><tr><td class="line">427</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">428</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">429</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">430</td><td class="hits"></td><td class="source"> * Forces the input to not be auto-escaped. Use this only on content that you know is safe to be rendered on your page.</td></tr><tr><td class="line">431</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">432</td><td class="hits"></td><td class="source"> * @example</td></tr><tr><td class="line">433</td><td class="hits"></td><td class="source"> * // my_var = &quot;&lt;p&gt;Stuff&lt;/p&gt;&quot;;</td></tr><tr><td class="line">434</td><td class="hits"></td><td class="source"> * {{ my_var|safe }}</td></tr><tr><td class="line">435</td><td class="hits"></td><td class="source"> * // =&gt; &lt;p&gt;Stuff&lt;/p&gt;</td></tr><tr><td class="line">436</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">437</td><td class="hits"></td><td class="source"> * @param  {*}  input</td></tr><tr><td class="line">438</td><td class="hits"></td><td class="source"> * @return {*}          The input exactly how it was given, regardless of autoescaping status.</td></tr><tr><td class="line">439</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">440</td><td class="hits">1</td><td class="source">exports.safe = function (input) {</td></tr><tr><td class="line">441</td><td class="hits"></td><td class="source">  // This is a magic filter. Its logic is hard-coded into Swig's parser.</td></tr><tr class="hit"><td class="line">442</td><td class="hits">5</td><td class="source">  return input;</td></tr><tr><td class="line">443</td><td class="hits"></td><td class="source">};</td></tr><tr class="hit"><td class="line">444</td><td class="hits">1</td><td class="source">exports.safe.safe = true;</td></tr><tr><td class="line">445</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">446</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">447</td><td class="hits"></td><td class="source"> * Sort the input in an ascending direction.</td></tr><tr><td class="line">448</td><td class="hits"></td><td class="source"> * If given an object, will return the keys as a sorted array.</td></tr><tr><td class="line">449</td><td class="hits"></td><td class="source"> * If given a string, each character will be sorted individually.</td></tr><tr><td class="line">450</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">451</td><td class="hits"></td><td class="source"> * @example</td></tr><tr><td class="line">452</td><td class="hits"></td><td class="source"> * // val = [2, 6, 4];</td></tr><tr><td class="line">453</td><td class="hits"></td><td class="source"> * {{ val|sort }}</td></tr><tr><td class="line">454</td><td class="hits"></td><td class="source"> * // =&gt; 2,4,6</td></tr><tr><td class="line">455</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">456</td><td class="hits"></td><td class="source"> * @example</td></tr><tr><td class="line">457</td><td class="hits"></td><td class="source"> * // val = 'zaq';</td></tr><tr><td class="line">458</td><td class="hits"></td><td class="source"> * {{ val|sort }}</td></tr><tr><td class="line">459</td><td class="hits"></td><td class="source"> * // =&gt; aqz</td></tr><tr><td class="line">460</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">461</td><td class="hits"></td><td class="source"> * @example</td></tr><tr><td class="line">462</td><td class="hits"></td><td class="source"> * // val = { bar: 1, foo: 2 }</td></tr><tr><td class="line">463</td><td class="hits"></td><td class="source"> * {{ val|sort(true) }}</td></tr><tr><td class="line">464</td><td class="hits"></td><td class="source"> * // =&gt; foo,bar</td></tr><tr><td class="line">465</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">466</td><td class="hits"></td><td class="source"> * @param  {*} input</td></tr><tr><td class="line">467</td><td class="hits"></td><td class="source"> * @param {boolean} [reverse=false] Output is given reverse-sorted if true.</td></tr><tr><td class="line">468</td><td class="hits"></td><td class="source"> * @return {*}        Sorted array;</td></tr><tr><td class="line">469</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">470</td><td class="hits">1</td><td class="source">exports.sort = function (input, reverse) {</td></tr><tr class="hit"><td class="line">471</td><td class="hits">15</td><td class="source">  var out;</td></tr><tr class="hit"><td class="line">472</td><td class="hits">15</td><td class="source">  if (utils.isArray(input)) {</td></tr><tr class="hit"><td class="line">473</td><td class="hits">5</td><td class="source">    out = input.sort();</td></tr><tr><td class="line">474</td><td class="hits"></td><td class="source">  } else {</td></tr><tr class="hit"><td class="line">475</td><td class="hits">10</td><td class="source">    switch (typeof input) {</td></tr><tr><td class="line">476</td><td class="hits"></td><td class="source">    case 'object':</td></tr><tr class="hit"><td class="line">477</td><td class="hits">2</td><td class="source">      out = utils.keys(input).sort();</td></tr><tr class="hit"><td class="line">478</td><td class="hits">2</td><td class="source">      break;</td></tr><tr><td class="line">479</td><td class="hits"></td><td class="source">    case 'string':</td></tr><tr class="hit"><td class="line">480</td><td class="hits">8</td><td class="source">      out = input.split('');</td></tr><tr class="hit"><td class="line">481</td><td class="hits">8</td><td class="source">      if (reverse) {</td></tr><tr class="hit"><td class="line">482</td><td class="hits">7</td><td class="source">        return out.reverse().join('');</td></tr><tr><td class="line">483</td><td class="hits"></td><td class="source">      }</td></tr><tr class="hit"><td class="line">484</td><td class="hits">1</td><td class="source">      return out.sort().join('');</td></tr><tr><td class="line">485</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">486</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">487</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">488</td><td class="hits">7</td><td class="source">  if (out &amp;&amp; reverse) {</td></tr><tr class="hit"><td class="line">489</td><td class="hits">4</td><td class="source">    return out.reverse();</td></tr><tr><td class="line">490</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">491</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">492</td><td class="hits">3</td><td class="source">  return out || input;</td></tr><tr><td class="line">493</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">494</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">495</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">496</td><td class="hits"></td><td class="source"> * Strip HTML tags.</td></tr><tr><td class="line">497</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">498</td><td class="hits"></td><td class="source"> * @example</td></tr><tr><td class="line">499</td><td class="hits"></td><td class="source"> * // stuff = '&lt;p&gt;foobar&lt;/p&gt;';</td></tr><tr><td class="line">500</td><td class="hits"></td><td class="source"> * {{ stuff|striptags }}</td></tr><tr><td class="line">501</td><td class="hits"></td><td class="source"> * // =&gt; foobar</td></tr><tr><td class="line">502</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">503</td><td class="hits"></td><td class="source"> * @param  {*}  input</td></tr><tr><td class="line">504</td><td class="hits"></td><td class="source"> * @return {*}        Returns the same object as the input, but with all string values stripped of tags.</td></tr><tr><td class="line">505</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">506</td><td class="hits">1</td><td class="source">exports.striptags = function (input) {</td></tr><tr class="hit"><td class="line">507</td><td class="hits">4</td><td class="source">  var out = iterateFilter.apply(exports.striptags, arguments);</td></tr><tr class="hit"><td class="line">508</td><td class="hits">4</td><td class="source">  if (out !== undefined) {</td></tr><tr class="hit"><td class="line">509</td><td class="hits">1</td><td class="source">    return out;</td></tr><tr><td class="line">510</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">511</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">512</td><td class="hits">3</td><td class="source">  return input.toString().replace(/(&lt;([^&gt;]+)&gt;)/ig, '');</td></tr><tr><td class="line">513</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">514</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">515</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">516</td><td class="hits"></td><td class="source"> * Capitalizes every word given and lower-cases all other letters.</td></tr><tr><td class="line">517</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">518</td><td class="hits"></td><td class="source"> * @example</td></tr><tr><td class="line">519</td><td class="hits"></td><td class="source"> * // my_str = 'this is soMe text';</td></tr><tr><td class="line">520</td><td class="hits"></td><td class="source"> * {{ my_str|title }}</td></tr><tr><td class="line">521</td><td class="hits"></td><td class="source"> * // =&gt; This Is Some Text</td></tr><tr><td class="line">522</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">523</td><td class="hits"></td><td class="source"> * @example</td></tr><tr><td class="line">524</td><td class="hits"></td><td class="source"> * // my_arr = ['hi', 'this', 'is', 'an', 'array'];</td></tr><tr><td class="line">525</td><td class="hits"></td><td class="source"> * {{ my_arr|title|join(' ') }}</td></tr><tr><td class="line">526</td><td class="hits"></td><td class="source"> * // =&gt; Hi This Is An Array</td></tr><tr><td class="line">527</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">528</td><td class="hits"></td><td class="source"> * @param  {*}  input</td></tr><tr><td class="line">529</td><td class="hits"></td><td class="source"> * @return {*}        Returns the same object as the input, but with all words in strings title-cased.</td></tr><tr><td class="line">530</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">531</td><td class="hits">1</td><td class="source">exports.title = function (input) {</td></tr><tr class="hit"><td class="line">532</td><td class="hits">4</td><td class="source">  var out = iterateFilter.apply(exports.title, arguments);</td></tr><tr class="hit"><td class="line">533</td><td class="hits">4</td><td class="source">  if (out !== undefined) {</td></tr><tr class="hit"><td class="line">534</td><td class="hits">1</td><td class="source">    return out;</td></tr><tr><td class="line">535</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">536</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">537</td><td class="hits">3</td><td class="source">  return input.toString().replace(/\w\S*/g, function (str) {</td></tr><tr class="hit"><td class="line">538</td><td class="hits">6</td><td class="source">    return str.charAt(0).toUpperCase() + str.substr(1).toLowerCase();</td></tr><tr><td class="line">539</td><td class="hits"></td><td class="source">  });</td></tr><tr><td class="line">540</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">541</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">542</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">543</td><td class="hits"></td><td class="source"> * Remove all duplicate items from an array.</td></tr><tr><td class="line">544</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">545</td><td class="hits"></td><td class="source"> * @example</td></tr><tr><td class="line">546</td><td class="hits"></td><td class="source"> * // my_arr = [1, 2, 3, 4, 4, 3, 2, 1];</td></tr><tr><td class="line">547</td><td class="hits"></td><td class="source"> * {{ my_arr|uniq|join(',') }}</td></tr><tr><td class="line">548</td><td class="hits"></td><td class="source"> * // =&gt; 1,2,3,4</td></tr><tr><td class="line">549</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">550</td><td class="hits"></td><td class="source"> * @param  {array}  input</td></tr><tr><td class="line">551</td><td class="hits"></td><td class="source"> * @return {array}        Array with unique items. If input was not an array, the original item is returned untouched.</td></tr><tr><td class="line">552</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">553</td><td class="hits">1</td><td class="source">exports.uniq = function (input) {</td></tr><tr class="hit"><td class="line">554</td><td class="hits">2</td><td class="source">  var result;</td></tr><tr><td class="line">555</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">556</td><td class="hits">2</td><td class="source">  if (!input || !utils.isArray(input)) {</td></tr><tr class="hit"><td class="line">557</td><td class="hits">1</td><td class="source">    return '';</td></tr><tr><td class="line">558</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">559</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">560</td><td class="hits">1</td><td class="source">  result = [];</td></tr><tr class="hit"><td class="line">561</td><td class="hits">1</td><td class="source">  utils.each(input, function (v) {</td></tr><tr class="hit"><td class="line">562</td><td class="hits">6</td><td class="source">    if (result.indexOf(v) === -1) {</td></tr><tr class="hit"><td class="line">563</td><td class="hits">4</td><td class="source">      result.push(v);</td></tr><tr><td class="line">564</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">565</td><td class="hits"></td><td class="source">  });</td></tr><tr class="hit"><td class="line">566</td><td class="hits">1</td><td class="source">  return result;</td></tr><tr><td class="line">567</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">568</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">569</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">570</td><td class="hits"></td><td class="source"> * Convert the input to all uppercase letters. If an object or array is provided, all values will be uppercased.</td></tr><tr><td class="line">571</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">572</td><td class="hits"></td><td class="source"> * @example</td></tr><tr><td class="line">573</td><td class="hits"></td><td class="source"> * // my_str = 'tacos';</td></tr><tr><td class="line">574</td><td class="hits"></td><td class="source"> * {{ my_str|upper }}</td></tr><tr><td class="line">575</td><td class="hits"></td><td class="source"> * // =&gt; TACOS</td></tr><tr><td class="line">576</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">577</td><td class="hits"></td><td class="source"> * @example</td></tr><tr><td class="line">578</td><td class="hits"></td><td class="source"> * // my_arr = ['tacos', 'burritos'];</td></tr><tr><td class="line">579</td><td class="hits"></td><td class="source"> * {{ my_arr|upper|join(' &amp; ') }}</td></tr><tr><td class="line">580</td><td class="hits"></td><td class="source"> * // =&gt; TACOS &amp; BURRITOS</td></tr><tr><td class="line">581</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">582</td><td class="hits"></td><td class="source"> * @param  {*}  input</td></tr><tr><td class="line">583</td><td class="hits"></td><td class="source"> * @return {*}        Returns the same type as the input, with all strings upper-cased.</td></tr><tr><td class="line">584</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">585</td><td class="hits">1</td><td class="source">exports.upper = function (input) {</td></tr><tr class="hit"><td class="line">586</td><td class="hits">8</td><td class="source">  var out = iterateFilter.apply(exports.upper, arguments);</td></tr><tr class="hit"><td class="line">587</td><td class="hits">8</td><td class="source">  if (out !== undefined) {</td></tr><tr class="hit"><td class="line">588</td><td class="hits">2</td><td class="source">    return out;</td></tr><tr><td class="line">589</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">590</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">591</td><td class="hits">6</td><td class="source">  return input.toString().toUpperCase();</td></tr><tr><td class="line">592</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">593</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">594</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">595</td><td class="hits"></td><td class="source"> * URL-encode a string. If an object or array is passed, all values will be URL-encoded.</td></tr><tr><td class="line">596</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">597</td><td class="hits"></td><td class="source"> * @example</td></tr><tr><td class="line">598</td><td class="hits"></td><td class="source"> * // my_str = 'param=1&amp;anotherParam=2';</td></tr><tr><td class="line">599</td><td class="hits"></td><td class="source"> * {{ my_str|url_encode }}</td></tr><tr><td class="line">600</td><td class="hits"></td><td class="source"> * // =&gt; param%3D1%26anotherParam%3D2</td></tr><tr><td class="line">601</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">602</td><td class="hits"></td><td class="source"> * @param  {*} input</td></tr><tr><td class="line">603</td><td class="hits"></td><td class="source"> * @return {*}       URL-encoded string.</td></tr><tr><td class="line">604</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">605</td><td class="hits">1</td><td class="source">exports.url_encode = function (input) {</td></tr><tr class="hit"><td class="line">606</td><td class="hits">4</td><td class="source">  var out = iterateFilter.apply(exports.url_encode, arguments);</td></tr><tr class="hit"><td class="line">607</td><td class="hits">4</td><td class="source">  if (out !== undefined) {</td></tr><tr class="hit"><td class="line">608</td><td class="hits">1</td><td class="source">    return out;</td></tr><tr><td class="line">609</td><td class="hits"></td><td class="source">  }</td></tr><tr class="hit"><td class="line">610</td><td class="hits">3</td><td class="source">  return encodeURIComponent(input);</td></tr><tr><td class="line">611</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">612</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">613</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">614</td><td class="hits"></td><td class="source"> * URL-decode a string. If an object or array is passed, all values will be URL-decoded.</td></tr><tr><td class="line">615</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">616</td><td class="hits"></td><td class="source"> * @example</td></tr><tr><td class="line">617</td><td class="hits"></td><td class="source"> * // my_str = 'param%3D1%26anotherParam%3D2';</td></tr><tr><td class="line">618</td><td class="hits"></td><td class="source"> * {{ my_str|url_decode }}</td></tr><tr><td class="line">619</td><td class="hits"></td><td class="source"> * // =&gt; param=1&amp;anotherParam=2</td></tr><tr><td class="line">620</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">621</td><td class="hits"></td><td class="source"> * @param  {*} input</td></tr><tr><td class="line">622</td><td class="hits"></td><td class="source"> * @return {*}       URL-decoded string.</td></tr><tr><td class="line">623</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">624</td><td class="hits">1</td><td class="source">exports.url_decode = function (input) {</td></tr><tr class="hit"><td class="line">625</td><td class="hits">4</td><td class="source">  var out = iterateFilter.apply(exports.url_decode, arguments);</td></tr><tr class="hit"><td class="line">626</td><td class="hits">4</td><td class="source">  if (out !== undefined) {</td></tr><tr class="hit"><td class="line">627</td><td class="hits">1</td><td class="source">    return out;</td></tr><tr><td class="line">628</td><td class="hits"></td><td class="source">  }</td></tr><tr class="hit"><td class="line">629</td><td class="hits">3</td><td class="source">  return decodeURIComponent(input);</td></tr><tr><td class="line">630</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">631</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="/lib/lexer.js">/lib/lexer.js</h2><div id="stats" class="high"><div class="percentage">96%</div><div class="sloc">25</div><div class="hits">24</div><div class="misses">1</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr class="hit"><td class="line">1</td><td class="hits">1</td><td class="source">var utils = require('./utils');</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * A lexer token.</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * @typedef {object} LexerToken</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> * @property {string} match  The string that was matched.</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> * @property {number} type   Lexer type enum.</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source"> * @property {number} length Length of the original string processed.</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source"> * Enum for token types.</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source"> * @readonly</td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source"> * @enum {number}</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">16</td><td class="hits">1</td><td class="source">var TYPES = {</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source">    /** Whitespace */</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source">    WHITESPACE: 0,</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source">    /** Plain string */</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source">    STRING: 1,</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source">    /** Variable filter */</td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source">    FILTER: 2,</td></tr><tr><td class="line">23</td><td class="hits"></td><td class="source">    /** Empty variable filter */</td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source">    FILTEREMPTY: 3,</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source">    /** Function */</td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source">    FUNCTION: 4,</td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source">    /** Function with no arguments */</td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source">    FUNCTIONEMPTY: 5,</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source">    /** Open parenthesis */</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source">    PARENOPEN: 6,</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source">    /** Close parenthesis */</td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source">    PARENCLOSE: 7,</td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source">    /** Comma */</td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source">    COMMA: 8,</td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source">    /** Variable */</td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source">    VAR: 9,</td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source">    /** Number */</td></tr><tr><td class="line">38</td><td class="hits"></td><td class="source">    NUMBER: 10,</td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source">    /** Math operator */</td></tr><tr><td class="line">40</td><td class="hits"></td><td class="source">    OPERATOR: 11,</td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source">    /** Open square bracket */</td></tr><tr><td class="line">42</td><td class="hits"></td><td class="source">    BRACKETOPEN: 12,</td></tr><tr><td class="line">43</td><td class="hits"></td><td class="source">    /** Close square bracket */</td></tr><tr><td class="line">44</td><td class="hits"></td><td class="source">    BRACKETCLOSE: 13,</td></tr><tr><td class="line">45</td><td class="hits"></td><td class="source">    /** Key on an object using dot-notation */</td></tr><tr><td class="line">46</td><td class="hits"></td><td class="source">    DOTKEY: 14,</td></tr><tr><td class="line">47</td><td class="hits"></td><td class="source">    /** Start of an array */</td></tr><tr><td class="line">48</td><td class="hits"></td><td class="source">    ARRAYOPEN: 15,</td></tr><tr><td class="line">49</td><td class="hits"></td><td class="source">    /** End of an array</td></tr><tr><td class="line">50</td><td class="hits"></td><td class="source">     * Currently unused</td></tr><tr><td class="line">51</td><td class="hits"></td><td class="source">    ARRAYCLOSE: 16, */</td></tr><tr><td class="line">52</td><td class="hits"></td><td class="source">    /** Open curly brace */</td></tr><tr><td class="line">53</td><td class="hits"></td><td class="source">    CURLYOPEN: 17,</td></tr><tr><td class="line">54</td><td class="hits"></td><td class="source">    /** Close curly brace */</td></tr><tr><td class="line">55</td><td class="hits"></td><td class="source">    CURLYCLOSE: 18,</td></tr><tr><td class="line">56</td><td class="hits"></td><td class="source">    /** Colon (:) */</td></tr><tr><td class="line">57</td><td class="hits"></td><td class="source">    COLON: 19,</td></tr><tr><td class="line">58</td><td class="hits"></td><td class="source">    /** JavaScript-valid comparator */</td></tr><tr><td class="line">59</td><td class="hits"></td><td class="source">    COMPARATOR: 20,</td></tr><tr><td class="line">60</td><td class="hits"></td><td class="source">    /** Boolean logic */</td></tr><tr><td class="line">61</td><td class="hits"></td><td class="source">    LOGIC: 21,</td></tr><tr><td class="line">62</td><td class="hits"></td><td class="source">    /** Boolean logic &quot;not&quot; */</td></tr><tr><td class="line">63</td><td class="hits"></td><td class="source">    NOT: 22,</td></tr><tr><td class="line">64</td><td class="hits"></td><td class="source">    /** true or false */</td></tr><tr><td class="line">65</td><td class="hits"></td><td class="source">    BOOL: 23,</td></tr><tr><td class="line">66</td><td class="hits"></td><td class="source">    /** Variable assignment */</td></tr><tr><td class="line">67</td><td class="hits"></td><td class="source">    ASSIGNMENT: 24,</td></tr><tr><td class="line">68</td><td class="hits"></td><td class="source">    /** Start of a method */</td></tr><tr><td class="line">69</td><td class="hits"></td><td class="source">    METHODOPEN: 25,</td></tr><tr><td class="line">70</td><td class="hits"></td><td class="source">    /** End of a method</td></tr><tr><td class="line">71</td><td class="hits"></td><td class="source">     * Currently unused</td></tr><tr><td class="line">72</td><td class="hits"></td><td class="source">    METHODEND: 26, */</td></tr><tr><td class="line">73</td><td class="hits"></td><td class="source">    /** Unknown type */</td></tr><tr><td class="line">74</td><td class="hits"></td><td class="source">    UNKNOWN: 100</td></tr><tr><td class="line">75</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">76</td><td class="hits"></td><td class="source">  rules = [</td></tr><tr><td class="line">77</td><td class="hits"></td><td class="source">    {</td></tr><tr><td class="line">78</td><td class="hits"></td><td class="source">      type: TYPES.WHITESPACE,</td></tr><tr><td class="line">79</td><td class="hits"></td><td class="source">      regex: [</td></tr><tr><td class="line">80</td><td class="hits"></td><td class="source">        /^\s+/</td></tr><tr><td class="line">81</td><td class="hits"></td><td class="source">      ]</td></tr><tr><td class="line">82</td><td class="hits"></td><td class="source">    },</td></tr><tr><td class="line">83</td><td class="hits"></td><td class="source">    {</td></tr><tr><td class="line">84</td><td class="hits"></td><td class="source">      type: TYPES.STRING,</td></tr><tr><td class="line">85</td><td class="hits"></td><td class="source">      regex: [</td></tr><tr><td class="line">86</td><td class="hits"></td><td class="source">        /^&quot;&quot;/,</td></tr><tr><td class="line">87</td><td class="hits"></td><td class="source">        /^&quot;.*?[^\\]&quot;/,</td></tr><tr><td class="line">88</td><td class="hits"></td><td class="source">        /^''/,</td></tr><tr><td class="line">89</td><td class="hits"></td><td class="source">        /^'.*?[^\\]'/</td></tr><tr><td class="line">90</td><td class="hits"></td><td class="source">      ]</td></tr><tr><td class="line">91</td><td class="hits"></td><td class="source">    },</td></tr><tr><td class="line">92</td><td class="hits"></td><td class="source">    {</td></tr><tr><td class="line">93</td><td class="hits"></td><td class="source">      type: TYPES.FILTER,</td></tr><tr><td class="line">94</td><td class="hits"></td><td class="source">      regex: [</td></tr><tr><td class="line">95</td><td class="hits"></td><td class="source">        /^\|\s*(\w+)\(/</td></tr><tr><td class="line">96</td><td class="hits"></td><td class="source">      ],</td></tr><tr><td class="line">97</td><td class="hits"></td><td class="source">      idx: 1</td></tr><tr><td class="line">98</td><td class="hits"></td><td class="source">    },</td></tr><tr><td class="line">99</td><td class="hits"></td><td class="source">    {</td></tr><tr><td class="line">100</td><td class="hits"></td><td class="source">      type: TYPES.FILTEREMPTY,</td></tr><tr><td class="line">101</td><td class="hits"></td><td class="source">      regex: [</td></tr><tr><td class="line">102</td><td class="hits"></td><td class="source">        /^\|\s*(\w+)/</td></tr><tr><td class="line">103</td><td class="hits"></td><td class="source">      ],</td></tr><tr><td class="line">104</td><td class="hits"></td><td class="source">      idx: 1</td></tr><tr><td class="line">105</td><td class="hits"></td><td class="source">    },</td></tr><tr><td class="line">106</td><td class="hits"></td><td class="source">    {</td></tr><tr><td class="line">107</td><td class="hits"></td><td class="source">      type: TYPES.FUNCTIONEMPTY,</td></tr><tr><td class="line">108</td><td class="hits"></td><td class="source">      regex: [</td></tr><tr><td class="line">109</td><td class="hits"></td><td class="source">        /^\s*(\w+)\(\)/</td></tr><tr><td class="line">110</td><td class="hits"></td><td class="source">      ],</td></tr><tr><td class="line">111</td><td class="hits"></td><td class="source">      idx: 1</td></tr><tr><td class="line">112</td><td class="hits"></td><td class="source">    },</td></tr><tr><td class="line">113</td><td class="hits"></td><td class="source">    {</td></tr><tr><td class="line">114</td><td class="hits"></td><td class="source">      type: TYPES.FUNCTION,</td></tr><tr><td class="line">115</td><td class="hits"></td><td class="source">      regex: [</td></tr><tr><td class="line">116</td><td class="hits"></td><td class="source">        /^\s*(\w+)\(/</td></tr><tr><td class="line">117</td><td class="hits"></td><td class="source">      ],</td></tr><tr><td class="line">118</td><td class="hits"></td><td class="source">      idx: 1</td></tr><tr><td class="line">119</td><td class="hits"></td><td class="source">    },</td></tr><tr><td class="line">120</td><td class="hits"></td><td class="source">    {</td></tr><tr><td class="line">121</td><td class="hits"></td><td class="source">      type: TYPES.PARENOPEN,</td></tr><tr><td class="line">122</td><td class="hits"></td><td class="source">      regex: [</td></tr><tr><td class="line">123</td><td class="hits"></td><td class="source">        /^\(/</td></tr><tr><td class="line">124</td><td class="hits"></td><td class="source">      ]</td></tr><tr><td class="line">125</td><td class="hits"></td><td class="source">    },</td></tr><tr><td class="line">126</td><td class="hits"></td><td class="source">    {</td></tr><tr><td class="line">127</td><td class="hits"></td><td class="source">      type: TYPES.PARENCLOSE,</td></tr><tr><td class="line">128</td><td class="hits"></td><td class="source">      regex: [</td></tr><tr><td class="line">129</td><td class="hits"></td><td class="source">        /^\)/</td></tr><tr><td class="line">130</td><td class="hits"></td><td class="source">      ]</td></tr><tr><td class="line">131</td><td class="hits"></td><td class="source">    },</td></tr><tr><td class="line">132</td><td class="hits"></td><td class="source">    {</td></tr><tr><td class="line">133</td><td class="hits"></td><td class="source">      type: TYPES.COMMA,</td></tr><tr><td class="line">134</td><td class="hits"></td><td class="source">      regex: [</td></tr><tr><td class="line">135</td><td class="hits"></td><td class="source">        /^,/</td></tr><tr><td class="line">136</td><td class="hits"></td><td class="source">      ]</td></tr><tr><td class="line">137</td><td class="hits"></td><td class="source">    },</td></tr><tr><td class="line">138</td><td class="hits"></td><td class="source">    {</td></tr><tr><td class="line">139</td><td class="hits"></td><td class="source">      type: TYPES.LOGIC,</td></tr><tr><td class="line">140</td><td class="hits"></td><td class="source">      regex: [</td></tr><tr><td class="line">141</td><td class="hits"></td><td class="source">        /^(&amp;&amp;|\|\|)\s*/,</td></tr><tr><td class="line">142</td><td class="hits"></td><td class="source">        /^(and|or)\s+/</td></tr><tr><td class="line">143</td><td class="hits"></td><td class="source">      ],</td></tr><tr><td class="line">144</td><td class="hits"></td><td class="source">      idx: 1,</td></tr><tr><td class="line">145</td><td class="hits"></td><td class="source">      replace: {</td></tr><tr><td class="line">146</td><td class="hits"></td><td class="source">        'and': '&amp;&amp;',</td></tr><tr><td class="line">147</td><td class="hits"></td><td class="source">        'or': '||'</td></tr><tr><td class="line">148</td><td class="hits"></td><td class="source">      }</td></tr><tr><td class="line">149</td><td class="hits"></td><td class="source">    },</td></tr><tr><td class="line">150</td><td class="hits"></td><td class="source">    {</td></tr><tr><td class="line">151</td><td class="hits"></td><td class="source">      type: TYPES.COMPARATOR,</td></tr><tr><td class="line">152</td><td class="hits"></td><td class="source">      regex: [</td></tr><tr><td class="line">153</td><td class="hits"></td><td class="source">        /^(===|==|\!==|\!=|&lt;=|&lt;|&gt;=|&gt;|in\s|gte\s|gt\s|lte\s|lt\s)\s*/</td></tr><tr><td class="line">154</td><td class="hits"></td><td class="source">      ],</td></tr><tr><td class="line">155</td><td class="hits"></td><td class="source">      idx: 1,</td></tr><tr><td class="line">156</td><td class="hits"></td><td class="source">      replace: {</td></tr><tr><td class="line">157</td><td class="hits"></td><td class="source">        'gte': '&gt;=',</td></tr><tr><td class="line">158</td><td class="hits"></td><td class="source">        'gt': '&gt;',</td></tr><tr><td class="line">159</td><td class="hits"></td><td class="source">        'lte': '&lt;=',</td></tr><tr><td class="line">160</td><td class="hits"></td><td class="source">        'lt': '&lt;'</td></tr><tr><td class="line">161</td><td class="hits"></td><td class="source">      }</td></tr><tr><td class="line">162</td><td class="hits"></td><td class="source">    },</td></tr><tr><td class="line">163</td><td class="hits"></td><td class="source">    {</td></tr><tr><td class="line">164</td><td class="hits"></td><td class="source">      type: TYPES.ASSIGNMENT,</td></tr><tr><td class="line">165</td><td class="hits"></td><td class="source">      regex: [</td></tr><tr><td class="line">166</td><td class="hits"></td><td class="source">        /^(=|\+=|-=|\*=|\/=)/</td></tr><tr><td class="line">167</td><td class="hits"></td><td class="source">      ]</td></tr><tr><td class="line">168</td><td class="hits"></td><td class="source">    },</td></tr><tr><td class="line">169</td><td class="hits"></td><td class="source">    {</td></tr><tr><td class="line">170</td><td class="hits"></td><td class="source">      type: TYPES.NOT,</td></tr><tr><td class="line">171</td><td class="hits"></td><td class="source">      regex: [</td></tr><tr><td class="line">172</td><td class="hits"></td><td class="source">        /^\!\s*/,</td></tr><tr><td class="line">173</td><td class="hits"></td><td class="source">        /^not\s+/</td></tr><tr><td class="line">174</td><td class="hits"></td><td class="source">      ],</td></tr><tr><td class="line">175</td><td class="hits"></td><td class="source">      replace: {</td></tr><tr><td class="line">176</td><td class="hits"></td><td class="source">        'not': '!'</td></tr><tr><td class="line">177</td><td class="hits"></td><td class="source">      }</td></tr><tr><td class="line">178</td><td class="hits"></td><td class="source">    },</td></tr><tr><td class="line">179</td><td class="hits"></td><td class="source">    {</td></tr><tr><td class="line">180</td><td class="hits"></td><td class="source">      type: TYPES.BOOL,</td></tr><tr><td class="line">181</td><td class="hits"></td><td class="source">      regex: [</td></tr><tr><td class="line">182</td><td class="hits"></td><td class="source">        /^(true|false)\s+/,</td></tr><tr><td class="line">183</td><td class="hits"></td><td class="source">        /^(true|false)$/</td></tr><tr><td class="line">184</td><td class="hits"></td><td class="source">      ],</td></tr><tr><td class="line">185</td><td class="hits"></td><td class="source">      idx: 1</td></tr><tr><td class="line">186</td><td class="hits"></td><td class="source">    },</td></tr><tr><td class="line">187</td><td class="hits"></td><td class="source">    {</td></tr><tr><td class="line">188</td><td class="hits"></td><td class="source">      type: TYPES.VAR,</td></tr><tr><td class="line">189</td><td class="hits"></td><td class="source">      regex: [</td></tr><tr><td class="line">190</td><td class="hits"></td><td class="source">        /^[a-zA-Z_$]\w*((\.\$?\w*)+)?/,</td></tr><tr><td class="line">191</td><td class="hits"></td><td class="source">        /^[a-zA-Z_$]\w*/</td></tr><tr><td class="line">192</td><td class="hits"></td><td class="source">      ]</td></tr><tr><td class="line">193</td><td class="hits"></td><td class="source">    },</td></tr><tr><td class="line">194</td><td class="hits"></td><td class="source">    {</td></tr><tr><td class="line">195</td><td class="hits"></td><td class="source">      type: TYPES.BRACKETOPEN,</td></tr><tr><td class="line">196</td><td class="hits"></td><td class="source">      regex: [</td></tr><tr><td class="line">197</td><td class="hits"></td><td class="source">        /^\[/</td></tr><tr><td class="line">198</td><td class="hits"></td><td class="source">      ]</td></tr><tr><td class="line">199</td><td class="hits"></td><td class="source">    },</td></tr><tr><td class="line">200</td><td class="hits"></td><td class="source">    {</td></tr><tr><td class="line">201</td><td class="hits"></td><td class="source">      type: TYPES.BRACKETCLOSE,</td></tr><tr><td class="line">202</td><td class="hits"></td><td class="source">      regex: [</td></tr><tr><td class="line">203</td><td class="hits"></td><td class="source">        /^\]/</td></tr><tr><td class="line">204</td><td class="hits"></td><td class="source">      ]</td></tr><tr><td class="line">205</td><td class="hits"></td><td class="source">    },</td></tr><tr><td class="line">206</td><td class="hits"></td><td class="source">    {</td></tr><tr><td class="line">207</td><td class="hits"></td><td class="source">      type: TYPES.CURLYOPEN,</td></tr><tr><td class="line">208</td><td class="hits"></td><td class="source">      regex: [</td></tr><tr><td class="line">209</td><td class="hits"></td><td class="source">        /^\{/</td></tr><tr><td class="line">210</td><td class="hits"></td><td class="source">      ]</td></tr><tr><td class="line">211</td><td class="hits"></td><td class="source">    },</td></tr><tr><td class="line">212</td><td class="hits"></td><td class="source">    {</td></tr><tr><td class="line">213</td><td class="hits"></td><td class="source">      type: TYPES.COLON,</td></tr><tr><td class="line">214</td><td class="hits"></td><td class="source">      regex: [</td></tr><tr><td class="line">215</td><td class="hits"></td><td class="source">        /^\:/</td></tr><tr><td class="line">216</td><td class="hits"></td><td class="source">      ]</td></tr><tr><td class="line">217</td><td class="hits"></td><td class="source">    },</td></tr><tr><td class="line">218</td><td class="hits"></td><td class="source">    {</td></tr><tr><td class="line">219</td><td class="hits"></td><td class="source">      type: TYPES.CURLYCLOSE,</td></tr><tr><td class="line">220</td><td class="hits"></td><td class="source">      regex: [</td></tr><tr><td class="line">221</td><td class="hits"></td><td class="source">        /^\}/</td></tr><tr><td class="line">222</td><td class="hits"></td><td class="source">      ]</td></tr><tr><td class="line">223</td><td class="hits"></td><td class="source">    },</td></tr><tr><td class="line">224</td><td class="hits"></td><td class="source">    {</td></tr><tr><td class="line">225</td><td class="hits"></td><td class="source">      type: TYPES.DOTKEY,</td></tr><tr><td class="line">226</td><td class="hits"></td><td class="source">      regex: [</td></tr><tr><td class="line">227</td><td class="hits"></td><td class="source">        /^\.(\w+)/</td></tr><tr><td class="line">228</td><td class="hits"></td><td class="source">      ],</td></tr><tr><td class="line">229</td><td class="hits"></td><td class="source">      idx: 1</td></tr><tr><td class="line">230</td><td class="hits"></td><td class="source">    },</td></tr><tr><td class="line">231</td><td class="hits"></td><td class="source">    {</td></tr><tr><td class="line">232</td><td class="hits"></td><td class="source">      type: TYPES.NUMBER,</td></tr><tr><td class="line">233</td><td class="hits"></td><td class="source">      regex: [</td></tr><tr><td class="line">234</td><td class="hits"></td><td class="source">        /^[+\-]?\d+(\.\d+)?/</td></tr><tr><td class="line">235</td><td class="hits"></td><td class="source">      ]</td></tr><tr><td class="line">236</td><td class="hits"></td><td class="source">    },</td></tr><tr><td class="line">237</td><td class="hits"></td><td class="source">    {</td></tr><tr><td class="line">238</td><td class="hits"></td><td class="source">      type: TYPES.OPERATOR,</td></tr><tr><td class="line">239</td><td class="hits"></td><td class="source">      regex: [</td></tr><tr><td class="line">240</td><td class="hits"></td><td class="source">        /^(\+|\-|\/|\*|%)/</td></tr><tr><td class="line">241</td><td class="hits"></td><td class="source">      ]</td></tr><tr><td class="line">242</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">243</td><td class="hits"></td><td class="source">  ];</td></tr><tr><td class="line">244</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">245</td><td class="hits">1</td><td class="source">exports.types = TYPES;</td></tr><tr><td class="line">246</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">247</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">248</td><td class="hits"></td><td class="source"> * Return the token type object for a single chunk of a string.</td></tr><tr><td class="line">249</td><td class="hits"></td><td class="source"> * @param  {string} str String chunk.</td></tr><tr><td class="line">250</td><td class="hits"></td><td class="source"> * @return {LexerToken}     Defined type, potentially stripped or replaced with more suitable content.</td></tr><tr><td class="line">251</td><td class="hits"></td><td class="source"> * @private</td></tr><tr><td class="line">252</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">253</td><td class="hits">1</td><td class="source">function reader(str) {</td></tr><tr class="hit"><td class="line">254</td><td class="hits">2075</td><td class="source">  var matched;</td></tr><tr><td class="line">255</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">256</td><td class="hits">2075</td><td class="source">  utils.some(rules, function (rule) {</td></tr><tr class="hit"><td class="line">257</td><td class="hits">19703</td><td class="source">    return utils.some(rule.regex, function (regex) {</td></tr><tr class="hit"><td class="line">258</td><td class="hits">27511</td><td class="source">      var match = str.match(regex),</td></tr><tr><td class="line">259</td><td class="hits"></td><td class="source">        normalized;</td></tr><tr><td class="line">260</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">261</td><td class="hits">27511</td><td class="source">      if (!match) {</td></tr><tr class="hit"><td class="line">262</td><td class="hits">25436</td><td class="source">        return;</td></tr><tr><td class="line">263</td><td class="hits"></td><td class="source">      }</td></tr><tr><td class="line">264</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">265</td><td class="hits">2075</td><td class="source">      normalized = match[rule.idx || 0].replace(/\s*$/, '');</td></tr><tr class="hit"><td class="line">266</td><td class="hits">2075</td><td class="source">      normalized = (rule.hasOwnProperty('replace') &amp;&amp; rule.replace.hasOwnProperty(normalized)) ? rule.replace[normalized] : normalized;</td></tr><tr><td class="line">267</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">268</td><td class="hits">2075</td><td class="source">      matched = {</td></tr><tr><td class="line">269</td><td class="hits"></td><td class="source">        match: normalized,</td></tr><tr><td class="line">270</td><td class="hits"></td><td class="source">        type: rule.type,</td></tr><tr><td class="line">271</td><td class="hits"></td><td class="source">        length: match[0].length</td></tr><tr><td class="line">272</td><td class="hits"></td><td class="source">      };</td></tr><tr class="hit"><td class="line">273</td><td class="hits">2075</td><td class="source">      return true;</td></tr><tr><td class="line">274</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">275</td><td class="hits"></td><td class="source">  });</td></tr><tr><td class="line">276</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">277</td><td class="hits">2075</td><td class="source">  if (!matched) {</td></tr><tr class="miss"><td class="line">278</td><td class="hits">0</td><td class="source">    matched = {</td></tr><tr><td class="line">279</td><td class="hits"></td><td class="source">      match: str,</td></tr><tr><td class="line">280</td><td class="hits"></td><td class="source">      type: TYPES.UNKNOWN,</td></tr><tr><td class="line">281</td><td class="hits"></td><td class="source">      length: str.length</td></tr><tr><td class="line">282</td><td class="hits"></td><td class="source">    };</td></tr><tr><td class="line">283</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">284</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">285</td><td class="hits">2075</td><td class="source">  return matched;</td></tr><tr><td class="line">286</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">287</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">288</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">289</td><td class="hits"></td><td class="source"> * Read a string and break it into separate token types.</td></tr><tr><td class="line">290</td><td class="hits"></td><td class="source"> * @param  {string} str</td></tr><tr><td class="line">291</td><td class="hits"></td><td class="source"> * @return {Array.LexerToken}     Array of defined types, potentially stripped or replaced with more suitable content.</td></tr><tr><td class="line">292</td><td class="hits"></td><td class="source"> * @private</td></tr><tr><td class="line">293</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">294</td><td class="hits">1</td><td class="source">exports.read = function (str) {</td></tr><tr class="hit"><td class="line">295</td><td class="hits">664</td><td class="source">  var offset = 0,</td></tr><tr><td class="line">296</td><td class="hits"></td><td class="source">    tokens = [],</td></tr><tr><td class="line">297</td><td class="hits"></td><td class="source">    substr,</td></tr><tr><td class="line">298</td><td class="hits"></td><td class="source">    match;</td></tr><tr class="hit"><td class="line">299</td><td class="hits">664</td><td class="source">  while (offset &lt; str.length) {</td></tr><tr class="hit"><td class="line">300</td><td class="hits">2075</td><td class="source">    substr = str.substring(offset);</td></tr><tr class="hit"><td class="line">301</td><td class="hits">2075</td><td class="source">    match = reader(substr);</td></tr><tr class="hit"><td class="line">302</td><td class="hits">2075</td><td class="source">    offset += match.length;</td></tr><tr class="hit"><td class="line">303</td><td class="hits">2075</td><td class="source">    tokens.push(match);</td></tr><tr><td class="line">304</td><td class="hits"></td><td class="source">  }</td></tr><tr class="hit"><td class="line">305</td><td class="hits">664</td><td class="source">  return tokens;</td></tr><tr><td class="line">306</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">307</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="/lib/loaders/filesystem.js">/lib/loaders/filesystem.js</h2><div id="stats" class="high"><div class="percentage">94%</div><div class="sloc">19</div><div class="hits">18</div><div class="misses">1</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr class="hit"><td class="line">1</td><td class="hits">1</td><td class="source">var fs = require('fs'),</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source">  path = require('path');</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * Loads templates from the file system.</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> * @alias swig.loaders.fs</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> * @example</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source"> * swig.setDefaults({ loader: swig.loaders.fs() });</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * @example</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> * // Load Templates from a specific directory (does not require using relative paths in your templates)</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> * swig.setDefaults({ loader: swig.loaders.fs(__dirname + '/templates' )});</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source"> * @param {string}   [basepath='']     Path to the templates as string. Assigning this value allows you to use semi-absolute paths to templates instead of relative paths.</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source"> * @param {string}   [encoding='utf8']   Template encoding</td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">15</td><td class="hits">1</td><td class="source">module.exports = function (basepath, encoding) {</td></tr><tr class="hit"><td class="line">16</td><td class="hits">3</td><td class="source">  var ret = {};</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">18</td><td class="hits">3</td><td class="source">  encoding = encoding || 'utf8';</td></tr><tr class="hit"><td class="line">19</td><td class="hits">3</td><td class="source">  basepath = (basepath) ? path.normalize(basepath) : null;</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source">   * Resolves &lt;var&gt;to&lt;/var&gt; to an absolute path or unique identifier. This is used for building correct, normalized, and absolute paths to a given template.</td></tr><tr><td class="line">23</td><td class="hits"></td><td class="source">   * @alias resolve</td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source">   * @param  {string} to        Non-absolute identifier or pathname to a file.</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source">   * @param  {string} [from]    If given, should attempt to find the &lt;var&gt;to&lt;/var&gt; path in relation to this given, known path.</td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source">   * @return {string}</td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source">   */</td></tr><tr class="hit"><td class="line">28</td><td class="hits">3</td><td class="source">  ret.resolve = function (to, from) {</td></tr><tr class="hit"><td class="line">29</td><td class="hits">4980</td><td class="source">    if (basepath) {</td></tr><tr class="hit"><td class="line">30</td><td class="hits">4</td><td class="source">      from = basepath;</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source">    } else {</td></tr><tr class="hit"><td class="line">32</td><td class="hits">4976</td><td class="source">      from = (from) ? path.dirname(from) : process.cwd();</td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source">    }</td></tr><tr class="hit"><td class="line">34</td><td class="hits">4980</td><td class="source">    return path.resolve(from, to);</td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source">  };</td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">38</td><td class="hits"></td><td class="source">   * Loads a single template. Given a unique &lt;var&gt;identifier&lt;/var&gt; found by the &lt;var&gt;resolve&lt;/var&gt; method this should return the given template.</td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source">   * @alias load</td></tr><tr><td class="line">40</td><td class="hits"></td><td class="source">   * @param  {string}   identifier  Unique identifier of a template (possibly an absolute path).</td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source">   * @param  {function} [cb]        Asynchronous callback function. If not provided, this method should run synchronously.</td></tr><tr><td class="line">42</td><td class="hits"></td><td class="source">   * @return {string}               Template source string.</td></tr><tr><td class="line">43</td><td class="hits"></td><td class="source">   */</td></tr><tr class="hit"><td class="line">44</td><td class="hits">3</td><td class="source">  ret.load = function (identifier, cb) {</td></tr><tr class="hit"><td class="line">45</td><td class="hits">57</td><td class="source">    if (!fs || (cb &amp;&amp; !fs.readFile) || !fs.readFileSync) {</td></tr><tr class="miss"><td class="line">46</td><td class="hits">0</td><td class="source">      throw new Error('Unable to find file ' + identifier + ' because there is no filesystem to read from.');</td></tr><tr><td class="line">47</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">48</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">49</td><td class="hits">57</td><td class="source">    identifier = ret.resolve(identifier);</td></tr><tr><td class="line">50</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">51</td><td class="hits">57</td><td class="source">    if (cb) {</td></tr><tr class="hit"><td class="line">52</td><td class="hits">5</td><td class="source">      fs.readFile(identifier, encoding, cb);</td></tr><tr class="hit"><td class="line">53</td><td class="hits">5</td><td class="source">      return;</td></tr><tr><td class="line">54</td><td class="hits"></td><td class="source">    }</td></tr><tr class="hit"><td class="line">55</td><td class="hits">52</td><td class="source">    return fs.readFileSync(identifier, encoding);</td></tr><tr><td class="line">56</td><td class="hits"></td><td class="source">  };</td></tr><tr><td class="line">57</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">58</td><td class="hits">3</td><td class="source">  return ret;</td></tr><tr><td class="line">59</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">60</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="/lib/loaders/index.js">/lib/loaders/index.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">2</div><div class="hits">2</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> * @namespace TemplateLoader</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * @description Swig is able to accept custom template loaders written by you, so that your templates can come from your favorite storage medium without needing to be part of the core library.</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * A template loader consists of two methods: &lt;var&gt;resolve&lt;/var&gt; and &lt;var&gt;load&lt;/var&gt;. Each method is used internally by Swig to find and load the source of the template before attempting to parse and compile it.</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * @example</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> * // A theoretical memcached loader</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> * var path = require('path'),</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source"> *   Memcached = require('memcached');</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * function memcachedLoader(locations, options) {</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> *   var memcached = new Memcached(locations, options);</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> *   return {</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source"> *     resolve: function (to, from) {</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source"> *       return path.resolve(from, to);</td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source"> *     },</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source"> *     load: function (identifier, cb) {</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source"> *       memcached.get(identifier, function (err, data) {</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source"> *         // if (!data) { load from filesystem; }</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source"> *         cb(err, data);</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source"> *       });</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> *     }</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source"> *   };</td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source"> * };</td></tr><tr><td class="line">23</td><td class="hits"></td><td class="source"> * // Tell swig about the loader:</td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source"> * swig.setDefaults({ loader: memcachedLoader(['192.168.0.2']) });</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source"> * @function</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source"> * @name resolve</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source"> * @memberof TemplateLoader</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source"> * @description</td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source"> * Resolves &lt;var&gt;to&lt;/var&gt; to an absolute path or unique identifier. This is used for building correct, normalized, and absolute paths to a given template.</td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source"> * @param  {string} to        Non-absolute identifier or pathname to a file.</td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source"> * @param  {string} [from]    If given, should attempt to find the &lt;var&gt;to&lt;/var&gt; path in relation to this given, known path.</td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source"> * @return {string}</td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">38</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source"> * @function</td></tr><tr><td class="line">40</td><td class="hits"></td><td class="source"> * @name load</td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source"> * @memberof TemplateLoader</td></tr><tr><td class="line">42</td><td class="hits"></td><td class="source"> * @description</td></tr><tr><td class="line">43</td><td class="hits"></td><td class="source"> * Loads a single template. Given a unique &lt;var&gt;identifier&lt;/var&gt; found by the &lt;var&gt;resolve&lt;/var&gt; method this should return the given template.</td></tr><tr><td class="line">44</td><td class="hits"></td><td class="source"> * @param  {string}   identifier  Unique identifier of a template (possibly an absolute path).</td></tr><tr><td class="line">45</td><td class="hits"></td><td class="source"> * @param  {function} [cb]        Asynchronous callback function. If not provided, this method should run synchronously.</td></tr><tr><td class="line">46</td><td class="hits"></td><td class="source"> * @return {string}               Template source string.</td></tr><tr><td class="line">47</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">48</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">49</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">50</td><td class="hits"></td><td class="source"> * @private</td></tr><tr><td class="line">51</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">52</td><td class="hits">1</td><td class="source">exports.fs = require('./filesystem');</td></tr><tr class="hit"><td class="line">53</td><td class="hits">1</td><td class="source">exports.memory = require('./memory');</td></tr><tr><td class="line">54</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="/lib/loaders/memory.js">/lib/loaders/memory.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">20</div><div class="hits">20</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr class="hit"><td class="line">1</td><td class="hits">1</td><td class="source">var path = require('path'),</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source">  utils = require('../utils');</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * Loads templates from a provided object mapping.</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> * @alias swig.loaders.memory</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> * @example</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source"> * var templates = {</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> *   &quot;layout&quot;: &quot;{% block content %}{% endblock %}&quot;,</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> *   &quot;home.html&quot;: &quot;{% extends 'layout.html' %}{% block content %}...{% endblock %}&quot;</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> * };</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source"> * swig.setDefaults({ loader: swig.loaders.memory(templates) });</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source"> * @param {object} mapping Hash object with template paths as keys and template sources as values.</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source"> * @param {string} [basepath] Path to the templates as string. Assigning this value allows you to use semi-absolute paths to templates instead of relative paths.</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">17</td><td class="hits">1</td><td class="source">module.exports = function (mapping, basepath) {</td></tr><tr class="hit"><td class="line">18</td><td class="hits">7</td><td class="source">  var ret = {};</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">20</td><td class="hits">7</td><td class="source">  basepath = (basepath) ? path.normalize(basepath) : null;</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">23</td><td class="hits"></td><td class="source">   * Resolves &lt;var&gt;to&lt;/var&gt; to an absolute path or unique identifier. This is used for building correct, normalized, and absolute paths to a given template.</td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source">   * @alias resolve</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source">   * @param  {string} to        Non-absolute identifier or pathname to a file.</td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source">   * @param  {string} [from]    If given, should attempt to find the &lt;var&gt;to&lt;/var&gt; path in relation to this given, known path.</td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source">   * @return {string}</td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source">   */</td></tr><tr class="hit"><td class="line">29</td><td class="hits">7</td><td class="source">  ret.resolve = function (to, from) {</td></tr><tr class="hit"><td class="line">30</td><td class="hits">11</td><td class="source">    if (basepath) {</td></tr><tr class="hit"><td class="line">31</td><td class="hits">3</td><td class="source">      from = basepath;</td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source">    } else {</td></tr><tr class="hit"><td class="line">33</td><td class="hits">8</td><td class="source">      from = (from) ? path.dirname(from) : '/';</td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source">    }</td></tr><tr class="hit"><td class="line">35</td><td class="hits">11</td><td class="source">    return path.resolve(from, to);</td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source">  };</td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">38</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source">   * Loads a single template. Given a unique &lt;var&gt;identifier&lt;/var&gt; found by the &lt;var&gt;resolve&lt;/var&gt; method this should return the given template.</td></tr><tr><td class="line">40</td><td class="hits"></td><td class="source">   * @alias load</td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source">   * @param  {string}   identifier  Unique identifier of a template (possibly an absolute path).</td></tr><tr><td class="line">42</td><td class="hits"></td><td class="source">   * @param  {function} [cb]        Asynchronous callback function. If not provided, this method should run synchronously.</td></tr><tr><td class="line">43</td><td class="hits"></td><td class="source">   * @return {string}               Template source string.</td></tr><tr><td class="line">44</td><td class="hits"></td><td class="source">   */</td></tr><tr class="hit"><td class="line">45</td><td class="hits">7</td><td class="source">  ret.load = function (pathname, cb) {</td></tr><tr class="hit"><td class="line">46</td><td class="hits">10</td><td class="source">    var src, paths;</td></tr><tr><td class="line">47</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">48</td><td class="hits">10</td><td class="source">    paths = [pathname, pathname.replace(/^(\/|\\)/, '')];</td></tr><tr><td class="line">49</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">50</td><td class="hits">10</td><td class="source">    src = mapping[paths[0]] || mapping[paths[1]];</td></tr><tr class="hit"><td class="line">51</td><td class="hits">10</td><td class="source">    if (!src) {</td></tr><tr class="hit"><td class="line">52</td><td class="hits">1</td><td class="source">      utils.throwError('Unable to find template &quot;' + pathname + '&quot;.');</td></tr><tr><td class="line">53</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">54</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">55</td><td class="hits">9</td><td class="source">    if (cb) {</td></tr><tr class="hit"><td class="line">56</td><td class="hits">2</td><td class="source">      cb(null, src);</td></tr><tr class="hit"><td class="line">57</td><td class="hits">2</td><td class="source">      return;</td></tr><tr><td class="line">58</td><td class="hits"></td><td class="source">    }</td></tr><tr class="hit"><td class="line">59</td><td class="hits">7</td><td class="source">    return src;</td></tr><tr><td class="line">60</td><td class="hits"></td><td class="source">  };</td></tr><tr><td class="line">61</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">62</td><td class="hits">7</td><td class="source">  return ret;</td></tr><tr><td class="line">63</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">64</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="/lib/parser.js">/lib/parser.js</h2><div id="stats" class="high"><div class="percentage">99%</div><div class="sloc">275</div><div class="hits">274</div><div class="misses">1</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr class="hit"><td class="line">1</td><td class="hits">1</td><td class="source">var utils = require('./utils'),</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source">  lexer = require('./lexer');</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">4</td><td class="hits">1</td><td class="source">var _t = lexer.types,</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source">  _reserved = ['break', 'case', 'catch', 'continue', 'debugger', 'default', 'delete', 'do', 'else', 'finally', 'for', 'function', 'if', 'in', 'instanceof', 'new', 'return', 'switch', 'this', 'throw', 'try', 'typeof', 'var', 'void', 'while', 'with'];</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * Filters are simply functions that perform transformations on their first input argument.</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> * Filters are run at render time, so they may not directly modify the compiled template structure in any way.</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> * All of Swig's built-in filters are written in this same way. For more examples, reference the `filters.js` file in Swig's source.</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source"> * To disable auto-escaping on a custom filter, simply add a property to the filter method `safe = true;` and the output from this will not be escaped, no matter what the global settings are for Swig.</td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source"> * @typedef {function} Filter</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source"> * @example</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source"> * // This filter will return 'bazbop' if the idx on the input is not 'foobar'</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source"> * swig.setFilter('foobar', function (input, idx) {</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> *   return input[idx] === 'foobar' ? input[idx] : 'bazbop';</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source"> * });</td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source"> * // myvar = ['foo', 'bar', 'baz', 'bop'];</td></tr><tr><td class="line">23</td><td class="hits"></td><td class="source"> * // =&gt; {{ myvar|foobar(3) }}</td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source"> * // Since myvar[3] !== 'foobar', we render:</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source"> * // =&gt; bazbop</td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source"> * @example</td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source"> * // This filter will disable auto-escaping on its output:</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source"> * function bazbop (input) { return input; }</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source"> * bazbop.safe = true;</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source"> * swig.setFilter('bazbop', bazbop);</td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source"> * // =&gt; {{ &quot;&lt;p&gt;&quot;|bazbop }}</td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source"> * // =&gt; &lt;p&gt;</td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source"> * @param {*} input Input argument, automatically sent from Swig's built-in parser.</td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source"> * @param {...*} [args] All other arguments are defined by the Filter author.</td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source"> * @return {*}</td></tr><tr><td class="line">38</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">40</td><td class="hits"></td><td class="source">/*!</td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source"> * Makes a string safe for a regular expression.</td></tr><tr><td class="line">42</td><td class="hits"></td><td class="source"> * @param  {string} str</td></tr><tr><td class="line">43</td><td class="hits"></td><td class="source"> * @return {string}</td></tr><tr><td class="line">44</td><td class="hits"></td><td class="source"> * @private</td></tr><tr><td class="line">45</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">46</td><td class="hits">1</td><td class="source">function escapeRegExp(str) {</td></tr><tr class="hit"><td class="line">47</td><td class="hits">2772</td><td class="source">  return str.replace(/[\-\/\\\^$*+?.()|\[\]{}]/g, '\\$&amp;');</td></tr><tr><td class="line">48</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">49</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">50</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">51</td><td class="hits"></td><td class="source"> * Parse strings of variables and tags into tokens for future compilation.</td></tr><tr><td class="line">52</td><td class="hits"></td><td class="source"> * @class</td></tr><tr><td class="line">53</td><td class="hits"></td><td class="source"> * @param {array}   tokens     Pre-split tokens read by the Lexer.</td></tr><tr><td class="line">54</td><td class="hits"></td><td class="source"> * @param {object}  filters    Keyed object of filters that may be applied to variables.</td></tr><tr><td class="line">55</td><td class="hits"></td><td class="source"> * @param {boolean} autoescape Whether or not this should be autoescaped.</td></tr><tr><td class="line">56</td><td class="hits"></td><td class="source"> * @param {number}  line       Beginning line number for the first token.</td></tr><tr><td class="line">57</td><td class="hits"></td><td class="source"> * @param {string}  [filename] Name of the file being parsed.</td></tr><tr><td class="line">58</td><td class="hits"></td><td class="source"> * @private</td></tr><tr><td class="line">59</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">60</td><td class="hits">1</td><td class="source">function TokenParser(tokens, filters, autoescape, line, filename) {</td></tr><tr class="hit"><td class="line">61</td><td class="hits">664</td><td class="source">  this.out = [];</td></tr><tr class="hit"><td class="line">62</td><td class="hits">664</td><td class="source">  this.state = [];</td></tr><tr class="hit"><td class="line">63</td><td class="hits">664</td><td class="source">  this.filterApplyIdx = [];</td></tr><tr class="hit"><td class="line">64</td><td class="hits">664</td><td class="source">  this._parsers = {};</td></tr><tr class="hit"><td class="line">65</td><td class="hits">664</td><td class="source">  this.line = line;</td></tr><tr class="hit"><td class="line">66</td><td class="hits">664</td><td class="source">  this.filename = filename;</td></tr><tr class="hit"><td class="line">67</td><td class="hits">664</td><td class="source">  this.filters = filters;</td></tr><tr class="hit"><td class="line">68</td><td class="hits">664</td><td class="source">  this.escape = autoescape;</td></tr><tr><td class="line">69</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">70</td><td class="hits">664</td><td class="source">  this.parse = function () {</td></tr><tr class="hit"><td class="line">71</td><td class="hits">660</td><td class="source">    var self = this;</td></tr><tr><td class="line">72</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">73</td><td class="hits">660</td><td class="source">    if (self._parsers.start) {</td></tr><tr class="miss"><td class="line">74</td><td class="hits">0</td><td class="source">      self._parsers.start.call(self);</td></tr><tr><td class="line">75</td><td class="hits"></td><td class="source">    }</td></tr><tr class="hit"><td class="line">76</td><td class="hits">660</td><td class="source">    utils.each(tokens, function (token, i) {</td></tr><tr class="hit"><td class="line">77</td><td class="hits">2053</td><td class="source">      var prevToken = tokens[i - 1];</td></tr><tr class="hit"><td class="line">78</td><td class="hits">2053</td><td class="source">      self.isLast = (i === tokens.length - 1);</td></tr><tr class="hit"><td class="line">79</td><td class="hits">2053</td><td class="source">      if (prevToken) {</td></tr><tr class="hit"><td class="line">80</td><td class="hits">1414</td><td class="source">        while (prevToken.type === _t.WHITESPACE) {</td></tr><tr class="hit"><td class="line">81</td><td class="hits">301</td><td class="source">          i -= 1;</td></tr><tr class="hit"><td class="line">82</td><td class="hits">301</td><td class="source">          prevToken = tokens[i - 1];</td></tr><tr><td class="line">83</td><td class="hits"></td><td class="source">        }</td></tr><tr><td class="line">84</td><td class="hits"></td><td class="source">      }</td></tr><tr class="hit"><td class="line">85</td><td class="hits">2053</td><td class="source">      self.prevToken = prevToken;</td></tr><tr class="hit"><td class="line">86</td><td class="hits">2053</td><td class="source">      self.parseToken(token);</td></tr><tr><td class="line">87</td><td class="hits"></td><td class="source">    });</td></tr><tr class="hit"><td class="line">88</td><td class="hits">602</td><td class="source">    if (self._parsers.end) {</td></tr><tr class="hit"><td class="line">89</td><td class="hits">19</td><td class="source">      self._parsers.end.call(self);</td></tr><tr><td class="line">90</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">91</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">92</td><td class="hits">602</td><td class="source">    if (self.escape) {</td></tr><tr class="hit"><td class="line">93</td><td class="hits">272</td><td class="source">      self.filterApplyIdx = [0];</td></tr><tr class="hit"><td class="line">94</td><td class="hits">272</td><td class="source">      if (typeof self.escape === 'string') {</td></tr><tr class="hit"><td class="line">95</td><td class="hits">2</td><td class="source">        self.parseToken({ type: _t.FILTER, match: 'e' });</td></tr><tr class="hit"><td class="line">96</td><td class="hits">2</td><td class="source">        self.parseToken({ type: _t.COMMA, match: ',' });</td></tr><tr class="hit"><td class="line">97</td><td class="hits">2</td><td class="source">        self.parseToken({ type: _t.STRING, match: String(autoescape) });</td></tr><tr class="hit"><td class="line">98</td><td class="hits">2</td><td class="source">        self.parseToken({ type: _t.PARENCLOSE, match: ')'});</td></tr><tr><td class="line">99</td><td class="hits"></td><td class="source">      } else {</td></tr><tr class="hit"><td class="line">100</td><td class="hits">270</td><td class="source">        self.parseToken({ type: _t.FILTEREMPTY, match: 'e' });</td></tr><tr><td class="line">101</td><td class="hits"></td><td class="source">      }</td></tr><tr><td class="line">102</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">103</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">104</td><td class="hits">602</td><td class="source">    return self.out;</td></tr><tr><td class="line">105</td><td class="hits"></td><td class="source">  };</td></tr><tr><td class="line">106</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">107</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">108</td><td class="hits">1</td><td class="source">TokenParser.prototype = {</td></tr><tr><td class="line">109</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">110</td><td class="hits"></td><td class="source">   * Set a custom method to be called when a token type is found.</td></tr><tr><td class="line">111</td><td class="hits"></td><td class="source">   *</td></tr><tr><td class="line">112</td><td class="hits"></td><td class="source">   * @example</td></tr><tr><td class="line">113</td><td class="hits"></td><td class="source">   * parser.on(types.STRING, function (token) {</td></tr><tr><td class="line">114</td><td class="hits"></td><td class="source">   *   this.out.push(token.match);</td></tr><tr><td class="line">115</td><td class="hits"></td><td class="source">   * });</td></tr><tr><td class="line">116</td><td class="hits"></td><td class="source">   * @example</td></tr><tr><td class="line">117</td><td class="hits"></td><td class="source">   * parser.on('start', function () {</td></tr><tr><td class="line">118</td><td class="hits"></td><td class="source">   *   this.out.push('something at the beginning of your args')</td></tr><tr><td class="line">119</td><td class="hits"></td><td class="source">   * });</td></tr><tr><td class="line">120</td><td class="hits"></td><td class="source">   * parser.on('end', function () {</td></tr><tr><td class="line">121</td><td class="hits"></td><td class="source">   *   this.out.push('something at the end of your args');</td></tr><tr><td class="line">122</td><td class="hits"></td><td class="source">   * });</td></tr><tr><td class="line">123</td><td class="hits"></td><td class="source">   *</td></tr><tr><td class="line">124</td><td class="hits"></td><td class="source">   * @param  {number}   type Token type ID. Found in the Lexer.</td></tr><tr><td class="line">125</td><td class="hits"></td><td class="source">   * @param  {Function} fn   Callback function. Return true to continue executing the default parsing function.</td></tr><tr><td class="line">126</td><td class="hits"></td><td class="source">   * @return {undefined}</td></tr><tr><td class="line">127</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">128</td><td class="hits"></td><td class="source">  on: function (type, fn) {</td></tr><tr class="hit"><td class="line">129</td><td class="hits">1003</td><td class="source">    this._parsers[type] = fn;</td></tr><tr><td class="line">130</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">131</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">132</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">133</td><td class="hits"></td><td class="source">   * Parse a single token.</td></tr><tr><td class="line">134</td><td class="hits"></td><td class="source">   * @param  {{match: string, type: number, line: number}} token Lexer token object.</td></tr><tr><td class="line">135</td><td class="hits"></td><td class="source">   * @return {undefined}</td></tr><tr><td class="line">136</td><td class="hits"></td><td class="source">   * @private</td></tr><tr><td class="line">137</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">138</td><td class="hits"></td><td class="source">  parseToken: function (token) {</td></tr><tr class="hit"><td class="line">139</td><td class="hits">2331</td><td class="source">    var self = this,</td></tr><tr><td class="line">140</td><td class="hits"></td><td class="source">      fn = self._parsers[token.type] || self._parsers['*'],</td></tr><tr><td class="line">141</td><td class="hits"></td><td class="source">      match = token.match,</td></tr><tr><td class="line">142</td><td class="hits"></td><td class="source">      prevToken = self.prevToken,</td></tr><tr><td class="line">143</td><td class="hits"></td><td class="source">      prevTokenType = prevToken ? prevToken.type : null,</td></tr><tr><td class="line">144</td><td class="hits"></td><td class="source">      lastState = (self.state.length) ? self.state[self.state.length - 1] : null,</td></tr><tr><td class="line">145</td><td class="hits"></td><td class="source">      temp;</td></tr><tr><td class="line">146</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">147</td><td class="hits">2331</td><td class="source">    if (fn &amp;&amp; typeof fn === 'function') {</td></tr><tr class="hit"><td class="line">148</td><td class="hits">511</td><td class="source">      if (!fn.call(this, token)) {</td></tr><tr class="hit"><td class="line">149</td><td class="hits">401</td><td class="source">        return;</td></tr><tr><td class="line">150</td><td class="hits"></td><td class="source">      }</td></tr><tr><td class="line">151</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">152</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">153</td><td class="hits">1908</td><td class="source">    if (lastState &amp;&amp; prevToken &amp;&amp;</td></tr><tr><td class="line">154</td><td class="hits"></td><td class="source">        lastState === _t.FILTER &amp;&amp;</td></tr><tr><td class="line">155</td><td class="hits"></td><td class="source">        prevTokenType === _t.FILTER &amp;&amp;</td></tr><tr><td class="line">156</td><td class="hits"></td><td class="source">        token.type !== _t.PARENCLOSE &amp;&amp;</td></tr><tr><td class="line">157</td><td class="hits"></td><td class="source">        token.type !== _t.COMMA &amp;&amp;</td></tr><tr><td class="line">158</td><td class="hits"></td><td class="source">        token.type !== _t.OPERATOR &amp;&amp;</td></tr><tr><td class="line">159</td><td class="hits"></td><td class="source">        token.type !== _t.FILTER &amp;&amp;</td></tr><tr><td class="line">160</td><td class="hits"></td><td class="source">        token.type !== _t.FILTEREMPTY) {</td></tr><tr class="hit"><td class="line">161</td><td class="hits">107</td><td class="source">      self.out.push(', ');</td></tr><tr><td class="line">162</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">163</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">164</td><td class="hits">1908</td><td class="source">    if (lastState &amp;&amp; lastState === _t.METHODOPEN) {</td></tr><tr class="hit"><td class="line">165</td><td class="hits">19</td><td class="source">      self.state.pop();</td></tr><tr class="hit"><td class="line">166</td><td class="hits">19</td><td class="source">      if (token.type !== _t.PARENCLOSE) {</td></tr><tr class="hit"><td class="line">167</td><td class="hits">11</td><td class="source">        self.out.push(', ');</td></tr><tr><td class="line">168</td><td class="hits"></td><td class="source">      }</td></tr><tr><td class="line">169</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">170</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">171</td><td class="hits">1908</td><td class="source">    switch (token.type) {</td></tr><tr><td class="line">172</td><td class="hits"></td><td class="source">    case _t.WHITESPACE:</td></tr><tr class="hit"><td class="line">173</td><td class="hits">293</td><td class="source">      break;</td></tr><tr><td class="line">174</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">175</td><td class="hits"></td><td class="source">    case _t.STRING:</td></tr><tr class="hit"><td class="line">176</td><td class="hits">222</td><td class="source">      self.filterApplyIdx.push(self.out.length);</td></tr><tr class="hit"><td class="line">177</td><td class="hits">222</td><td class="source">      self.out.push(match.replace(/\\/g, '\\\\'));</td></tr><tr class="hit"><td class="line">178</td><td class="hits">222</td><td class="source">      break;</td></tr><tr><td class="line">179</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">180</td><td class="hits"></td><td class="source">    case _t.NUMBER:</td></tr><tr><td class="line">181</td><td class="hits"></td><td class="source">    case _t.BOOL:</td></tr><tr class="hit"><td class="line">182</td><td class="hits">116</td><td class="source">      self.filterApplyIdx.push(self.out.length);</td></tr><tr class="hit"><td class="line">183</td><td class="hits">116</td><td class="source">      self.out.push(match);</td></tr><tr class="hit"><td class="line">184</td><td class="hits">116</td><td class="source">      break;</td></tr><tr><td class="line">185</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">186</td><td class="hits"></td><td class="source">    case _t.FILTER:</td></tr><tr class="hit"><td class="line">187</td><td class="hits">111</td><td class="source">      if (!self.filters.hasOwnProperty(match) || typeof self.filters[match] !== &quot;function&quot;) {</td></tr><tr class="hit"><td class="line">188</td><td class="hits">1</td><td class="source">        utils.throwError('Invalid filter &quot;' + match + '&quot;', self.line, self.filename);</td></tr><tr><td class="line">189</td><td class="hits"></td><td class="source">      }</td></tr><tr class="hit"><td class="line">190</td><td class="hits">110</td><td class="source">      self.escape = self.filters[match].safe ? false : self.escape;</td></tr><tr class="hit"><td class="line">191</td><td class="hits">110</td><td class="source">      self.out.splice(self.filterApplyIdx[self.filterApplyIdx.length - 1], 0, '_filters[&quot;' + match + '&quot;](');</td></tr><tr class="hit"><td class="line">192</td><td class="hits">110</td><td class="source">      self.state.push(token.type);</td></tr><tr class="hit"><td class="line">193</td><td class="hits">110</td><td class="source">      break;</td></tr><tr><td class="line">194</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">195</td><td class="hits"></td><td class="source">    case _t.FILTEREMPTY:</td></tr><tr class="hit"><td class="line">196</td><td class="hits">325</td><td class="source">      if (!self.filters.hasOwnProperty(match) || typeof self.filters[match] !== &quot;function&quot;) {</td></tr><tr class="hit"><td class="line">197</td><td class="hits">1</td><td class="source">        utils.throwError('Invalid filter &quot;' + match + '&quot;', self.line, self.filename);</td></tr><tr><td class="line">198</td><td class="hits"></td><td class="source">      }</td></tr><tr class="hit"><td class="line">199</td><td class="hits">324</td><td class="source">      self.escape = self.filters[match].safe ? false : self.escape;</td></tr><tr class="hit"><td class="line">200</td><td class="hits">324</td><td class="source">      self.out.splice(self.filterApplyIdx[self.filterApplyIdx.length - 1], 0, '_filters[&quot;' + match + '&quot;](');</td></tr><tr class="hit"><td class="line">201</td><td class="hits">324</td><td class="source">      self.out.push(')');</td></tr><tr class="hit"><td class="line">202</td><td class="hits">324</td><td class="source">      break;</td></tr><tr><td class="line">203</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">204</td><td class="hits"></td><td class="source">    case _t.FUNCTION:</td></tr><tr><td class="line">205</td><td class="hits"></td><td class="source">    case _t.FUNCTIONEMPTY:</td></tr><tr class="hit"><td class="line">206</td><td class="hits">29</td><td class="source">      self.out.push('((typeof _ctx.' + match + ' !== &quot;undefined&quot;) ? _ctx.' + match +</td></tr><tr><td class="line">207</td><td class="hits"></td><td class="source">        ' : ((typeof ' + match + ' !== &quot;undefined&quot;) ? ' + match +</td></tr><tr><td class="line">208</td><td class="hits"></td><td class="source">        ' : _fn))(');</td></tr><tr class="hit"><td class="line">209</td><td class="hits">29</td><td class="source">      self.escape = false;</td></tr><tr class="hit"><td class="line">210</td><td class="hits">29</td><td class="source">      if (token.type === _t.FUNCTIONEMPTY) {</td></tr><tr class="hit"><td class="line">211</td><td class="hits">10</td><td class="source">        self.out[self.out.length - 1] = self.out[self.out.length - 1] + ')';</td></tr><tr><td class="line">212</td><td class="hits"></td><td class="source">      } else {</td></tr><tr class="hit"><td class="line">213</td><td class="hits">19</td><td class="source">        self.state.push(token.type);</td></tr><tr><td class="line">214</td><td class="hits"></td><td class="source">      }</td></tr><tr class="hit"><td class="line">215</td><td class="hits">29</td><td class="source">      self.filterApplyIdx.push(self.out.length - 1);</td></tr><tr class="hit"><td class="line">216</td><td class="hits">29</td><td class="source">      break;</td></tr><tr><td class="line">217</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">218</td><td class="hits"></td><td class="source">    case _t.PARENOPEN:</td></tr><tr class="hit"><td class="line">219</td><td class="hits">24</td><td class="source">      self.state.push(token.type);</td></tr><tr class="hit"><td class="line">220</td><td class="hits">24</td><td class="source">      if (self.filterApplyIdx.length) {</td></tr><tr class="hit"><td class="line">221</td><td class="hits">22</td><td class="source">        self.out.splice(self.filterApplyIdx[self.filterApplyIdx.length - 1], 0, '(');</td></tr><tr class="hit"><td class="line">222</td><td class="hits">22</td><td class="source">        if (prevToken &amp;&amp; prevTokenType === _t.VAR) {</td></tr><tr class="hit"><td class="line">223</td><td class="hits">19</td><td class="source">          temp = prevToken.match.split('.').slice(0, -1);</td></tr><tr class="hit"><td class="line">224</td><td class="hits">19</td><td class="source">          self.out.push(' || _fn).call(' + self.checkMatch(temp));</td></tr><tr class="hit"><td class="line">225</td><td class="hits">19</td><td class="source">          self.state.push(_t.METHODOPEN);</td></tr><tr class="hit"><td class="line">226</td><td class="hits">19</td><td class="source">          self.escape = false;</td></tr><tr><td class="line">227</td><td class="hits"></td><td class="source">        } else {</td></tr><tr class="hit"><td class="line">228</td><td class="hits">3</td><td class="source">          self.out.push(' || _fn)(');</td></tr><tr><td class="line">229</td><td class="hits"></td><td class="source">        }</td></tr><tr class="hit"><td class="line">230</td><td class="hits">22</td><td class="source">        self.filterApplyIdx.push(self.out.length - 3);</td></tr><tr><td class="line">231</td><td class="hits"></td><td class="source">      } else {</td></tr><tr class="hit"><td class="line">232</td><td class="hits">2</td><td class="source">        self.out.push('(');</td></tr><tr class="hit"><td class="line">233</td><td class="hits">2</td><td class="source">        self.filterApplyIdx.push(self.out.length - 1);</td></tr><tr><td class="line">234</td><td class="hits"></td><td class="source">      }</td></tr><tr class="hit"><td class="line">235</td><td class="hits">24</td><td class="source">      break;</td></tr><tr><td class="line">236</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">237</td><td class="hits"></td><td class="source">    case _t.PARENCLOSE:</td></tr><tr class="hit"><td class="line">238</td><td class="hits">157</td><td class="source">      temp = self.state.pop();</td></tr><tr class="hit"><td class="line">239</td><td class="hits">157</td><td class="source">      if (temp !== _t.PARENOPEN &amp;&amp; temp !== _t.FUNCTION &amp;&amp; temp !== _t.FILTER) {</td></tr><tr class="hit"><td class="line">240</td><td class="hits">1</td><td class="source">        utils.throwError('Mismatched nesting state', self.line, self.filename);</td></tr><tr><td class="line">241</td><td class="hits"></td><td class="source">      }</td></tr><tr class="hit"><td class="line">242</td><td class="hits">156</td><td class="source">      self.out.push(')');</td></tr><tr><td class="line">243</td><td class="hits"></td><td class="source">      // Once off the previous entry</td></tr><tr class="hit"><td class="line">244</td><td class="hits">156</td><td class="source">      self.filterApplyIdx.pop();</td></tr><tr class="hit"><td class="line">245</td><td class="hits">156</td><td class="source">      if (temp !== _t.FILTER) {</td></tr><tr><td class="line">246</td><td class="hits"></td><td class="source">        // Once for the open paren</td></tr><tr class="hit"><td class="line">247</td><td class="hits">46</td><td class="source">        self.filterApplyIdx.pop();</td></tr><tr><td class="line">248</td><td class="hits"></td><td class="source">      }</td></tr><tr class="hit"><td class="line">249</td><td class="hits">156</td><td class="source">      break;</td></tr><tr><td class="line">250</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">251</td><td class="hits"></td><td class="source">    case _t.COMMA:</td></tr><tr class="hit"><td class="line">252</td><td class="hits">106</td><td class="source">      if (lastState !== _t.FUNCTION &amp;&amp;</td></tr><tr><td class="line">253</td><td class="hits"></td><td class="source">          lastState !== _t.FILTER &amp;&amp;</td></tr><tr><td class="line">254</td><td class="hits"></td><td class="source">          lastState !== _t.ARRAYOPEN &amp;&amp;</td></tr><tr><td class="line">255</td><td class="hits"></td><td class="source">          lastState !== _t.CURLYOPEN &amp;&amp;</td></tr><tr><td class="line">256</td><td class="hits"></td><td class="source">          lastState !== _t.PARENOPEN &amp;&amp;</td></tr><tr><td class="line">257</td><td class="hits"></td><td class="source">          lastState !== _t.COLON) {</td></tr><tr class="hit"><td class="line">258</td><td class="hits">1</td><td class="source">        utils.throwError('Unexpected comma', self.line, self.filename);</td></tr><tr><td class="line">259</td><td class="hits"></td><td class="source">      }</td></tr><tr class="hit"><td class="line">260</td><td class="hits">105</td><td class="source">      if (lastState === _t.COLON) {</td></tr><tr class="hit"><td class="line">261</td><td class="hits">5</td><td class="source">        self.state.pop();</td></tr><tr><td class="line">262</td><td class="hits"></td><td class="source">      }</td></tr><tr class="hit"><td class="line">263</td><td class="hits">105</td><td class="source">      self.out.push(', ');</td></tr><tr class="hit"><td class="line">264</td><td class="hits">105</td><td class="source">      self.filterApplyIdx.pop();</td></tr><tr class="hit"><td class="line">265</td><td class="hits">105</td><td class="source">      break;</td></tr><tr><td class="line">266</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">267</td><td class="hits"></td><td class="source">    case _t.LOGIC:</td></tr><tr><td class="line">268</td><td class="hits"></td><td class="source">    case _t.COMPARATOR:</td></tr><tr class="hit"><td class="line">269</td><td class="hits">6</td><td class="source">      if (!prevToken ||</td></tr><tr><td class="line">270</td><td class="hits"></td><td class="source">          prevTokenType === _t.COMMA ||</td></tr><tr><td class="line">271</td><td class="hits"></td><td class="source">          prevTokenType === token.type ||</td></tr><tr><td class="line">272</td><td class="hits"></td><td class="source">          prevTokenType === _t.BRACKETOPEN ||</td></tr><tr><td class="line">273</td><td class="hits"></td><td class="source">          prevTokenType === _t.CURLYOPEN ||</td></tr><tr><td class="line">274</td><td class="hits"></td><td class="source">          prevTokenType === _t.PARENOPEN ||</td></tr><tr><td class="line">275</td><td class="hits"></td><td class="source">          prevTokenType === _t.FUNCTION) {</td></tr><tr class="hit"><td class="line">276</td><td class="hits">1</td><td class="source">        utils.throwError('Unexpected logic', self.line, self.filename);</td></tr><tr><td class="line">277</td><td class="hits"></td><td class="source">      }</td></tr><tr class="hit"><td class="line">278</td><td class="hits">5</td><td class="source">      self.out.push(token.match);</td></tr><tr class="hit"><td class="line">279</td><td class="hits">5</td><td class="source">      break;</td></tr><tr><td class="line">280</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">281</td><td class="hits"></td><td class="source">    case _t.NOT:</td></tr><tr class="hit"><td class="line">282</td><td class="hits">2</td><td class="source">      self.out.push(token.match);</td></tr><tr class="hit"><td class="line">283</td><td class="hits">2</td><td class="source">      break;</td></tr><tr><td class="line">284</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">285</td><td class="hits"></td><td class="source">    case _t.VAR:</td></tr><tr class="hit"><td class="line">286</td><td class="hits">437</td><td class="source">      self.parseVar(token, match, lastState);</td></tr><tr class="hit"><td class="line">287</td><td class="hits">410</td><td class="source">      break;</td></tr><tr><td class="line">288</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">289</td><td class="hits"></td><td class="source">    case _t.BRACKETOPEN:</td></tr><tr class="hit"><td class="line">290</td><td class="hits">19</td><td class="source">      if (!prevToken ||</td></tr><tr><td class="line">291</td><td class="hits"></td><td class="source">          (prevTokenType !== _t.VAR &amp;&amp;</td></tr><tr><td class="line">292</td><td class="hits"></td><td class="source">            prevTokenType !== _t.BRACKETCLOSE &amp;&amp;</td></tr><tr><td class="line">293</td><td class="hits"></td><td class="source">            prevTokenType !== _t.PARENCLOSE)) {</td></tr><tr class="hit"><td class="line">294</td><td class="hits">5</td><td class="source">        self.state.push(_t.ARRAYOPEN);</td></tr><tr class="hit"><td class="line">295</td><td class="hits">5</td><td class="source">        self.filterApplyIdx.push(self.out.length);</td></tr><tr><td class="line">296</td><td class="hits"></td><td class="source">      } else {</td></tr><tr class="hit"><td class="line">297</td><td class="hits">14</td><td class="source">        self.state.push(token.type);</td></tr><tr><td class="line">298</td><td class="hits"></td><td class="source">      }</td></tr><tr class="hit"><td class="line">299</td><td class="hits">19</td><td class="source">      self.out.push('[');</td></tr><tr class="hit"><td class="line">300</td><td class="hits">19</td><td class="source">      break;</td></tr><tr><td class="line">301</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">302</td><td class="hits"></td><td class="source">    case _t.BRACKETCLOSE:</td></tr><tr class="hit"><td class="line">303</td><td class="hits">19</td><td class="source">      temp = self.state.pop();</td></tr><tr class="hit"><td class="line">304</td><td class="hits">19</td><td class="source">      if (temp !== _t.BRACKETOPEN &amp;&amp; temp !== _t.ARRAYOPEN) {</td></tr><tr class="hit"><td class="line">305</td><td class="hits">1</td><td class="source">        utils.throwError('Unexpected closing square bracket', self.line, self.filename);</td></tr><tr><td class="line">306</td><td class="hits"></td><td class="source">      }</td></tr><tr class="hit"><td class="line">307</td><td class="hits">18</td><td class="source">      self.out.push(']');</td></tr><tr class="hit"><td class="line">308</td><td class="hits">18</td><td class="source">      self.filterApplyIdx.pop();</td></tr><tr class="hit"><td class="line">309</td><td class="hits">18</td><td class="source">      break;</td></tr><tr><td class="line">310</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">311</td><td class="hits"></td><td class="source">    case _t.CURLYOPEN:</td></tr><tr class="hit"><td class="line">312</td><td class="hits">7</td><td class="source">      self.state.push(token.type);</td></tr><tr class="hit"><td class="line">313</td><td class="hits">7</td><td class="source">      self.out.push('{');</td></tr><tr class="hit"><td class="line">314</td><td class="hits">7</td><td class="source">      self.filterApplyIdx.push(self.out.length - 1);</td></tr><tr class="hit"><td class="line">315</td><td class="hits">7</td><td class="source">      break;</td></tr><tr><td class="line">316</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">317</td><td class="hits"></td><td class="source">    case _t.COLON:</td></tr><tr class="hit"><td class="line">318</td><td class="hits">12</td><td class="source">      if (lastState !== _t.CURLYOPEN) {</td></tr><tr class="hit"><td class="line">319</td><td class="hits">1</td><td class="source">        utils.throwError('Unexpected colon', self.line, self.filename);</td></tr><tr><td class="line">320</td><td class="hits"></td><td class="source">      }</td></tr><tr class="hit"><td class="line">321</td><td class="hits">11</td><td class="source">      self.state.push(token.type);</td></tr><tr class="hit"><td class="line">322</td><td class="hits">11</td><td class="source">      self.out.push(':');</td></tr><tr class="hit"><td class="line">323</td><td class="hits">11</td><td class="source">      self.filterApplyIdx.pop();</td></tr><tr class="hit"><td class="line">324</td><td class="hits">11</td><td class="source">      break;</td></tr><tr><td class="line">325</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">326</td><td class="hits"></td><td class="source">    case _t.CURLYCLOSE:</td></tr><tr class="hit"><td class="line">327</td><td class="hits">7</td><td class="source">      if (lastState === _t.COLON) {</td></tr><tr class="hit"><td class="line">328</td><td class="hits">6</td><td class="source">        self.state.pop();</td></tr><tr><td class="line">329</td><td class="hits"></td><td class="source">      }</td></tr><tr class="hit"><td class="line">330</td><td class="hits">7</td><td class="source">      if (self.state.pop() !== _t.CURLYOPEN) {</td></tr><tr class="hit"><td class="line">331</td><td class="hits">1</td><td class="source">        utils.throwError('Unexpected closing curly brace', self.line, self.filename);</td></tr><tr><td class="line">332</td><td class="hits"></td><td class="source">      }</td></tr><tr class="hit"><td class="line">333</td><td class="hits">6</td><td class="source">      self.out.push('}');</td></tr><tr><td class="line">334</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">335</td><td class="hits">6</td><td class="source">      self.filterApplyIdx.pop();</td></tr><tr class="hit"><td class="line">336</td><td class="hits">6</td><td class="source">      break;</td></tr><tr><td class="line">337</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">338</td><td class="hits"></td><td class="source">    case _t.DOTKEY:</td></tr><tr class="hit"><td class="line">339</td><td class="hits">8</td><td class="source">      if (!prevToken || (</td></tr><tr><td class="line">340</td><td class="hits"></td><td class="source">          prevTokenType !== _t.VAR &amp;&amp;</td></tr><tr><td class="line">341</td><td class="hits"></td><td class="source">          prevTokenType !== _t.BRACKETCLOSE &amp;&amp;</td></tr><tr><td class="line">342</td><td class="hits"></td><td class="source">          prevTokenType !== _t.DOTKEY &amp;&amp;</td></tr><tr><td class="line">343</td><td class="hits"></td><td class="source">          prevTokenType !== _t.PARENCLOSE &amp;&amp;</td></tr><tr><td class="line">344</td><td class="hits"></td><td class="source">          prevTokenType !== _t.FUNCTIONEMPTY &amp;&amp;</td></tr><tr><td class="line">345</td><td class="hits"></td><td class="source">          prevTokenType !== _t.FILTEREMPTY &amp;&amp;</td></tr><tr><td class="line">346</td><td class="hits"></td><td class="source">          prevTokenType !== _t.CURLYCLOSE</td></tr><tr><td class="line">347</td><td class="hits"></td><td class="source">        )) {</td></tr><tr class="hit"><td class="line">348</td><td class="hits">1</td><td class="source">        utils.throwError('Unexpected key &quot;' + match + '&quot;', self.line, self.filename);</td></tr><tr><td class="line">349</td><td class="hits"></td><td class="source">      }</td></tr><tr class="hit"><td class="line">350</td><td class="hits">7</td><td class="source">      self.out.push('.' + match);</td></tr><tr class="hit"><td class="line">351</td><td class="hits">7</td><td class="source">      break;</td></tr><tr><td class="line">352</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">353</td><td class="hits"></td><td class="source">    case _t.OPERATOR:</td></tr><tr class="hit"><td class="line">354</td><td class="hits">8</td><td class="source">      self.out.push(' ' + match + ' ');</td></tr><tr class="hit"><td class="line">355</td><td class="hits">8</td><td class="source">      self.filterApplyIdx.pop();</td></tr><tr class="hit"><td class="line">356</td><td class="hits">8</td><td class="source">      break;</td></tr><tr><td class="line">357</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">358</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">359</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">360</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">361</td><td class="hits"></td><td class="source">   * Parse variable token</td></tr><tr><td class="line">362</td><td class="hits"></td><td class="source">   * @param  {{match: string, type: number, line: number}} token      Lexer token object.</td></tr><tr><td class="line">363</td><td class="hits"></td><td class="source">   * @param  {string} match       Shortcut for token.match</td></tr><tr><td class="line">364</td><td class="hits"></td><td class="source">   * @param  {number} lastState   Lexer token type state.</td></tr><tr><td class="line">365</td><td class="hits"></td><td class="source">   * @return {undefined}</td></tr><tr><td class="line">366</td><td class="hits"></td><td class="source">   * @private</td></tr><tr><td class="line">367</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">368</td><td class="hits"></td><td class="source">  parseVar: function (token, match, lastState) {</td></tr><tr class="hit"><td class="line">369</td><td class="hits">437</td><td class="source">    var self = this;</td></tr><tr><td class="line">370</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">371</td><td class="hits">437</td><td class="source">    match = match.split('.');</td></tr><tr><td class="line">372</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">373</td><td class="hits">437</td><td class="source">    if (_reserved.indexOf(match[0]) !== -1) {</td></tr><tr class="hit"><td class="line">374</td><td class="hits">26</td><td class="source">      utils.throwError('Reserved keyword &quot;' + match[0] + '&quot; attempted to be used as a variable', self.line, self.filename);</td></tr><tr><td class="line">375</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">376</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">377</td><td class="hits">411</td><td class="source">    self.filterApplyIdx.push(self.out.length);</td></tr><tr class="hit"><td class="line">378</td><td class="hits">411</td><td class="source">    if (lastState === _t.CURLYOPEN) {</td></tr><tr class="hit"><td class="line">379</td><td class="hits">10</td><td class="source">      if (match.length &gt; 1) {</td></tr><tr class="hit"><td class="line">380</td><td class="hits">1</td><td class="source">        utils.throwError('Unexpected dot', self.line, self.filename);</td></tr><tr><td class="line">381</td><td class="hits"></td><td class="source">      }</td></tr><tr class="hit"><td class="line">382</td><td class="hits">9</td><td class="source">      self.out.push(match[0]);</td></tr><tr class="hit"><td class="line">383</td><td class="hits">9</td><td class="source">      return;</td></tr><tr><td class="line">384</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">385</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">386</td><td class="hits">401</td><td class="source">    self.out.push(self.checkMatch(match));</td></tr><tr><td class="line">387</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">388</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">389</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">390</td><td class="hits"></td><td class="source">   * Return contextual dot-check string for a match</td></tr><tr><td class="line">391</td><td class="hits"></td><td class="source">   * @param  {string} match       Shortcut for token.match</td></tr><tr><td class="line">392</td><td class="hits"></td><td class="source">   * @private</td></tr><tr><td class="line">393</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">394</td><td class="hits"></td><td class="source">  checkMatch: function (match) {</td></tr><tr class="hit"><td class="line">395</td><td class="hits">420</td><td class="source">    var temp = match[0], result;</td></tr><tr><td class="line">396</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">397</td><td class="hits">420</td><td class="source">    function checkDot(ctx) {</td></tr><tr class="hit"><td class="line">398</td><td class="hits">1260</td><td class="source">      var c = ctx + temp,</td></tr><tr><td class="line">399</td><td class="hits"></td><td class="source">        m = match,</td></tr><tr><td class="line">400</td><td class="hits"></td><td class="source">        build = '';</td></tr><tr><td class="line">401</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">402</td><td class="hits">1260</td><td class="source">      build = '(typeof ' + c + ' !== &quot;undefined&quot; &amp;&amp; ' + c + ' !== null';</td></tr><tr class="hit"><td class="line">403</td><td class="hits">1260</td><td class="source">      utils.each(m, function (v, i) {</td></tr><tr class="hit"><td class="line">404</td><td class="hits">1404</td><td class="source">        if (i === 0) {</td></tr><tr class="hit"><td class="line">405</td><td class="hits">1260</td><td class="source">          return;</td></tr><tr><td class="line">406</td><td class="hits"></td><td class="source">        }</td></tr><tr class="hit"><td class="line">407</td><td class="hits">144</td><td class="source">        build += ' &amp;&amp; ' + c + '.' + v + ' !== undefined &amp;&amp; ' + c + '.' + v + ' !== null';</td></tr><tr class="hit"><td class="line">408</td><td class="hits">144</td><td class="source">        c += '.' + v;</td></tr><tr><td class="line">409</td><td class="hits"></td><td class="source">      });</td></tr><tr class="hit"><td class="line">410</td><td class="hits">1260</td><td class="source">      build += ')';</td></tr><tr><td class="line">411</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">412</td><td class="hits">1260</td><td class="source">      return build;</td></tr><tr><td class="line">413</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">414</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">415</td><td class="hits">420</td><td class="source">    function buildDot(ctx) {</td></tr><tr class="hit"><td class="line">416</td><td class="hits">840</td><td class="source">      return '(' + checkDot(ctx) + ' ? ' + ctx + match.join('.') + ' : &quot;&quot;)';</td></tr><tr><td class="line">417</td><td class="hits"></td><td class="source">    }</td></tr><tr class="hit"><td class="line">418</td><td class="hits">420</td><td class="source">    result = '(' + checkDot('_ctx.') + ' ? ' + buildDot('_ctx.') + ' : ' + buildDot('') + ')';</td></tr><tr class="hit"><td class="line">419</td><td class="hits">420</td><td class="source">    return '(' + result + ' !== null ? ' + result + ' : ' + '&quot;&quot; )';</td></tr><tr><td class="line">420</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">421</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">422</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">423</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">424</td><td class="hits"></td><td class="source"> * Parse a source string into tokens that are ready for compilation.</td></tr><tr><td class="line">425</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">426</td><td class="hits"></td><td class="source"> * @example</td></tr><tr><td class="line">427</td><td class="hits"></td><td class="source"> * exports.parse('{{ tacos }}', {}, tags, filters);</td></tr><tr><td class="line">428</td><td class="hits"></td><td class="source"> * // =&gt; [{ compile: [Function], ... }]</td></tr><tr><td class="line">429</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">430</td><td class="hits"></td><td class="source"> * @params {object} swig    The current Swig instance</td></tr><tr><td class="line">431</td><td class="hits"></td><td class="source"> * @param  {string} source  Swig template source.</td></tr><tr><td class="line">432</td><td class="hits"></td><td class="source"> * @param  {object} opts    Swig options object.</td></tr><tr><td class="line">433</td><td class="hits"></td><td class="source"> * @param  {object} tags    Keyed object of tags that can be parsed and compiled.</td></tr><tr><td class="line">434</td><td class="hits"></td><td class="source"> * @param  {object} filters Keyed object of filters that may be applied to variables.</td></tr><tr><td class="line">435</td><td class="hits"></td><td class="source"> * @return {array}          List of tokens ready for compilation.</td></tr><tr><td class="line">436</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">437</td><td class="hits">1</td><td class="source">exports.parse = function (swig, source, opts, tags, filters) {</td></tr><tr class="hit"><td class="line">438</td><td class="hits">462</td><td class="source">  source = source.replace(/\r\n/g, '\n');</td></tr><tr class="hit"><td class="line">439</td><td class="hits">462</td><td class="source">  var escape = opts.autoescape,</td></tr><tr><td class="line">440</td><td class="hits"></td><td class="source">    tagOpen = opts.tagControls[0],</td></tr><tr><td class="line">441</td><td class="hits"></td><td class="source">    tagClose = opts.tagControls[1],</td></tr><tr><td class="line">442</td><td class="hits"></td><td class="source">    varOpen = opts.varControls[0],</td></tr><tr><td class="line">443</td><td class="hits"></td><td class="source">    varClose = opts.varControls[1],</td></tr><tr><td class="line">444</td><td class="hits"></td><td class="source">    escapedTagOpen = escapeRegExp(tagOpen),</td></tr><tr><td class="line">445</td><td class="hits"></td><td class="source">    escapedTagClose = escapeRegExp(tagClose),</td></tr><tr><td class="line">446</td><td class="hits"></td><td class="source">    escapedVarOpen = escapeRegExp(varOpen),</td></tr><tr><td class="line">447</td><td class="hits"></td><td class="source">    escapedVarClose = escapeRegExp(varClose),</td></tr><tr><td class="line">448</td><td class="hits"></td><td class="source">    tagStrip = new RegExp('^' + escapedTagOpen + '-?\\s*-?|-?\\s*-?' + escapedTagClose + '$', 'g'),</td></tr><tr><td class="line">449</td><td class="hits"></td><td class="source">    tagStripBefore = new RegExp('^' + escapedTagOpen + '-'),</td></tr><tr><td class="line">450</td><td class="hits"></td><td class="source">    tagStripAfter = new RegExp('-' + escapedTagClose + '$'),</td></tr><tr><td class="line">451</td><td class="hits"></td><td class="source">    varStrip = new RegExp('^' + escapedVarOpen + '-?\\s*-?|-?\\s*-?' + escapedVarClose + '$', 'g'),</td></tr><tr><td class="line">452</td><td class="hits"></td><td class="source">    varStripBefore = new RegExp('^' + escapedVarOpen + '-'),</td></tr><tr><td class="line">453</td><td class="hits"></td><td class="source">    varStripAfter = new RegExp('-' + escapedVarClose + '$'),</td></tr><tr><td class="line">454</td><td class="hits"></td><td class="source">    cmtOpen = opts.cmtControls[0],</td></tr><tr><td class="line">455</td><td class="hits"></td><td class="source">    cmtClose = opts.cmtControls[1],</td></tr><tr><td class="line">456</td><td class="hits"></td><td class="source">    anyChar = '[\\s\\S]*?',</td></tr><tr><td class="line">457</td><td class="hits"></td><td class="source">    // Split the template source based on variable, tag, and comment blocks</td></tr><tr><td class="line">458</td><td class="hits"></td><td class="source">    // /(\{%[\s\S]*?%\}|\{\{[\s\S]*?\}\}|\{#[\s\S]*?#\})/</td></tr><tr><td class="line">459</td><td class="hits"></td><td class="source">    splitter = new RegExp(</td></tr><tr><td class="line">460</td><td class="hits"></td><td class="source">      '(' +</td></tr><tr><td class="line">461</td><td class="hits"></td><td class="source">        escapedTagOpen + anyChar + escapedTagClose + '|' +</td></tr><tr><td class="line">462</td><td class="hits"></td><td class="source">        escapedVarOpen + anyChar + escapedVarClose + '|' +</td></tr><tr><td class="line">463</td><td class="hits"></td><td class="source">        escapeRegExp(cmtOpen) + anyChar + escapeRegExp(cmtClose) +</td></tr><tr><td class="line">464</td><td class="hits"></td><td class="source">        ')'</td></tr><tr><td class="line">465</td><td class="hits"></td><td class="source">    ),</td></tr><tr><td class="line">466</td><td class="hits"></td><td class="source">    line = 1,</td></tr><tr><td class="line">467</td><td class="hits"></td><td class="source">    stack = [],</td></tr><tr><td class="line">468</td><td class="hits"></td><td class="source">    parent = null,</td></tr><tr><td class="line">469</td><td class="hits"></td><td class="source">    tokens = [],</td></tr><tr><td class="line">470</td><td class="hits"></td><td class="source">    blocks = {},</td></tr><tr><td class="line">471</td><td class="hits"></td><td class="source">    inRaw = false,</td></tr><tr><td class="line">472</td><td class="hits"></td><td class="source">    stripNext;</td></tr><tr><td class="line">473</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">474</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">475</td><td class="hits"></td><td class="source">   * Parse a variable.</td></tr><tr><td class="line">476</td><td class="hits"></td><td class="source">   * @param  {string} str  String contents of the variable, between &lt;i&gt;{{&lt;/i&gt; and &lt;i&gt;}}&lt;/i&gt;</td></tr><tr><td class="line">477</td><td class="hits"></td><td class="source">   * @param  {number} line The line number that this variable starts on.</td></tr><tr><td class="line">478</td><td class="hits"></td><td class="source">   * @return {VarToken}      Parsed variable token object.</td></tr><tr><td class="line">479</td><td class="hits"></td><td class="source">   * @private</td></tr><tr><td class="line">480</td><td class="hits"></td><td class="source">   */</td></tr><tr class="hit"><td class="line">481</td><td class="hits">462</td><td class="source">  function parseVariable(str, line) {</td></tr><tr class="hit"><td class="line">482</td><td class="hits">357</td><td class="source">    var tokens = lexer.read(utils.strip(str)),</td></tr><tr><td class="line">483</td><td class="hits"></td><td class="source">      parser,</td></tr><tr><td class="line">484</td><td class="hits"></td><td class="source">      out;</td></tr><tr><td class="line">485</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">486</td><td class="hits">357</td><td class="source">    parser = new TokenParser(tokens, filters, escape, line, opts.filename);</td></tr><tr class="hit"><td class="line">487</td><td class="hits">357</td><td class="source">    out = parser.parse().join('');</td></tr><tr><td class="line">488</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">489</td><td class="hits">321</td><td class="source">    if (parser.state.length) {</td></tr><tr class="hit"><td class="line">490</td><td class="hits">2</td><td class="source">      utils.throwError('Unable to parse &quot;' + str + '&quot;', line, opts.filename);</td></tr><tr><td class="line">491</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">492</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">493</td><td class="hits"></td><td class="source">    /**</td></tr><tr><td class="line">494</td><td class="hits"></td><td class="source">     * A parsed variable token.</td></tr><tr><td class="line">495</td><td class="hits"></td><td class="source">     * @typedef {object} VarToken</td></tr><tr><td class="line">496</td><td class="hits"></td><td class="source">     * @property {function} compile Method for compiling this token.</td></tr><tr><td class="line">497</td><td class="hits"></td><td class="source">     */</td></tr><tr class="hit"><td class="line">498</td><td class="hits">319</td><td class="source">    return {</td></tr><tr><td class="line">499</td><td class="hits"></td><td class="source">      compile: function () {</td></tr><tr class="hit"><td class="line">500</td><td class="hits">315</td><td class="source">        return '_output += ' + out + ';\n';</td></tr><tr><td class="line">501</td><td class="hits"></td><td class="source">      }</td></tr><tr><td class="line">502</td><td class="hits"></td><td class="source">    };</td></tr><tr><td class="line">503</td><td class="hits"></td><td class="source">  }</td></tr><tr class="hit"><td class="line">504</td><td class="hits">462</td><td class="source">  exports.parseVariable = parseVariable;</td></tr><tr><td class="line">505</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">506</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">507</td><td class="hits"></td><td class="source">   * Parse a tag.</td></tr><tr><td class="line">508</td><td class="hits"></td><td class="source">   * @param  {string} str  String contents of the tag, between &lt;i&gt;{%&lt;/i&gt; and &lt;i&gt;%}&lt;/i&gt;</td></tr><tr><td class="line">509</td><td class="hits"></td><td class="source">   * @param  {number} line The line number that this tag starts on.</td></tr><tr><td class="line">510</td><td class="hits"></td><td class="source">   * @return {TagToken}      Parsed token object.</td></tr><tr><td class="line">511</td><td class="hits"></td><td class="source">   * @private</td></tr><tr><td class="line">512</td><td class="hits"></td><td class="source">   */</td></tr><tr class="hit"><td class="line">513</td><td class="hits">462</td><td class="source">  function parseTag(str, line) {</td></tr><tr class="hit"><td class="line">514</td><td class="hits">492</td><td class="source">    var tokens, parser, chunks, tagName, tag, args, last;</td></tr><tr><td class="line">515</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">516</td><td class="hits">492</td><td class="source">    if (utils.startsWith(str, 'end')) {</td></tr><tr class="hit"><td class="line">517</td><td class="hits">182</td><td class="source">      last = stack[stack.length - 1];</td></tr><tr class="hit"><td class="line">518</td><td class="hits">182</td><td class="source">      if (last &amp;&amp; last.name === str.split(/\s+/)[0].replace(/^end/, '') &amp;&amp; last.ends) {</td></tr><tr class="hit"><td class="line">519</td><td class="hits">180</td><td class="source">        switch (last.name) {</td></tr><tr><td class="line">520</td><td class="hits"></td><td class="source">        case 'autoescape':</td></tr><tr class="hit"><td class="line">521</td><td class="hits">9</td><td class="source">          escape = opts.autoescape;</td></tr><tr class="hit"><td class="line">522</td><td class="hits">9</td><td class="source">          break;</td></tr><tr><td class="line">523</td><td class="hits"></td><td class="source">        case 'raw':</td></tr><tr class="hit"><td class="line">524</td><td class="hits">4</td><td class="source">          inRaw = false;</td></tr><tr class="hit"><td class="line">525</td><td class="hits">4</td><td class="source">          break;</td></tr><tr><td class="line">526</td><td class="hits"></td><td class="source">        }</td></tr><tr class="hit"><td class="line">527</td><td class="hits">180</td><td class="source">        stack.pop();</td></tr><tr class="hit"><td class="line">528</td><td class="hits">180</td><td class="source">        return;</td></tr><tr><td class="line">529</td><td class="hits"></td><td class="source">      }</td></tr><tr><td class="line">530</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">531</td><td class="hits">2</td><td class="source">      if (!inRaw) {</td></tr><tr class="hit"><td class="line">532</td><td class="hits">1</td><td class="source">        utils.throwError('Unexpected end of tag &quot;' + str.replace(/^end/, '') + '&quot;', line, opts.filename);</td></tr><tr><td class="line">533</td><td class="hits"></td><td class="source">      }</td></tr><tr><td class="line">534</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">535</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">536</td><td class="hits">311</td><td class="source">    if (inRaw) {</td></tr><tr class="hit"><td class="line">537</td><td class="hits">3</td><td class="source">      return;</td></tr><tr><td class="line">538</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">539</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">540</td><td class="hits">308</td><td class="source">    chunks = str.split(/\s+(.+)?/);</td></tr><tr class="hit"><td class="line">541</td><td class="hits">308</td><td class="source">    tagName = chunks.shift();</td></tr><tr><td class="line">542</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">543</td><td class="hits">308</td><td class="source">    if (!tags.hasOwnProperty(tagName)) {</td></tr><tr class="hit"><td class="line">544</td><td class="hits">1</td><td class="source">      utils.throwError('Unexpected tag &quot;' + str + '&quot;', line, opts.filename);</td></tr><tr><td class="line">545</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">546</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">547</td><td class="hits">307</td><td class="source">    tokens = lexer.read(utils.strip(chunks.join(' ')));</td></tr><tr class="hit"><td class="line">548</td><td class="hits">307</td><td class="source">    parser = new TokenParser(tokens, filters, false, line, opts.filename);</td></tr><tr class="hit"><td class="line">549</td><td class="hits">307</td><td class="source">    tag = tags[tagName];</td></tr><tr><td class="line">550</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">551</td><td class="hits"></td><td class="source">    /**</td></tr><tr><td class="line">552</td><td class="hits"></td><td class="source">     * Define custom parsing methods for your tag.</td></tr><tr><td class="line">553</td><td class="hits"></td><td class="source">     * @callback parse</td></tr><tr><td class="line">554</td><td class="hits"></td><td class="source">     *</td></tr><tr><td class="line">555</td><td class="hits"></td><td class="source">     * @example</td></tr><tr><td class="line">556</td><td class="hits"></td><td class="source">     * exports.parse = function (str, line, parser, types, options, swig) {</td></tr><tr><td class="line">557</td><td class="hits"></td><td class="source">     *   parser.on('start', function () {</td></tr><tr><td class="line">558</td><td class="hits"></td><td class="source">     *     // ...</td></tr><tr><td class="line">559</td><td class="hits"></td><td class="source">     *   });</td></tr><tr><td class="line">560</td><td class="hits"></td><td class="source">     *   parser.on(types.STRING, function (token) {</td></tr><tr><td class="line">561</td><td class="hits"></td><td class="source">     *     // ...</td></tr><tr><td class="line">562</td><td class="hits"></td><td class="source">     *   });</td></tr><tr><td class="line">563</td><td class="hits"></td><td class="source">     * };</td></tr><tr><td class="line">564</td><td class="hits"></td><td class="source">     *</td></tr><tr><td class="line">565</td><td class="hits"></td><td class="source">     * @param {string} str The full token string of the tag.</td></tr><tr><td class="line">566</td><td class="hits"></td><td class="source">     * @param {number} line The line number that this tag appears on.</td></tr><tr><td class="line">567</td><td class="hits"></td><td class="source">     * @param {TokenParser} parser A TokenParser instance.</td></tr><tr><td class="line">568</td><td class="hits"></td><td class="source">     * @param {TYPES} types Lexer token type enum.</td></tr><tr><td class="line">569</td><td class="hits"></td><td class="source">     * @param {TagToken[]} stack The current stack of open tags.</td></tr><tr><td class="line">570</td><td class="hits"></td><td class="source">     * @param {SwigOpts} options Swig Options Object.</td></tr><tr><td class="line">571</td><td class="hits"></td><td class="source">     * @param {object} swig The Swig instance (gives acces to loaders, parsers, etc)</td></tr><tr><td class="line">572</td><td class="hits"></td><td class="source">     */</td></tr><tr class="hit"><td class="line">573</td><td class="hits">307</td><td class="source">    if (!tag.parse(chunks[1], line, parser, _t, stack, opts, swig)) {</td></tr><tr class="hit"><td class="line">574</td><td class="hits">2</td><td class="source">      utils.throwError('Unexpected tag &quot;' + tagName + '&quot;', line, opts.filename);</td></tr><tr><td class="line">575</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">576</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">577</td><td class="hits">303</td><td class="source">    parser.parse();</td></tr><tr class="hit"><td class="line">578</td><td class="hits">281</td><td class="source">    args = parser.out;</td></tr><tr><td class="line">579</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">580</td><td class="hits">281</td><td class="source">    switch (tagName) {</td></tr><tr><td class="line">581</td><td class="hits"></td><td class="source">    case 'autoescape':</td></tr><tr class="hit"><td class="line">582</td><td class="hits">9</td><td class="source">      escape = (args[0] !== 'false') ? args[0] : false;</td></tr><tr class="hit"><td class="line">583</td><td class="hits">9</td><td class="source">      break;</td></tr><tr><td class="line">584</td><td class="hits"></td><td class="source">    case 'raw':</td></tr><tr class="hit"><td class="line">585</td><td class="hits">4</td><td class="source">      inRaw = true;</td></tr><tr class="hit"><td class="line">586</td><td class="hits">4</td><td class="source">      break;</td></tr><tr><td class="line">587</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">588</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">589</td><td class="hits"></td><td class="source">    /**</td></tr><tr><td class="line">590</td><td class="hits"></td><td class="source">     * A parsed tag token.</td></tr><tr><td class="line">591</td><td class="hits"></td><td class="source">     * @typedef {Object} TagToken</td></tr><tr><td class="line">592</td><td class="hits"></td><td class="source">     * @property {compile} [compile] Method for compiling this token.</td></tr><tr><td class="line">593</td><td class="hits"></td><td class="source">     * @property {array} [args] Array of arguments for the tag.</td></tr><tr><td class="line">594</td><td class="hits"></td><td class="source">     * @property {Token[]} [content=[]] An array of tokens that are children of this Token.</td></tr><tr><td class="line">595</td><td class="hits"></td><td class="source">     * @property {boolean} [ends] Whether or not this tag requires an end tag.</td></tr><tr><td class="line">596</td><td class="hits"></td><td class="source">     * @property {string} name The name of this tag.</td></tr><tr><td class="line">597</td><td class="hits"></td><td class="source">     */</td></tr><tr class="hit"><td class="line">598</td><td class="hits">281</td><td class="source">    return {</td></tr><tr><td class="line">599</td><td class="hits"></td><td class="source">      block: !!tags[tagName].block,</td></tr><tr><td class="line">600</td><td class="hits"></td><td class="source">      compile: tag.compile,</td></tr><tr><td class="line">601</td><td class="hits"></td><td class="source">      args: args,</td></tr><tr><td class="line">602</td><td class="hits"></td><td class="source">      content: [],</td></tr><tr><td class="line">603</td><td class="hits"></td><td class="source">      ends: tag.ends,</td></tr><tr><td class="line">604</td><td class="hits"></td><td class="source">      name: tagName</td></tr><tr><td class="line">605</td><td class="hits"></td><td class="source">    };</td></tr><tr><td class="line">606</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">607</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">608</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">609</td><td class="hits"></td><td class="source">   * Strip the whitespace from the previous token, if it is a string.</td></tr><tr><td class="line">610</td><td class="hits"></td><td class="source">   * @param  {object} token Parsed token.</td></tr><tr><td class="line">611</td><td class="hits"></td><td class="source">   * @return {object}       If the token was a string, trailing whitespace will be stripped.</td></tr><tr><td class="line">612</td><td class="hits"></td><td class="source">   */</td></tr><tr class="hit"><td class="line">613</td><td class="hits">462</td><td class="source">  function stripPrevToken(token) {</td></tr><tr class="hit"><td class="line">614</td><td class="hits">10</td><td class="source">    if (typeof token === 'string') {</td></tr><tr class="hit"><td class="line">615</td><td class="hits">8</td><td class="source">      token = token.replace(/\s*$/, '');</td></tr><tr><td class="line">616</td><td class="hits"></td><td class="source">    }</td></tr><tr class="hit"><td class="line">617</td><td class="hits">10</td><td class="source">    return token;</td></tr><tr><td class="line">618</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">619</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">620</td><td class="hits"></td><td class="source">  /*!</td></tr><tr><td class="line">621</td><td class="hits"></td><td class="source">   * Loop over the source, split via the tag/var/comment regular expression splitter.</td></tr><tr><td class="line">622</td><td class="hits"></td><td class="source">   * Send each chunk to the appropriate parser.</td></tr><tr><td class="line">623</td><td class="hits"></td><td class="source">   */</td></tr><tr class="hit"><td class="line">624</td><td class="hits">462</td><td class="source">  utils.each(source.split(splitter), function (chunk) {</td></tr><tr class="hit"><td class="line">625</td><td class="hits">2112</td><td class="source">    var token, lines, stripPrev, prevToken, prevChildToken;</td></tr><tr><td class="line">626</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">627</td><td class="hits">2112</td><td class="source">    if (!chunk) {</td></tr><tr class="hit"><td class="line">628</td><td class="hits">908</td><td class="source">      return;</td></tr><tr><td class="line">629</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">630</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">631</td><td class="hits"></td><td class="source">    // Is a variable?</td></tr><tr class="hit"><td class="line">632</td><td class="hits">1204</td><td class="source">    if (!inRaw &amp;&amp; utils.startsWith(chunk, varOpen) &amp;&amp; utils.endsWith(chunk, varClose)) {</td></tr><tr class="hit"><td class="line">633</td><td class="hits">357</td><td class="source">      stripPrev = varStripBefore.test(chunk);</td></tr><tr class="hit"><td class="line">634</td><td class="hits">357</td><td class="source">      stripNext = varStripAfter.test(chunk);</td></tr><tr class="hit"><td class="line">635</td><td class="hits">357</td><td class="source">      token = parseVariable(chunk.replace(varStrip, ''), line);</td></tr><tr><td class="line">636</td><td class="hits"></td><td class="source">    // Is a tag?</td></tr><tr class="hit"><td class="line">637</td><td class="hits">847</td><td class="source">    } else if (utils.startsWith(chunk, tagOpen) &amp;&amp; utils.endsWith(chunk, tagClose)) {</td></tr><tr class="hit"><td class="line">638</td><td class="hits">492</td><td class="source">      stripPrev = tagStripBefore.test(chunk);</td></tr><tr class="hit"><td class="line">639</td><td class="hits">492</td><td class="source">      stripNext = tagStripAfter.test(chunk);</td></tr><tr class="hit"><td class="line">640</td><td class="hits">492</td><td class="source">      token = parseTag(chunk.replace(tagStrip, ''), line);</td></tr><tr class="hit"><td class="line">641</td><td class="hits">464</td><td class="source">      if (token) {</td></tr><tr class="hit"><td class="line">642</td><td class="hits">281</td><td class="source">        if (token.name === 'extends') {</td></tr><tr class="hit"><td class="line">643</td><td class="hits">26</td><td class="source">          parent = token.args.join('').replace(/^\'|\'$/g, '').replace(/^\&quot;|\&quot;$/g, '');</td></tr><tr class="hit"><td class="line">644</td><td class="hits">255</td><td class="source">        } else if (token.block &amp;&amp; !stack.length) {</td></tr><tr class="hit"><td class="line">645</td><td class="hits">114</td><td class="source">          blocks[token.args.join('')] = token;</td></tr><tr><td class="line">646</td><td class="hits"></td><td class="source">        }</td></tr><tr><td class="line">647</td><td class="hits"></td><td class="source">      }</td></tr><tr class="hit"><td class="line">648</td><td class="hits">464</td><td class="source">      if (inRaw &amp;&amp; !token) {</td></tr><tr class="hit"><td class="line">649</td><td class="hits">3</td><td class="source">        token = chunk;</td></tr><tr><td class="line">650</td><td class="hits"></td><td class="source">      }</td></tr><tr><td class="line">651</td><td class="hits"></td><td class="source">    // Is a content string?</td></tr><tr class="hit"><td class="line">652</td><td class="hits">355</td><td class="source">    } else if (inRaw || (!utils.startsWith(chunk, cmtOpen) &amp;&amp; !utils.endsWith(chunk, cmtClose))) {</td></tr><tr class="hit"><td class="line">653</td><td class="hits">348</td><td class="source">      token = (stripNext) ? chunk.replace(/^\s*/, '') : chunk;</td></tr><tr class="hit"><td class="line">654</td><td class="hits">348</td><td class="source">      stripNext = false;</td></tr><tr class="hit"><td class="line">655</td><td class="hits">7</td><td class="source">    } else if (utils.startsWith(chunk, cmtOpen) &amp;&amp; utils.endsWith(chunk, cmtClose)) {</td></tr><tr class="hit"><td class="line">656</td><td class="hits">7</td><td class="source">      return;</td></tr><tr><td class="line">657</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">658</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">659</td><td class="hits"></td><td class="source">    // Did this tag ask to strip previous whitespace? &lt;code&gt;{%- ... %}&lt;/code&gt; or &lt;code&gt;{{- ... }}&lt;/code&gt;</td></tr><tr class="hit"><td class="line">660</td><td class="hits">1131</td><td class="source">    if (stripPrev &amp;&amp; tokens.length) {</td></tr><tr class="hit"><td class="line">661</td><td class="hits">10</td><td class="source">      prevToken = tokens.pop();</td></tr><tr class="hit"><td class="line">662</td><td class="hits">10</td><td class="source">      if (typeof prevToken === 'string') {</td></tr><tr class="hit"><td class="line">663</td><td class="hits">4</td><td class="source">        prevToken = stripPrevToken(prevToken);</td></tr><tr class="hit"><td class="line">664</td><td class="hits">6</td><td class="source">      } else if (prevToken.content &amp;&amp; prevToken.content.length) {</td></tr><tr class="hit"><td class="line">665</td><td class="hits">6</td><td class="source">        prevChildToken = stripPrevToken(prevToken.content.pop());</td></tr><tr class="hit"><td class="line">666</td><td class="hits">6</td><td class="source">        prevToken.content.push(prevChildToken);</td></tr><tr><td class="line">667</td><td class="hits"></td><td class="source">      }</td></tr><tr class="hit"><td class="line">668</td><td class="hits">10</td><td class="source">      tokens.push(prevToken);</td></tr><tr><td class="line">669</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">670</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">671</td><td class="hits"></td><td class="source">    // This was a comment, so let's just keep going.</td></tr><tr class="hit"><td class="line">672</td><td class="hits">1131</td><td class="source">    if (!token) {</td></tr><tr class="hit"><td class="line">673</td><td class="hits">186</td><td class="source">      return;</td></tr><tr><td class="line">674</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">675</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">676</td><td class="hits"></td><td class="source">    // If there's an open item in the stack, add this to its content.</td></tr><tr class="hit"><td class="line">677</td><td class="hits">945</td><td class="source">    if (stack.length) {</td></tr><tr class="hit"><td class="line">678</td><td class="hits">273</td><td class="source">      stack[stack.length - 1].content.push(token);</td></tr><tr><td class="line">679</td><td class="hits"></td><td class="source">    } else {</td></tr><tr class="hit"><td class="line">680</td><td class="hits">672</td><td class="source">      tokens.push(token);</td></tr><tr><td class="line">681</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">682</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">683</td><td class="hits"></td><td class="source">    // If the token is a tag that requires an end tag, open it on the stack.</td></tr><tr class="hit"><td class="line">684</td><td class="hits">945</td><td class="source">    if (token.name &amp;&amp; token.ends) {</td></tr><tr class="hit"><td class="line">685</td><td class="hits">183</td><td class="source">      stack.push(token);</td></tr><tr><td class="line">686</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">687</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">688</td><td class="hits">945</td><td class="source">    lines = chunk.match(/\n/g);</td></tr><tr class="hit"><td class="line">689</td><td class="hits">945</td><td class="source">    line += (lines) ? lines.length : 0;</td></tr><tr><td class="line">690</td><td class="hits"></td><td class="source">  });</td></tr><tr><td class="line">691</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">692</td><td class="hits">396</td><td class="source">  return {</td></tr><tr><td class="line">693</td><td class="hits"></td><td class="source">    name: opts.filename,</td></tr><tr><td class="line">694</td><td class="hits"></td><td class="source">    parent: parent,</td></tr><tr><td class="line">695</td><td class="hits"></td><td class="source">    tokens: tokens,</td></tr><tr><td class="line">696</td><td class="hits"></td><td class="source">    blocks: blocks</td></tr><tr><td class="line">697</td><td class="hits"></td><td class="source">  };</td></tr><tr><td class="line">698</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">699</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">700</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">701</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">702</td><td class="hits"></td><td class="source"> * Compile an array of tokens.</td></tr><tr><td class="line">703</td><td class="hits"></td><td class="source"> * @param  {Token[]} template     An array of template tokens.</td></tr><tr><td class="line">704</td><td class="hits"></td><td class="source"> * @param  {Templates[]} parents  Array of parent templates.</td></tr><tr><td class="line">705</td><td class="hits"></td><td class="source"> * @param  {SwigOpts} [options]   Swig options object.</td></tr><tr><td class="line">706</td><td class="hits"></td><td class="source"> * @param  {string} [blockName]   Name of the current block context.</td></tr><tr><td class="line">707</td><td class="hits"></td><td class="source"> * @return {string}               Partial for a compiled JavaScript method that will output a rendered template.</td></tr><tr><td class="line">708</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">709</td><td class="hits">1</td><td class="source">exports.compile = function (template, parents, options, blockName) {</td></tr><tr class="hit"><td class="line">710</td><td class="hits">525</td><td class="source">  var out = '',</td></tr><tr><td class="line">711</td><td class="hits"></td><td class="source">    tokens = utils.isArray(template) ? template : template.tokens;</td></tr><tr><td class="line">712</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">713</td><td class="hits">525</td><td class="source">  utils.each(tokens, function (token) {</td></tr><tr class="hit"><td class="line">714</td><td class="hits">789</td><td class="source">    var o;</td></tr><tr class="hit"><td class="line">715</td><td class="hits">789</td><td class="source">    if (typeof token === 'string') {</td></tr><tr class="hit"><td class="line">716</td><td class="hits">262</td><td class="source">      out += '_output += &quot;' + token.replace(/\\/g, '\\\\').replace(/\n|\r/g, '\\n').replace(/&quot;/g, '\\&quot;') + '&quot;;\n';</td></tr><tr class="hit"><td class="line">717</td><td class="hits">262</td><td class="source">      return;</td></tr><tr><td class="line">718</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">719</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">720</td><td class="hits"></td><td class="source">    /**</td></tr><tr><td class="line">721</td><td class="hits"></td><td class="source">     * Compile callback for VarToken and TagToken objects.</td></tr><tr><td class="line">722</td><td class="hits"></td><td class="source">     * @callback compile</td></tr><tr><td class="line">723</td><td class="hits"></td><td class="source">     *</td></tr><tr><td class="line">724</td><td class="hits"></td><td class="source">     * @example</td></tr><tr><td class="line">725</td><td class="hits"></td><td class="source">     * exports.compile = function (compiler, args, content, parents, options, blockName) {</td></tr><tr><td class="line">726</td><td class="hits"></td><td class="source">     *   if (args[0] === 'foo') {</td></tr><tr><td class="line">727</td><td class="hits"></td><td class="source">     *     return compiler(content, parents, options, blockName) + '\n';</td></tr><tr><td class="line">728</td><td class="hits"></td><td class="source">     *   }</td></tr><tr><td class="line">729</td><td class="hits"></td><td class="source">     *   return '_output += &quot;fallback&quot;;\n';</td></tr><tr><td class="line">730</td><td class="hits"></td><td class="source">     * };</td></tr><tr><td class="line">731</td><td class="hits"></td><td class="source">     *</td></tr><tr><td class="line">732</td><td class="hits"></td><td class="source">     * @param {parserCompiler} compiler</td></tr><tr><td class="line">733</td><td class="hits"></td><td class="source">     * @param {array} [args] Array of parsed arguments on the for the token.</td></tr><tr><td class="line">734</td><td class="hits"></td><td class="source">     * @param {array} [content] Array of content within the token.</td></tr><tr><td class="line">735</td><td class="hits"></td><td class="source">     * @param {array} [parents] Array of parent templates for the current template context.</td></tr><tr><td class="line">736</td><td class="hits"></td><td class="source">     * @param {SwigOpts} [options] Swig Options Object</td></tr><tr><td class="line">737</td><td class="hits"></td><td class="source">     * @param {string} [blockName] Name of the direct block parent, if any.</td></tr><tr><td class="line">738</td><td class="hits"></td><td class="source">     */</td></tr><tr class="hit"><td class="line">739</td><td class="hits">527</td><td class="source">    o = token.compile(exports.compile, token.args ? token.args.slice(0) : [], token.content ? token.content.slice(0) : [], parents, options, blockName);</td></tr><tr class="hit"><td class="line">740</td><td class="hits">527</td><td class="source">    out += o || '';</td></tr><tr><td class="line">741</td><td class="hits"></td><td class="source">  });</td></tr><tr><td class="line">742</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">743</td><td class="hits">525</td><td class="source">  return out;</td></tr><tr><td class="line">744</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">745</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="/lib/swig.js">/lib/swig.js</h2><div id="stats" class="high"><div class="percentage">99%</div><div class="sloc">212</div><div class="hits">211</div><div class="misses">1</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr class="hit"><td class="line">1</td><td class="hits">1</td><td class="source">var utils = require('./utils'),</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source">  _tags = require('./tags'),</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source">  _filters = require('./filters'),</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source">  parser = require('./parser'),</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source">  dateformatter = require('./dateformatter'),</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source">  loaders = require('./loaders');</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * Swig version number as a string.</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> * @example</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> * if (swig.version === &quot;1.4.2&quot;) { ... }</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source"> * @type {String}</td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">15</td><td class="hits">1</td><td class="source">exports.version = &quot;1.4.2&quot;;</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source"> * Swig Options Object. This object can be passed to many of the API-level Swig methods to control various aspects of the engine. All keys are optional.</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source"> * @typedef {Object} SwigOpts</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> * @property {boolean} autoescape  Controls whether or not variable output will automatically be escaped for safe HTML output. Defaults to &lt;code data-language=&quot;js&quot;&gt;true&lt;/code&gt;. Functions executed in variable statements will not be auto-escaped. Your application/functions should take care of their own auto-escaping.</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source"> * @property {array}   varControls Open and close controls for variables. Defaults to &lt;code data-language=&quot;js&quot;&gt;['{{', '}}']&lt;/code&gt;.</td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source"> * @property {array}   tagControls Open and close controls for tags. Defaults to &lt;code data-language=&quot;js&quot;&gt;['{%', '%}']&lt;/code&gt;.</td></tr><tr><td class="line">23</td><td class="hits"></td><td class="source"> * @property {array}   cmtControls Open and close controls for comments. Defaults to &lt;code data-language=&quot;js&quot;&gt;['{#', '#}']&lt;/code&gt;.</td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source"> * @property {object}  locals      Default variable context to be passed to &lt;strong&gt;all&lt;/strong&gt; templates.</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source"> * @property {CacheOptions} cache Cache control for templates. Defaults to saving in &lt;code data-language=&quot;js&quot;&gt;'memory'&lt;/code&gt;. Send &lt;code data-language=&quot;js&quot;&gt;false&lt;/code&gt; to disable. Send an object with &lt;code data-language=&quot;js&quot;&gt;get&lt;/code&gt; and &lt;code data-language=&quot;js&quot;&gt;set&lt;/code&gt; functions to customize.</td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source"> * @property {TemplateLoader} loader The method that Swig will use to load templates. Defaults to &lt;var&gt;swig.loaders.fs&lt;/var&gt;.</td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">28</td><td class="hits">1</td><td class="source">var defaultOptions = {</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source">    autoescape: true,</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source">    varControls: ['{{', '}}'],</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source">    tagControls: ['{%', '%}'],</td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source">    cmtControls: ['{#', '#}'],</td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source">    locals: {},</td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source">    /**</td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source">     * Cache control for templates. Defaults to saving all templates into memory.</td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source">     * @typedef {boolean|string|object} CacheOptions</td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source">     * @example</td></tr><tr><td class="line">38</td><td class="hits"></td><td class="source">     * // Default</td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source">     * swig.setDefaults({ cache: 'memory' });</td></tr><tr><td class="line">40</td><td class="hits"></td><td class="source">     * @example</td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source">     * // Disables caching in Swig.</td></tr><tr><td class="line">42</td><td class="hits"></td><td class="source">     * swig.setDefaults({ cache: false });</td></tr><tr><td class="line">43</td><td class="hits"></td><td class="source">     * @example</td></tr><tr><td class="line">44</td><td class="hits"></td><td class="source">     * // Custom cache storage and retrieval</td></tr><tr><td class="line">45</td><td class="hits"></td><td class="source">     * swig.setDefaults({</td></tr><tr><td class="line">46</td><td class="hits"></td><td class="source">     *   cache: {</td></tr><tr><td class="line">47</td><td class="hits"></td><td class="source">     *     get: function (key) { ... },</td></tr><tr><td class="line">48</td><td class="hits"></td><td class="source">     *     set: function (key, val) { ... }</td></tr><tr><td class="line">49</td><td class="hits"></td><td class="source">     *   }</td></tr><tr><td class="line">50</td><td class="hits"></td><td class="source">     * });</td></tr><tr><td class="line">51</td><td class="hits"></td><td class="source">     */</td></tr><tr><td class="line">52</td><td class="hits"></td><td class="source">    cache: 'memory',</td></tr><tr><td class="line">53</td><td class="hits"></td><td class="source">    /**</td></tr><tr><td class="line">54</td><td class="hits"></td><td class="source">     * Configure Swig to use either the &lt;var&gt;swig.loaders.fs&lt;/var&gt; or &lt;var&gt;swig.loaders.memory&lt;/var&gt; template loader. Or, you can write your own!</td></tr><tr><td class="line">55</td><td class="hits"></td><td class="source">     * For more information, please see the &lt;a href=&quot;../loaders/&quot;&gt;Template Loaders documentation&lt;/a&gt;.</td></tr><tr><td class="line">56</td><td class="hits"></td><td class="source">     * @typedef {class} TemplateLoader</td></tr><tr><td class="line">57</td><td class="hits"></td><td class="source">     * @example</td></tr><tr><td class="line">58</td><td class="hits"></td><td class="source">     * // Default, FileSystem loader</td></tr><tr><td class="line">59</td><td class="hits"></td><td class="source">     * swig.setDefaults({ loader: swig.loaders.fs() });</td></tr><tr><td class="line">60</td><td class="hits"></td><td class="source">     * @example</td></tr><tr><td class="line">61</td><td class="hits"></td><td class="source">     * // FileSystem loader allowing a base path</td></tr><tr><td class="line">62</td><td class="hits"></td><td class="source">     * // With this, you don't use relative URLs in your template references</td></tr><tr><td class="line">63</td><td class="hits"></td><td class="source">     * swig.setDefaults({ loader: swig.loaders.fs(__dirname + '/templates') });</td></tr><tr><td class="line">64</td><td class="hits"></td><td class="source">     * @example</td></tr><tr><td class="line">65</td><td class="hits"></td><td class="source">     * // Memory Loader</td></tr><tr><td class="line">66</td><td class="hits"></td><td class="source">     * swig.setDefaults({ loader: swig.loaders.memory({</td></tr><tr><td class="line">67</td><td class="hits"></td><td class="source">     *   layout: '{% block foo %}{% endblock %}',</td></tr><tr><td class="line">68</td><td class="hits"></td><td class="source">     *   page1: '{% extends &quot;layout&quot; %}{% block foo %}Tacos!{% endblock %}'</td></tr><tr><td class="line">69</td><td class="hits"></td><td class="source">     * })});</td></tr><tr><td class="line">70</td><td class="hits"></td><td class="source">     */</td></tr><tr><td class="line">71</td><td class="hits"></td><td class="source">    loader: loaders.fs()</td></tr><tr><td class="line">72</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">73</td><td class="hits"></td><td class="source">  defaultInstance;</td></tr><tr><td class="line">74</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">75</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">76</td><td class="hits"></td><td class="source"> * Empty function, used in templates.</td></tr><tr><td class="line">77</td><td class="hits"></td><td class="source"> * @return {string} Empty string</td></tr><tr><td class="line">78</td><td class="hits"></td><td class="source"> * @private</td></tr><tr><td class="line">79</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">80</td><td class="hits">2</td><td class="source">function efn() { return ''; }</td></tr><tr><td class="line">81</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">82</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">83</td><td class="hits"></td><td class="source"> * Validate the Swig options object.</td></tr><tr><td class="line">84</td><td class="hits"></td><td class="source"> * @param  {?SwigOpts} options Swig options object.</td></tr><tr><td class="line">85</td><td class="hits"></td><td class="source"> * @return {undefined}      This method will throw errors if anything is wrong.</td></tr><tr><td class="line">86</td><td class="hits"></td><td class="source"> * @private</td></tr><tr><td class="line">87</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">88</td><td class="hits">1</td><td class="source">function validateOptions(options) {</td></tr><tr class="hit"><td class="line">89</td><td class="hits">848</td><td class="source">  if (!options) {</td></tr><tr class="hit"><td class="line">90</td><td class="hits">89</td><td class="source">    return;</td></tr><tr><td class="line">91</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">92</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">93</td><td class="hits">759</td><td class="source">  utils.each(['varControls', 'tagControls', 'cmtControls'], function (key) {</td></tr><tr class="hit"><td class="line">94</td><td class="hits">2262</td><td class="source">    if (!options.hasOwnProperty(key)) {</td></tr><tr class="hit"><td class="line">95</td><td class="hits">1235</td><td class="source">      return;</td></tr><tr><td class="line">96</td><td class="hits"></td><td class="source">    }</td></tr><tr class="hit"><td class="line">97</td><td class="hits">1027</td><td class="source">    if (!utils.isArray(options[key]) || options[key].length !== 2) {</td></tr><tr class="hit"><td class="line">98</td><td class="hits">6</td><td class="source">      throw new Error('Option &quot;' + key + '&quot; must be an array containing 2 different control strings.');</td></tr><tr><td class="line">99</td><td class="hits"></td><td class="source">    }</td></tr><tr class="hit"><td class="line">100</td><td class="hits">1021</td><td class="source">    if (options[key][0] === options[key][1]) {</td></tr><tr class="hit"><td class="line">101</td><td class="hits">3</td><td class="source">      throw new Error('Option &quot;' + key + '&quot; open and close controls must not be the same.');</td></tr><tr><td class="line">102</td><td class="hits"></td><td class="source">    }</td></tr><tr class="hit"><td class="line">103</td><td class="hits">1018</td><td class="source">    utils.each(options[key], function (a, i) {</td></tr><tr class="hit"><td class="line">104</td><td class="hits">2033</td><td class="source">      if (a.length &lt; 2) {</td></tr><tr class="hit"><td class="line">105</td><td class="hits">6</td><td class="source">        throw new Error('Option &quot;' + key + '&quot; ' + ((i) ? 'open ' : 'close ') + 'control must be at least 2 characters. Saw &quot;' + a + '&quot; instead.');</td></tr><tr><td class="line">106</td><td class="hits"></td><td class="source">      }</td></tr><tr><td class="line">107</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">108</td><td class="hits"></td><td class="source">  });</td></tr><tr><td class="line">109</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">110</td><td class="hits">744</td><td class="source">  if (options.hasOwnProperty('cache')) {</td></tr><tr class="hit"><td class="line">111</td><td class="hits">340</td><td class="source">    if (options.cache &amp;&amp; options.cache !== 'memory') {</td></tr><tr class="hit"><td class="line">112</td><td class="hits">3</td><td class="source">      if (!options.cache.get || !options.cache.set) {</td></tr><tr class="hit"><td class="line">113</td><td class="hits">2</td><td class="source">        throw new Error('Invalid cache option ' + JSON.stringify(options.cache) + ' found. Expected &quot;memory&quot; or { get: function (key) { ... }, set: function (key, value) { ... } }.');</td></tr><tr><td class="line">114</td><td class="hits"></td><td class="source">      }</td></tr><tr><td class="line">115</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">116</td><td class="hits"></td><td class="source">  }</td></tr><tr class="hit"><td class="line">117</td><td class="hits">742</td><td class="source">  if (options.hasOwnProperty('loader')) {</td></tr><tr class="hit"><td class="line">118</td><td class="hits">346</td><td class="source">    if (options.loader) {</td></tr><tr class="hit"><td class="line">119</td><td class="hits">346</td><td class="source">      if (!options.loader.load || !options.loader.resolve) {</td></tr><tr class="hit"><td class="line">120</td><td class="hits">3</td><td class="source">        throw new Error('Invalid loader option ' + JSON.stringify(options.loader) + ' found. Expected { load: function (pathname, cb) { ... }, resolve: function (to, from) { ... } }.');</td></tr><tr><td class="line">121</td><td class="hits"></td><td class="source">      }</td></tr><tr><td class="line">122</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">123</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">124</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">125</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">126</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">127</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">128</td><td class="hits"></td><td class="source"> * Set defaults for the base and all new Swig environments.</td></tr><tr><td class="line">129</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">130</td><td class="hits"></td><td class="source"> * @example</td></tr><tr><td class="line">131</td><td class="hits"></td><td class="source"> * swig.setDefaults({ cache: false });</td></tr><tr><td class="line">132</td><td class="hits"></td><td class="source"> * // =&gt; Disables Cache</td></tr><tr><td class="line">133</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">134</td><td class="hits"></td><td class="source"> * @example</td></tr><tr><td class="line">135</td><td class="hits"></td><td class="source"> * swig.setDefaults({ locals: { now: function () { return new Date(); } }});</td></tr><tr><td class="line">136</td><td class="hits"></td><td class="source"> * // =&gt; sets a globally accessible method for all template</td></tr><tr><td class="line">137</td><td class="hits"></td><td class="source"> * //    contexts, allowing you to print the current date</td></tr><tr><td class="line">138</td><td class="hits"></td><td class="source"> * // =&gt; {{ now()|date('F jS, Y') }}</td></tr><tr><td class="line">139</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">140</td><td class="hits"></td><td class="source"> * @param  {SwigOpts} [options={}] Swig options object.</td></tr><tr><td class="line">141</td><td class="hits"></td><td class="source"> * @return {undefined}</td></tr><tr><td class="line">142</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">143</td><td class="hits">1</td><td class="source">exports.setDefaults = function (options) {</td></tr><tr class="hit"><td class="line">144</td><td class="hits">344</td><td class="source">  validateOptions(options);</td></tr><tr class="hit"><td class="line">145</td><td class="hits">340</td><td class="source">  defaultInstance.options = utils.extend(defaultInstance.options, options);</td></tr><tr><td class="line">146</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">147</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">148</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">149</td><td class="hits"></td><td class="source"> * Set the default TimeZone offset for date formatting via the date filter. This is a global setting and will affect all Swig environments, old or new.</td></tr><tr><td class="line">150</td><td class="hits"></td><td class="source"> * @param  {number} offset Offset from GMT, in minutes.</td></tr><tr><td class="line">151</td><td class="hits"></td><td class="source"> * @return {undefined}</td></tr><tr><td class="line">152</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">153</td><td class="hits">1</td><td class="source">exports.setDefaultTZOffset = function (offset) {</td></tr><tr class="hit"><td class="line">154</td><td class="hits">2</td><td class="source">  dateformatter.tzOffset = offset;</td></tr><tr><td class="line">155</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">156</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">157</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">158</td><td class="hits"></td><td class="source"> * Create a new, separate Swig compile/render environment.</td></tr><tr><td class="line">159</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">160</td><td class="hits"></td><td class="source"> * @example</td></tr><tr><td class="line">161</td><td class="hits"></td><td class="source"> * var swig = require('swig');</td></tr><tr><td class="line">162</td><td class="hits"></td><td class="source"> * var myswig = new swig.Swig({varControls: ['&lt;%=', '%&gt;']});</td></tr><tr><td class="line">163</td><td class="hits"></td><td class="source"> * myswig.render('Tacos are &lt;%= tacos =&gt;!', { locals: { tacos: 'delicious' }});</td></tr><tr><td class="line">164</td><td class="hits"></td><td class="source"> * // =&gt; Tacos are delicious!</td></tr><tr><td class="line">165</td><td class="hits"></td><td class="source"> * swig.render('Tacos are &lt;%= tacos =&gt;!', { locals: { tacos: 'delicious' }});</td></tr><tr><td class="line">166</td><td class="hits"></td><td class="source"> * // =&gt; 'Tacos are &lt;%= tacos =&gt;!'</td></tr><tr><td class="line">167</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">168</td><td class="hits"></td><td class="source"> * @param  {SwigOpts} [opts={}] Swig options object.</td></tr><tr><td class="line">169</td><td class="hits"></td><td class="source"> * @return {object}      New Swig environment.</td></tr><tr><td class="line">170</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">171</td><td class="hits">1</td><td class="source">exports.Swig = function (opts) {</td></tr><tr class="hit"><td class="line">172</td><td class="hits">27</td><td class="source">  validateOptions(opts);</td></tr><tr class="hit"><td class="line">173</td><td class="hits">26</td><td class="source">  this.options = utils.extend({}, defaultOptions, opts || {});</td></tr><tr class="hit"><td class="line">174</td><td class="hits">26</td><td class="source">  this.cache = {};</td></tr><tr class="hit"><td class="line">175</td><td class="hits">26</td><td class="source">  this.extensions = {};</td></tr><tr class="hit"><td class="line">176</td><td class="hits">26</td><td class="source">  var self = this,</td></tr><tr><td class="line">177</td><td class="hits"></td><td class="source">    tags = _tags,</td></tr><tr><td class="line">178</td><td class="hits"></td><td class="source">    filters = _filters;</td></tr><tr><td class="line">179</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">180</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">181</td><td class="hits"></td><td class="source">   * Get combined locals context.</td></tr><tr><td class="line">182</td><td class="hits"></td><td class="source">   * @param  {?SwigOpts} [options] Swig options object.</td></tr><tr><td class="line">183</td><td class="hits"></td><td class="source">   * @return {object}         Locals context.</td></tr><tr><td class="line">184</td><td class="hits"></td><td class="source">   * @private</td></tr><tr><td class="line">185</td><td class="hits"></td><td class="source">   */</td></tr><tr class="hit"><td class="line">186</td><td class="hits">26</td><td class="source">  function getLocals(options) {</td></tr><tr class="hit"><td class="line">187</td><td class="hits">914</td><td class="source">    if (!options || !options.locals) {</td></tr><tr class="hit"><td class="line">188</td><td class="hits">343</td><td class="source">      return self.options.locals;</td></tr><tr><td class="line">189</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">190</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">191</td><td class="hits">571</td><td class="source">    return utils.extend({}, self.options.locals, options.locals);</td></tr><tr><td class="line">192</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">193</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">194</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">195</td><td class="hits"></td><td class="source">   * Determine whether caching is enabled via the options provided and/or defaults</td></tr><tr><td class="line">196</td><td class="hits"></td><td class="source">   * @param  {SwigOpts} [options={}] Swig Options Object</td></tr><tr><td class="line">197</td><td class="hits"></td><td class="source">   * @return {boolean}</td></tr><tr><td class="line">198</td><td class="hits"></td><td class="source">   * @private</td></tr><tr><td class="line">199</td><td class="hits"></td><td class="source">   */</td></tr><tr class="hit"><td class="line">200</td><td class="hits">26</td><td class="source">  function shouldCache(options) {</td></tr><tr class="hit"><td class="line">201</td><td class="hits">5018</td><td class="source">    options = options || {};</td></tr><tr class="hit"><td class="line">202</td><td class="hits">5018</td><td class="source">    return (options.hasOwnProperty('cache') &amp;&amp; !options.cache) || !self.options.cache;</td></tr><tr><td class="line">203</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">204</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">205</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">206</td><td class="hits"></td><td class="source">   * Get compiled template from the cache.</td></tr><tr><td class="line">207</td><td class="hits"></td><td class="source">   * @param  {string} key           Name of template.</td></tr><tr><td class="line">208</td><td class="hits"></td><td class="source">   * @return {object|undefined}     Template function and tokens.</td></tr><tr><td class="line">209</td><td class="hits"></td><td class="source">   * @private</td></tr><tr><td class="line">210</td><td class="hits"></td><td class="source">   */</td></tr><tr class="hit"><td class="line">211</td><td class="hits">26</td><td class="source">  function cacheGet(key, options) {</td></tr><tr class="hit"><td class="line">212</td><td class="hits">4978</td><td class="source">    if (shouldCache(options)) {</td></tr><tr class="hit"><td class="line">213</td><td class="hits">3</td><td class="source">      return;</td></tr><tr><td class="line">214</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">215</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">216</td><td class="hits">4975</td><td class="source">    if (self.options.cache === 'memory') {</td></tr><tr class="hit"><td class="line">217</td><td class="hits">4974</td><td class="source">      return self.cache[key];</td></tr><tr><td class="line">218</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">219</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">220</td><td class="hits">1</td><td class="source">    return self.options.cache.get(key);</td></tr><tr><td class="line">221</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">222</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">223</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">224</td><td class="hits"></td><td class="source">   * Store a template in the cache.</td></tr><tr><td class="line">225</td><td class="hits"></td><td class="source">   * @param  {string} key Name of template.</td></tr><tr><td class="line">226</td><td class="hits"></td><td class="source">   * @param  {object} val Template function and tokens.</td></tr><tr><td class="line">227</td><td class="hits"></td><td class="source">   * @return {undefined}</td></tr><tr><td class="line">228</td><td class="hits"></td><td class="source">   * @private</td></tr><tr><td class="line">229</td><td class="hits"></td><td class="source">   */</td></tr><tr class="hit"><td class="line">230</td><td class="hits">26</td><td class="source">  function cacheSet(key, options, val) {</td></tr><tr class="hit"><td class="line">231</td><td class="hits">40</td><td class="source">    if (shouldCache(options)) {</td></tr><tr class="hit"><td class="line">232</td><td class="hits">3</td><td class="source">      return;</td></tr><tr><td class="line">233</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">234</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">235</td><td class="hits">37</td><td class="source">    if (self.options.cache === 'memory') {</td></tr><tr class="hit"><td class="line">236</td><td class="hits">36</td><td class="source">      self.cache[key] = val;</td></tr><tr class="hit"><td class="line">237</td><td class="hits">36</td><td class="source">      return;</td></tr><tr><td class="line">238</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">239</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">240</td><td class="hits">1</td><td class="source">    self.options.cache.set(key, val);</td></tr><tr><td class="line">241</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">242</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">243</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">244</td><td class="hits"></td><td class="source">   * Clears the in-memory template cache.</td></tr><tr><td class="line">245</td><td class="hits"></td><td class="source">   *</td></tr><tr><td class="line">246</td><td class="hits"></td><td class="source">   * @example</td></tr><tr><td class="line">247</td><td class="hits"></td><td class="source">   * swig.invalidateCache();</td></tr><tr><td class="line">248</td><td class="hits"></td><td class="source">   *</td></tr><tr><td class="line">249</td><td class="hits"></td><td class="source">   * @return {undefined}</td></tr><tr><td class="line">250</td><td class="hits"></td><td class="source">   */</td></tr><tr class="hit"><td class="line">251</td><td class="hits">26</td><td class="source">  this.invalidateCache = function () {</td></tr><tr class="hit"><td class="line">252</td><td class="hits">334</td><td class="source">    if (self.options.cache === 'memory') {</td></tr><tr class="hit"><td class="line">253</td><td class="hits">334</td><td class="source">      self.cache = {};</td></tr><tr><td class="line">254</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">255</td><td class="hits"></td><td class="source">  };</td></tr><tr><td class="line">256</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">257</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">258</td><td class="hits"></td><td class="source">   * Add a custom filter for swig variables.</td></tr><tr><td class="line">259</td><td class="hits"></td><td class="source">   *</td></tr><tr><td class="line">260</td><td class="hits"></td><td class="source">   * @example</td></tr><tr><td class="line">261</td><td class="hits"></td><td class="source">   * function replaceMs(input) { return input.replace(/m/g, 'f'); }</td></tr><tr><td class="line">262</td><td class="hits"></td><td class="source">   * swig.setFilter('replaceMs', replaceMs);</td></tr><tr><td class="line">263</td><td class="hits"></td><td class="source">   * // =&gt; {{ &quot;onomatopoeia&quot;|replaceMs }}</td></tr><tr><td class="line">264</td><td class="hits"></td><td class="source">   * // =&gt; onofatopeia</td></tr><tr><td class="line">265</td><td class="hits"></td><td class="source">   *</td></tr><tr><td class="line">266</td><td class="hits"></td><td class="source">   * @param {string}    name    Name of filter, used in templates. &lt;strong&gt;Will&lt;/strong&gt; overwrite previously defined filters, if using the same name.</td></tr><tr><td class="line">267</td><td class="hits"></td><td class="source">   * @param {function}  method  Function that acts against the input. See &lt;a href=&quot;/docs/filters/#custom&quot;&gt;Custom Filters&lt;/a&gt; for more information.</td></tr><tr><td class="line">268</td><td class="hits"></td><td class="source">   * @return {undefined}</td></tr><tr><td class="line">269</td><td class="hits"></td><td class="source">   */</td></tr><tr class="hit"><td class="line">270</td><td class="hits">26</td><td class="source">  this.setFilter = function (name, method) {</td></tr><tr class="hit"><td class="line">271</td><td class="hits">3</td><td class="source">    if (typeof method !== &quot;function&quot;) {</td></tr><tr class="hit"><td class="line">272</td><td class="hits">1</td><td class="source">      throw new Error('Filter &quot;' + name + '&quot; is not a valid function.');</td></tr><tr><td class="line">273</td><td class="hits"></td><td class="source">    }</td></tr><tr class="hit"><td class="line">274</td><td class="hits">2</td><td class="source">    filters[name] = method;</td></tr><tr><td class="line">275</td><td class="hits"></td><td class="source">  };</td></tr><tr><td class="line">276</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">277</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">278</td><td class="hits"></td><td class="source">   * Add a custom tag. To expose your own extensions to compiled template code, see &lt;code data-language=&quot;js&quot;&gt;swig.setExtension&lt;/code&gt;.</td></tr><tr><td class="line">279</td><td class="hits"></td><td class="source">   *</td></tr><tr><td class="line">280</td><td class="hits"></td><td class="source">   * For a more in-depth explanation of writing custom tags, see &lt;a href=&quot;../extending/#tags&quot;&gt;Custom Tags&lt;/a&gt;.</td></tr><tr><td class="line">281</td><td class="hits"></td><td class="source">   *</td></tr><tr><td class="line">282</td><td class="hits"></td><td class="source">   * @example</td></tr><tr><td class="line">283</td><td class="hits"></td><td class="source">   * var tacotag = require('./tacotag');</td></tr><tr><td class="line">284</td><td class="hits"></td><td class="source">   * swig.setTag('tacos', tacotag.parse, tacotag.compile, tacotag.ends, tacotag.blockLevel);</td></tr><tr><td class="line">285</td><td class="hits"></td><td class="source">   * // =&gt; {% tacos %}Make this be tacos.{% endtacos %}</td></tr><tr><td class="line">286</td><td class="hits"></td><td class="source">   * // =&gt; Tacos tacos tacos tacos.</td></tr><tr><td class="line">287</td><td class="hits"></td><td class="source">   *</td></tr><tr><td class="line">288</td><td class="hits"></td><td class="source">   * @param  {string} name      Tag name.</td></tr><tr><td class="line">289</td><td class="hits"></td><td class="source">   * @param  {function} parse   Method for parsing tokens.</td></tr><tr><td class="line">290</td><td class="hits"></td><td class="source">   * @param  {function} compile Method for compiling renderable output.</td></tr><tr><td class="line">291</td><td class="hits"></td><td class="source">   * @param  {boolean} [ends=false]     Whether or not this tag requires an &lt;i&gt;end&lt;/i&gt; tag.</td></tr><tr><td class="line">292</td><td class="hits"></td><td class="source">   * @param  {boolean} [blockLevel=false] If false, this tag will not be compiled outside of &lt;code&gt;block&lt;/code&gt; tags when extending a parent template.</td></tr><tr><td class="line">293</td><td class="hits"></td><td class="source">   * @return {undefined}</td></tr><tr><td class="line">294</td><td class="hits"></td><td class="source">   */</td></tr><tr class="hit"><td class="line">295</td><td class="hits">26</td><td class="source">  this.setTag = function (name, parse, compile, ends, blockLevel) {</td></tr><tr class="hit"><td class="line">296</td><td class="hits">4</td><td class="source">    if (typeof parse !== 'function') {</td></tr><tr class="hit"><td class="line">297</td><td class="hits">1</td><td class="source">      throw new Error('Tag &quot;' + name + '&quot; parse method is not a valid function.');</td></tr><tr><td class="line">298</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">299</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">300</td><td class="hits">3</td><td class="source">    if (typeof compile !== 'function') {</td></tr><tr class="hit"><td class="line">301</td><td class="hits">1</td><td class="source">      throw new Error('Tag &quot;' + name + '&quot; compile method is not a valid function.');</td></tr><tr><td class="line">302</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">303</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">304</td><td class="hits">2</td><td class="source">    tags[name] = {</td></tr><tr><td class="line">305</td><td class="hits"></td><td class="source">      parse: parse,</td></tr><tr><td class="line">306</td><td class="hits"></td><td class="source">      compile: compile,</td></tr><tr><td class="line">307</td><td class="hits"></td><td class="source">      ends: ends || false,</td></tr><tr><td class="line">308</td><td class="hits"></td><td class="source">      block: !!blockLevel</td></tr><tr><td class="line">309</td><td class="hits"></td><td class="source">    };</td></tr><tr><td class="line">310</td><td class="hits"></td><td class="source">  };</td></tr><tr><td class="line">311</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">312</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">313</td><td class="hits"></td><td class="source">   * Add extensions for custom tags. This allows any custom tag to access a globally available methods via a special globally available object, &lt;var&gt;_ext&lt;/var&gt;, in templates.</td></tr><tr><td class="line">314</td><td class="hits"></td><td class="source">   *</td></tr><tr><td class="line">315</td><td class="hits"></td><td class="source">   * @example</td></tr><tr><td class="line">316</td><td class="hits"></td><td class="source">   * swig.setExtension('trans', function (v) { return translate(v); });</td></tr><tr><td class="line">317</td><td class="hits"></td><td class="source">   * function compileTrans(compiler, args, content, parent, options) {</td></tr><tr><td class="line">318</td><td class="hits"></td><td class="source">   *   return '_output += _ext.trans(' + args[0] + ');'</td></tr><tr><td class="line">319</td><td class="hits"></td><td class="source">   * };</td></tr><tr><td class="line">320</td><td class="hits"></td><td class="source">   * swig.setTag('trans', parseTrans, compileTrans, true);</td></tr><tr><td class="line">321</td><td class="hits"></td><td class="source">   *</td></tr><tr><td class="line">322</td><td class="hits"></td><td class="source">   * @param  {string} name   Key name of the extension. Accessed via &lt;code data-language=&quot;js&quot;&gt;_ext[name]&lt;/code&gt;.</td></tr><tr><td class="line">323</td><td class="hits"></td><td class="source">   * @param  {*}      object The method, value, or object that should be available via the given name.</td></tr><tr><td class="line">324</td><td class="hits"></td><td class="source">   * @return {undefined}</td></tr><tr><td class="line">325</td><td class="hits"></td><td class="source">   */</td></tr><tr class="hit"><td class="line">326</td><td class="hits">26</td><td class="source">  this.setExtension = function (name, object) {</td></tr><tr class="hit"><td class="line">327</td><td class="hits">1</td><td class="source">    self.extensions[name] = object;</td></tr><tr><td class="line">328</td><td class="hits"></td><td class="source">  };</td></tr><tr><td class="line">329</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">330</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">331</td><td class="hits"></td><td class="source">   * Parse a given source string into tokens.</td></tr><tr><td class="line">332</td><td class="hits"></td><td class="source">   *</td></tr><tr><td class="line">333</td><td class="hits"></td><td class="source">   * @param  {string} source  Swig template source.</td></tr><tr><td class="line">334</td><td class="hits"></td><td class="source">   * @param  {SwigOpts} [options={}] Swig options object.</td></tr><tr><td class="line">335</td><td class="hits"></td><td class="source">   * @return {object} parsed  Template tokens object.</td></tr><tr><td class="line">336</td><td class="hits"></td><td class="source">   * @private</td></tr><tr><td class="line">337</td><td class="hits"></td><td class="source">   */</td></tr><tr class="hit"><td class="line">338</td><td class="hits">26</td><td class="source">  this.parse = function (source, options) {</td></tr><tr class="hit"><td class="line">339</td><td class="hits">477</td><td class="source">    validateOptions(options);</td></tr><tr><td class="line">340</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">341</td><td class="hits">462</td><td class="source">    var locals = getLocals(options),</td></tr><tr><td class="line">342</td><td class="hits"></td><td class="source">      opts = {},</td></tr><tr><td class="line">343</td><td class="hits"></td><td class="source">      k;</td></tr><tr><td class="line">344</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">345</td><td class="hits">462</td><td class="source">    for (k in options) {</td></tr><tr class="hit"><td class="line">346</td><td class="hits">401</td><td class="source">      if (options.hasOwnProperty(k) &amp;&amp; k !== 'locals') {</td></tr><tr class="hit"><td class="line">347</td><td class="hits">117</td><td class="source">        opts[k] = options[k];</td></tr><tr><td class="line">348</td><td class="hits"></td><td class="source">      }</td></tr><tr><td class="line">349</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">350</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">351</td><td class="hits">462</td><td class="source">    options = utils.extend({}, self.options, opts);</td></tr><tr class="hit"><td class="line">352</td><td class="hits">462</td><td class="source">    options.locals = locals;</td></tr><tr><td class="line">353</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">354</td><td class="hits">462</td><td class="source">    return parser.parse(this, source, options, tags, filters);</td></tr><tr><td class="line">355</td><td class="hits"></td><td class="source">  };</td></tr><tr><td class="line">356</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">357</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">358</td><td class="hits"></td><td class="source">   * Parse a given file into tokens.</td></tr><tr><td class="line">359</td><td class="hits"></td><td class="source">   *</td></tr><tr><td class="line">360</td><td class="hits"></td><td class="source">   * @param  {string} pathname  Full path to file to parse.</td></tr><tr><td class="line">361</td><td class="hits"></td><td class="source">   * @param  {SwigOpts} [options={}]   Swig options object.</td></tr><tr><td class="line">362</td><td class="hits"></td><td class="source">   * @return {object} parsed    Template tokens object.</td></tr><tr><td class="line">363</td><td class="hits"></td><td class="source">   * @private</td></tr><tr><td class="line">364</td><td class="hits"></td><td class="source">   */</td></tr><tr class="hit"><td class="line">365</td><td class="hits">26</td><td class="source">  this.parseFile = function (pathname, options) {</td></tr><tr class="hit"><td class="line">366</td><td class="hits">28</td><td class="source">    var src;</td></tr><tr><td class="line">367</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">368</td><td class="hits">28</td><td class="source">    if (!options) {</td></tr><tr class="miss"><td class="line">369</td><td class="hits">0</td><td class="source">      options = {};</td></tr><tr><td class="line">370</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">371</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">372</td><td class="hits">28</td><td class="source">    pathname = self.options.loader.resolve(pathname, options.resolveFrom);</td></tr><tr><td class="line">373</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">374</td><td class="hits">28</td><td class="source">    src = self.options.loader.load(pathname);</td></tr><tr><td class="line">375</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">376</td><td class="hits">27</td><td class="source">    if (!options.filename) {</td></tr><tr class="hit"><td class="line">377</td><td class="hits">4</td><td class="source">      options = utils.extend({ filename: pathname }, options);</td></tr><tr><td class="line">378</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">379</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">380</td><td class="hits">27</td><td class="source">    return self.parse(src, options);</td></tr><tr><td class="line">381</td><td class="hits"></td><td class="source">  };</td></tr><tr><td class="line">382</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">383</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">384</td><td class="hits"></td><td class="source">   * Re-Map blocks within a list of tokens to the template's block objects.</td></tr><tr><td class="line">385</td><td class="hits"></td><td class="source">   * @param  {array}  tokens   List of tokens for the parent object.</td></tr><tr><td class="line">386</td><td class="hits"></td><td class="source">   * @param  {object} template Current template that needs to be mapped to the  parent's block and token list.</td></tr><tr><td class="line">387</td><td class="hits"></td><td class="source">   * @return {array}</td></tr><tr><td class="line">388</td><td class="hits"></td><td class="source">   * @private</td></tr><tr><td class="line">389</td><td class="hits"></td><td class="source">   */</td></tr><tr class="hit"><td class="line">390</td><td class="hits">26</td><td class="source">  function remapBlocks(blocks, tokens) {</td></tr><tr class="hit"><td class="line">391</td><td class="hits">51</td><td class="source">    return utils.map(tokens, function (token) {</td></tr><tr class="hit"><td class="line">392</td><td class="hits">116</td><td class="source">      var args = token.args ? token.args.join('') : '';</td></tr><tr class="hit"><td class="line">393</td><td class="hits">116</td><td class="source">      if (token.name === 'block' &amp;&amp; blocks[args]) {</td></tr><tr class="hit"><td class="line">394</td><td class="hits">21</td><td class="source">        token = blocks[args];</td></tr><tr><td class="line">395</td><td class="hits"></td><td class="source">      }</td></tr><tr class="hit"><td class="line">396</td><td class="hits">116</td><td class="source">      if (token.content &amp;&amp; token.content.length) {</td></tr><tr class="hit"><td class="line">397</td><td class="hits">28</td><td class="source">        token.content = remapBlocks(blocks, token.content);</td></tr><tr><td class="line">398</td><td class="hits"></td><td class="source">      }</td></tr><tr class="hit"><td class="line">399</td><td class="hits">116</td><td class="source">      return token;</td></tr><tr><td class="line">400</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">401</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">402</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">403</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">404</td><td class="hits"></td><td class="source">   * Import block-level tags to the token list that are not actual block tags.</td></tr><tr><td class="line">405</td><td class="hits"></td><td class="source">   * @param  {array} blocks List of block-level tags.</td></tr><tr><td class="line">406</td><td class="hits"></td><td class="source">   * @param  {array} tokens List of tokens to render.</td></tr><tr><td class="line">407</td><td class="hits"></td><td class="source">   * @return {undefined}</td></tr><tr><td class="line">408</td><td class="hits"></td><td class="source">   * @private</td></tr><tr><td class="line">409</td><td class="hits"></td><td class="source">   */</td></tr><tr class="hit"><td class="line">410</td><td class="hits">26</td><td class="source">  function importNonBlocks(blocks, tokens) {</td></tr><tr class="hit"><td class="line">411</td><td class="hits">23</td><td class="source">    var temp = [];</td></tr><tr class="hit"><td class="line">412</td><td class="hits">52</td><td class="source">    utils.each(blocks, function (block) { temp.push(block); });</td></tr><tr class="hit"><td class="line">413</td><td class="hits">23</td><td class="source">    utils.each(temp.reverse(), function (block) {</td></tr><tr class="hit"><td class="line">414</td><td class="hits">29</td><td class="source">      if (block.name !== 'block') {</td></tr><tr class="hit"><td class="line">415</td><td class="hits">5</td><td class="source">        tokens.unshift(block);</td></tr><tr><td class="line">416</td><td class="hits"></td><td class="source">      }</td></tr><tr><td class="line">417</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">418</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">419</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">420</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">421</td><td class="hits"></td><td class="source">   * Recursively compile and get parents of given parsed token object.</td></tr><tr><td class="line">422</td><td class="hits"></td><td class="source">   *</td></tr><tr><td class="line">423</td><td class="hits"></td><td class="source">   * @param  {object} tokens    Parsed tokens from template.</td></tr><tr><td class="line">424</td><td class="hits"></td><td class="source">   * @param  {SwigOpts} [options={}]   Swig options object.</td></tr><tr><td class="line">425</td><td class="hits"></td><td class="source">   * @return {object}           Parsed tokens from parent templates.</td></tr><tr><td class="line">426</td><td class="hits"></td><td class="source">   * @private</td></tr><tr><td class="line">427</td><td class="hits"></td><td class="source">   */</td></tr><tr class="hit"><td class="line">428</td><td class="hits">26</td><td class="source">  function getParents(tokens, options) {</td></tr><tr class="hit"><td class="line">429</td><td class="hits">369</td><td class="source">    var parentName = tokens.parent,</td></tr><tr><td class="line">430</td><td class="hits"></td><td class="source">      parentFiles = [],</td></tr><tr><td class="line">431</td><td class="hits"></td><td class="source">      parents = [],</td></tr><tr><td class="line">432</td><td class="hits"></td><td class="source">      parentFile,</td></tr><tr><td class="line">433</td><td class="hits"></td><td class="source">      parent,</td></tr><tr><td class="line">434</td><td class="hits"></td><td class="source">      l;</td></tr><tr><td class="line">435</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">436</td><td class="hits">369</td><td class="source">    while (parentName) {</td></tr><tr class="hit"><td class="line">437</td><td class="hits">28</td><td class="source">      if (!options || !options.filename) {</td></tr><tr class="hit"><td class="line">438</td><td class="hits">1</td><td class="source">        throw new Error('Cannot extend &quot;' + parentName + '&quot; because current template has no filename.');</td></tr><tr><td class="line">439</td><td class="hits"></td><td class="source">      }</td></tr><tr><td class="line">440</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">441</td><td class="hits">27</td><td class="source">      parentFile = parentFile || options.filename;</td></tr><tr class="hit"><td class="line">442</td><td class="hits">27</td><td class="source">      parentFile = self.options.loader.resolve(parentName, parentFile);</td></tr><tr class="hit"><td class="line">443</td><td class="hits">27</td><td class="source">      parent = cacheGet(parentFile, options) || self.parseFile(parentFile, utils.extend({}, options, { filename: parentFile }));</td></tr><tr class="hit"><td class="line">444</td><td class="hits">26</td><td class="source">      parentName = parent.parent;</td></tr><tr><td class="line">445</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">446</td><td class="hits">26</td><td class="source">      if (parentFiles.indexOf(parentFile) !== -1) {</td></tr><tr class="hit"><td class="line">447</td><td class="hits">1</td><td class="source">        throw new Error('Illegal circular extends of &quot;' + parentFile + '&quot;.');</td></tr><tr><td class="line">448</td><td class="hits"></td><td class="source">      }</td></tr><tr class="hit"><td class="line">449</td><td class="hits">25</td><td class="source">      parentFiles.push(parentFile);</td></tr><tr><td class="line">450</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">451</td><td class="hits">25</td><td class="source">      parents.push(parent);</td></tr><tr><td class="line">452</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">453</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">454</td><td class="hits"></td><td class="source">    // Remap each parents'(1) blocks onto its own parent(2), receiving the full token list for rendering the original parent(1) on its own.</td></tr><tr class="hit"><td class="line">455</td><td class="hits">366</td><td class="source">    l = parents.length;</td></tr><tr class="hit"><td class="line">456</td><td class="hits">366</td><td class="source">    for (l = parents.length - 2; l &gt;= 0; l -= 1) {</td></tr><tr class="hit"><td class="line">457</td><td class="hits">6</td><td class="source">      parents[l].tokens = remapBlocks(parents[l].blocks, parents[l + 1].tokens);</td></tr><tr class="hit"><td class="line">458</td><td class="hits">6</td><td class="source">      importNonBlocks(parents[l].blocks, parents[l].tokens);</td></tr><tr><td class="line">459</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">460</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">461</td><td class="hits">366</td><td class="source">    return parents;</td></tr><tr><td class="line">462</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">463</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">464</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">465</td><td class="hits"></td><td class="source">   * Pre-compile a source string into a cache-able template function.</td></tr><tr><td class="line">466</td><td class="hits"></td><td class="source">   *</td></tr><tr><td class="line">467</td><td class="hits"></td><td class="source">   * @example</td></tr><tr><td class="line">468</td><td class="hits"></td><td class="source">   * swig.precompile('{{ tacos }}');</td></tr><tr><td class="line">469</td><td class="hits"></td><td class="source">   * // =&gt; {</td></tr><tr><td class="line">470</td><td class="hits"></td><td class="source">   * //      tpl: function (_swig, _locals, _filters, _utils, _fn) { ... },</td></tr><tr><td class="line">471</td><td class="hits"></td><td class="source">   * //      tokens: {</td></tr><tr><td class="line">472</td><td class="hits"></td><td class="source">   * //        name: undefined,</td></tr><tr><td class="line">473</td><td class="hits"></td><td class="source">   * //        parent: null,</td></tr><tr><td class="line">474</td><td class="hits"></td><td class="source">   * //        tokens: [...],</td></tr><tr><td class="line">475</td><td class="hits"></td><td class="source">   * //        blocks: {}</td></tr><tr><td class="line">476</td><td class="hits"></td><td class="source">   * //      }</td></tr><tr><td class="line">477</td><td class="hits"></td><td class="source">   * //    }</td></tr><tr><td class="line">478</td><td class="hits"></td><td class="source">   *</td></tr><tr><td class="line">479</td><td class="hits"></td><td class="source">   * In order to render a pre-compiled template, you must have access to filters and utils from Swig. &lt;var&gt;efn&lt;/var&gt; is simply an empty function that does nothing.</td></tr><tr><td class="line">480</td><td class="hits"></td><td class="source">   *</td></tr><tr><td class="line">481</td><td class="hits"></td><td class="source">   * @param  {string} source  Swig template source string.</td></tr><tr><td class="line">482</td><td class="hits"></td><td class="source">   * @param  {SwigOpts} [options={}] Swig options object.</td></tr><tr><td class="line">483</td><td class="hits"></td><td class="source">   * @return {object}         Renderable function and tokens object.</td></tr><tr><td class="line">484</td><td class="hits"></td><td class="source">   */</td></tr><tr class="hit"><td class="line">485</td><td class="hits">26</td><td class="source">  this.precompile = function (source, options) {</td></tr><tr class="hit"><td class="line">486</td><td class="hits">450</td><td class="source">    var tokens = self.parse(source, options),</td></tr><tr><td class="line">487</td><td class="hits"></td><td class="source">      parents = getParents(tokens, options),</td></tr><tr><td class="line">488</td><td class="hits"></td><td class="source">      tpl,</td></tr><tr><td class="line">489</td><td class="hits"></td><td class="source">      err;</td></tr><tr><td class="line">490</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">491</td><td class="hits">366</td><td class="source">    if (parents.length) {</td></tr><tr><td class="line">492</td><td class="hits"></td><td class="source">      // Remap the templates first-parent's tokens using this template's blocks.</td></tr><tr class="hit"><td class="line">493</td><td class="hits">17</td><td class="source">      tokens.tokens = remapBlocks(tokens.blocks, parents[0].tokens);</td></tr><tr class="hit"><td class="line">494</td><td class="hits">17</td><td class="source">      importNonBlocks(tokens.blocks, tokens.tokens);</td></tr><tr><td class="line">495</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">496</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">497</td><td class="hits">366</td><td class="source">    try {</td></tr><tr class="hit"><td class="line">498</td><td class="hits">366</td><td class="source">      tpl = new Function('_swig', '_ctx', '_filters', '_utils', '_fn',</td></tr><tr><td class="line">499</td><td class="hits"></td><td class="source">        '  var _ext = _swig.extensions,\n' +</td></tr><tr><td class="line">500</td><td class="hits"></td><td class="source">        '    _output = &quot;&quot;;\n' +</td></tr><tr><td class="line">501</td><td class="hits"></td><td class="source">        parser.compile(tokens, parents, options) + '\n' +</td></tr><tr><td class="line">502</td><td class="hits"></td><td class="source">        '  return _output;\n'</td></tr><tr><td class="line">503</td><td class="hits"></td><td class="source">        );</td></tr><tr><td class="line">504</td><td class="hits"></td><td class="source">    } catch (e) {</td></tr><tr class="hit"><td class="line">505</td><td class="hits">1</td><td class="source">      utils.throwError(e, null, options.filename);</td></tr><tr><td class="line">506</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">507</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">508</td><td class="hits">365</td><td class="source">    return { tpl: tpl, tokens: tokens };</td></tr><tr><td class="line">509</td><td class="hits"></td><td class="source">  };</td></tr><tr><td class="line">510</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">511</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">512</td><td class="hits"></td><td class="source">   * Compile and render a template string for final output.</td></tr><tr><td class="line">513</td><td class="hits"></td><td class="source">   *</td></tr><tr><td class="line">514</td><td class="hits"></td><td class="source">   * When rendering a source string, a file path should be specified in the options object in order for &lt;var&gt;extends&lt;/var&gt;, &lt;var&gt;include&lt;/var&gt;, and &lt;var&gt;import&lt;/var&gt; to work properly. Do this by adding &lt;code data-language=&quot;js&quot;&gt;{ filename: '/absolute/path/to/mytpl.html' }&lt;/code&gt; to the options argument.</td></tr><tr><td class="line">515</td><td class="hits"></td><td class="source">   *</td></tr><tr><td class="line">516</td><td class="hits"></td><td class="source">   * @example</td></tr><tr><td class="line">517</td><td class="hits"></td><td class="source">   * swig.render('{{ tacos }}', { locals: { tacos: 'Tacos!!!!' }});</td></tr><tr><td class="line">518</td><td class="hits"></td><td class="source">   * // =&gt; Tacos!!!!</td></tr><tr><td class="line">519</td><td class="hits"></td><td class="source">   *</td></tr><tr><td class="line">520</td><td class="hits"></td><td class="source">   * @param  {string} source    Swig template source string.</td></tr><tr><td class="line">521</td><td class="hits"></td><td class="source">   * @param  {SwigOpts} [options={}] Swig options object.</td></tr><tr><td class="line">522</td><td class="hits"></td><td class="source">   * @return {string}           Rendered output.</td></tr><tr><td class="line">523</td><td class="hits"></td><td class="source">   */</td></tr><tr class="hit"><td class="line">524</td><td class="hits">26</td><td class="source">  this.render = function (source, options) {</td></tr><tr class="hit"><td class="line">525</td><td class="hits">383</td><td class="source">    return self.compile(source, options)();</td></tr><tr><td class="line">526</td><td class="hits"></td><td class="source">  };</td></tr><tr><td class="line">527</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">528</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">529</td><td class="hits"></td><td class="source">   * Compile and render a template file for final output. This is most useful for libraries like Express.js.</td></tr><tr><td class="line">530</td><td class="hits"></td><td class="source">   *</td></tr><tr><td class="line">531</td><td class="hits"></td><td class="source">   * @example</td></tr><tr><td class="line">532</td><td class="hits"></td><td class="source">   * swig.renderFile('./template.html', {}, function (err, output) {</td></tr><tr><td class="line">533</td><td class="hits"></td><td class="source">   *   if (err) {</td></tr><tr><td class="line">534</td><td class="hits"></td><td class="source">   *     throw err;</td></tr><tr><td class="line">535</td><td class="hits"></td><td class="source">   *   }</td></tr><tr><td class="line">536</td><td class="hits"></td><td class="source">   *   console.log(output);</td></tr><tr><td class="line">537</td><td class="hits"></td><td class="source">   * });</td></tr><tr><td class="line">538</td><td class="hits"></td><td class="source">   *</td></tr><tr><td class="line">539</td><td class="hits"></td><td class="source">   * @example</td></tr><tr><td class="line">540</td><td class="hits"></td><td class="source">   * swig.renderFile('./template.html', {});</td></tr><tr><td class="line">541</td><td class="hits"></td><td class="source">   * // =&gt; output</td></tr><tr><td class="line">542</td><td class="hits"></td><td class="source">   *</td></tr><tr><td class="line">543</td><td class="hits"></td><td class="source">   * @param  {string}   pathName    File location.</td></tr><tr><td class="line">544</td><td class="hits"></td><td class="source">   * @param  {object}   [locals={}] Template variable context.</td></tr><tr><td class="line">545</td><td class="hits"></td><td class="source">   * @param  {Function} [cb] Asyncronous callback function. If not provided, &lt;var&gt;compileFile&lt;/var&gt; will run syncronously.</td></tr><tr><td class="line">546</td><td class="hits"></td><td class="source">   * @return {string}             Rendered output.</td></tr><tr><td class="line">547</td><td class="hits"></td><td class="source">   */</td></tr><tr class="hit"><td class="line">548</td><td class="hits">26</td><td class="source">  this.renderFile = function (pathName, locals, cb) {</td></tr><tr class="hit"><td class="line">549</td><td class="hits">12</td><td class="source">    if (cb) {</td></tr><tr class="hit"><td class="line">550</td><td class="hits">5</td><td class="source">      self.compileFile(pathName, {}, function (err, fn) {</td></tr><tr class="hit"><td class="line">551</td><td class="hits">5</td><td class="source">        var result;</td></tr><tr><td class="line">552</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">553</td><td class="hits">5</td><td class="source">        if (err) {</td></tr><tr class="hit"><td class="line">554</td><td class="hits">1</td><td class="source">          cb(err);</td></tr><tr class="hit"><td class="line">555</td><td class="hits">1</td><td class="source">          return;</td></tr><tr><td class="line">556</td><td class="hits"></td><td class="source">        }</td></tr><tr><td class="line">557</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">558</td><td class="hits">4</td><td class="source">        try {</td></tr><tr class="hit"><td class="line">559</td><td class="hits">4</td><td class="source">          result = fn(locals);</td></tr><tr><td class="line">560</td><td class="hits"></td><td class="source">        } catch (err2) {</td></tr><tr class="hit"><td class="line">561</td><td class="hits">1</td><td class="source">          cb(err2);</td></tr><tr class="hit"><td class="line">562</td><td class="hits">1</td><td class="source">          return;</td></tr><tr><td class="line">563</td><td class="hits"></td><td class="source">        }</td></tr><tr><td class="line">564</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">565</td><td class="hits">3</td><td class="source">        cb(null, result);</td></tr><tr><td class="line">566</td><td class="hits"></td><td class="source">      });</td></tr><tr class="hit"><td class="line">567</td><td class="hits">5</td><td class="source">      return;</td></tr><tr><td class="line">568</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">569</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">570</td><td class="hits">7</td><td class="source">    return self.compileFile(pathName)(locals);</td></tr><tr><td class="line">571</td><td class="hits"></td><td class="source">  };</td></tr><tr><td class="line">572</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">573</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">574</td><td class="hits"></td><td class="source">   * Compile string source into a renderable template function.</td></tr><tr><td class="line">575</td><td class="hits"></td><td class="source">   *</td></tr><tr><td class="line">576</td><td class="hits"></td><td class="source">   * @example</td></tr><tr><td class="line">577</td><td class="hits"></td><td class="source">   * var tpl = swig.compile('{{ tacos }}');</td></tr><tr><td class="line">578</td><td class="hits"></td><td class="source">   * // =&gt; {</td></tr><tr><td class="line">579</td><td class="hits"></td><td class="source">   * //      [Function: compiled]</td></tr><tr><td class="line">580</td><td class="hits"></td><td class="source">   * //      parent: null,</td></tr><tr><td class="line">581</td><td class="hits"></td><td class="source">   * //      tokens: [{ compile: [Function] }],</td></tr><tr><td class="line">582</td><td class="hits"></td><td class="source">   * //      blocks: {}</td></tr><tr><td class="line">583</td><td class="hits"></td><td class="source">   * //    }</td></tr><tr><td class="line">584</td><td class="hits"></td><td class="source">   * tpl({ tacos: 'Tacos!!!!' });</td></tr><tr><td class="line">585</td><td class="hits"></td><td class="source">   * // =&gt; Tacos!!!!</td></tr><tr><td class="line">586</td><td class="hits"></td><td class="source">   *</td></tr><tr><td class="line">587</td><td class="hits"></td><td class="source">   * When compiling a source string, a file path should be specified in the options object in order for &lt;var&gt;extends&lt;/var&gt;, &lt;var&gt;include&lt;/var&gt;, and &lt;var&gt;import&lt;/var&gt; to work properly. Do this by adding &lt;code data-language=&quot;js&quot;&gt;{ filename: '/absolute/path/to/mytpl.html' }&lt;/code&gt; to the options argument.</td></tr><tr><td class="line">588</td><td class="hits"></td><td class="source">   *</td></tr><tr><td class="line">589</td><td class="hits"></td><td class="source">   * @param  {string} source    Swig template source string.</td></tr><tr><td class="line">590</td><td class="hits"></td><td class="source">   * @param  {SwigOpts} [options={}] Swig options object.</td></tr><tr><td class="line">591</td><td class="hits"></td><td class="source">   * @return {function}         Renderable function with keys for parent, blocks, and tokens.</td></tr><tr><td class="line">592</td><td class="hits"></td><td class="source">   */</td></tr><tr class="hit"><td class="line">593</td><td class="hits">26</td><td class="source">  this.compile = function (source, options) {</td></tr><tr class="hit"><td class="line">594</td><td class="hits">448</td><td class="source">    var key = options ? options.filename : null,</td></tr><tr><td class="line">595</td><td class="hits"></td><td class="source">      cached = key ? cacheGet(key, options) : null,</td></tr><tr><td class="line">596</td><td class="hits"></td><td class="source">      context,</td></tr><tr><td class="line">597</td><td class="hits"></td><td class="source">      contextLength,</td></tr><tr><td class="line">598</td><td class="hits"></td><td class="source">      pre;</td></tr><tr><td class="line">599</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">600</td><td class="hits">448</td><td class="source">    if (cached) {</td></tr><tr class="hit"><td class="line">601</td><td class="hits">1</td><td class="source">      return cached;</td></tr><tr><td class="line">602</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">603</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">604</td><td class="hits">447</td><td class="source">    context = getLocals(options);</td></tr><tr class="hit"><td class="line">605</td><td class="hits">447</td><td class="source">    contextLength = utils.keys(context).length;</td></tr><tr class="hit"><td class="line">606</td><td class="hits">447</td><td class="source">    pre = this.precompile(source, options);</td></tr><tr><td class="line">607</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">608</td><td class="hits">362</td><td class="source">    function compiled(locals) {</td></tr><tr class="hit"><td class="line">609</td><td class="hits">5195</td><td class="source">      var lcls;</td></tr><tr class="hit"><td class="line">610</td><td class="hits">5195</td><td class="source">      if (locals &amp;&amp; contextLength) {</td></tr><tr class="hit"><td class="line">611</td><td class="hits">1</td><td class="source">        lcls = utils.extend({}, context, locals);</td></tr><tr class="hit"><td class="line">612</td><td class="hits">5194</td><td class="source">      } else if (locals &amp;&amp; !contextLength) {</td></tr><tr class="hit"><td class="line">613</td><td class="hits">4870</td><td class="source">        lcls = locals;</td></tr><tr class="hit"><td class="line">614</td><td class="hits">324</td><td class="source">      } else if (!locals &amp;&amp; contextLength) {</td></tr><tr class="hit"><td class="line">615</td><td class="hits">277</td><td class="source">        lcls = context;</td></tr><tr><td class="line">616</td><td class="hits"></td><td class="source">      } else {</td></tr><tr class="hit"><td class="line">617</td><td class="hits">47</td><td class="source">        lcls = {};</td></tr><tr><td class="line">618</td><td class="hits"></td><td class="source">      }</td></tr><tr class="hit"><td class="line">619</td><td class="hits">5195</td><td class="source">      return pre.tpl(self, lcls, filters, utils, efn);</td></tr><tr><td class="line">620</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">621</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">622</td><td class="hits">362</td><td class="source">    utils.extend(compiled, pre.tokens);</td></tr><tr><td class="line">623</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">624</td><td class="hits">362</td><td class="source">    if (key) {</td></tr><tr class="hit"><td class="line">625</td><td class="hits">39</td><td class="source">      cacheSet(key, options, compiled);</td></tr><tr><td class="line">626</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">627</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">628</td><td class="hits">362</td><td class="source">    return compiled;</td></tr><tr><td class="line">629</td><td class="hits"></td><td class="source">  };</td></tr><tr><td class="line">630</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">631</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">632</td><td class="hits"></td><td class="source">   * Compile a source file into a renderable template function.</td></tr><tr><td class="line">633</td><td class="hits"></td><td class="source">   *</td></tr><tr><td class="line">634</td><td class="hits"></td><td class="source">   * @example</td></tr><tr><td class="line">635</td><td class="hits"></td><td class="source">   * var tpl = swig.compileFile('./mytpl.html');</td></tr><tr><td class="line">636</td><td class="hits"></td><td class="source">   * // =&gt; {</td></tr><tr><td class="line">637</td><td class="hits"></td><td class="source">   * //      [Function: compiled]</td></tr><tr><td class="line">638</td><td class="hits"></td><td class="source">   * //      parent: null,</td></tr><tr><td class="line">639</td><td class="hits"></td><td class="source">   * //      tokens: [{ compile: [Function] }],</td></tr><tr><td class="line">640</td><td class="hits"></td><td class="source">   * //      blocks: {}</td></tr><tr><td class="line">641</td><td class="hits"></td><td class="source">   * //    }</td></tr><tr><td class="line">642</td><td class="hits"></td><td class="source">   * tpl({ tacos: 'Tacos!!!!' });</td></tr><tr><td class="line">643</td><td class="hits"></td><td class="source">   * // =&gt; Tacos!!!!</td></tr><tr><td class="line">644</td><td class="hits"></td><td class="source">   *</td></tr><tr><td class="line">645</td><td class="hits"></td><td class="source">   * @example</td></tr><tr><td class="line">646</td><td class="hits"></td><td class="source">   * swig.compileFile('/myfile.txt', { varControls: ['&lt;%=', '=%&gt;'], tagControls: ['&lt;%', '%&gt;']});</td></tr><tr><td class="line">647</td><td class="hits"></td><td class="source">   * // =&gt; will compile 'myfile.txt' using the var and tag controls as specified.</td></tr><tr><td class="line">648</td><td class="hits"></td><td class="source">   *</td></tr><tr><td class="line">649</td><td class="hits"></td><td class="source">   * @param  {string} pathname  File location.</td></tr><tr><td class="line">650</td><td class="hits"></td><td class="source">   * @param  {SwigOpts} [options={}] Swig options object.</td></tr><tr><td class="line">651</td><td class="hits"></td><td class="source">   * @param  {Function} [cb] Asyncronous callback function. If not provided, &lt;var&gt;compileFile&lt;/var&gt; will run syncronously.</td></tr><tr><td class="line">652</td><td class="hits"></td><td class="source">   * @return {function}         Renderable function with keys for parent, blocks, and tokens.</td></tr><tr><td class="line">653</td><td class="hits"></td><td class="source">   */</td></tr><tr class="hit"><td class="line">654</td><td class="hits">26</td><td class="source">  this.compileFile = function (pathname, options, cb) {</td></tr><tr class="hit"><td class="line">655</td><td class="hits">4879</td><td class="source">    var src, cached;</td></tr><tr><td class="line">656</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">657</td><td class="hits">4879</td><td class="source">    if (!options) {</td></tr><tr class="hit"><td class="line">658</td><td class="hits">23</td><td class="source">      options = {};</td></tr><tr><td class="line">659</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">660</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">661</td><td class="hits">4879</td><td class="source">    pathname = self.options.loader.resolve(pathname, options.resolveFrom);</td></tr><tr class="hit"><td class="line">662</td><td class="hits">4878</td><td class="source">    if (!options.filename) {</td></tr><tr class="hit"><td class="line">663</td><td class="hits">4878</td><td class="source">      options = utils.extend({ filename: pathname }, options);</td></tr><tr><td class="line">664</td><td class="hits"></td><td class="source">    }</td></tr><tr class="hit"><td class="line">665</td><td class="hits">4878</td><td class="source">    cached = cacheGet(pathname, options);</td></tr><tr><td class="line">666</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">667</td><td class="hits">4878</td><td class="source">    if (cached) {</td></tr><tr class="hit"><td class="line">668</td><td class="hits">4840</td><td class="source">      if (cb) {</td></tr><tr class="hit"><td class="line">669</td><td class="hits">1</td><td class="source">        cb(null, cached);</td></tr><tr class="hit"><td class="line">670</td><td class="hits">1</td><td class="source">        return;</td></tr><tr><td class="line">671</td><td class="hits"></td><td class="source">      }</td></tr><tr class="hit"><td class="line">672</td><td class="hits">4839</td><td class="source">      return cached;</td></tr><tr><td class="line">673</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">674</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">675</td><td class="hits">38</td><td class="source">    if (cb) {</td></tr><tr class="hit"><td class="line">676</td><td class="hits">7</td><td class="source">      self.options.loader.load(pathname, function (err, src) {</td></tr><tr class="hit"><td class="line">677</td><td class="hits">7</td><td class="source">        if (err) {</td></tr><tr class="hit"><td class="line">678</td><td class="hits">1</td><td class="source">          cb(err);</td></tr><tr class="hit"><td class="line">679</td><td class="hits">1</td><td class="source">          return;</td></tr><tr><td class="line">680</td><td class="hits"></td><td class="source">        }</td></tr><tr class="hit"><td class="line">681</td><td class="hits">6</td><td class="source">        var compiled;</td></tr><tr><td class="line">682</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">683</td><td class="hits">6</td><td class="source">        try {</td></tr><tr class="hit"><td class="line">684</td><td class="hits">6</td><td class="source">          compiled = self.compile(src, options);</td></tr><tr><td class="line">685</td><td class="hits"></td><td class="source">        } catch (err2) {</td></tr><tr class="hit"><td class="line">686</td><td class="hits">1</td><td class="source">          cb(err2);</td></tr><tr class="hit"><td class="line">687</td><td class="hits">1</td><td class="source">          return;</td></tr><tr><td class="line">688</td><td class="hits"></td><td class="source">        }</td></tr><tr><td class="line">689</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">690</td><td class="hits">5</td><td class="source">        cb(err, compiled);</td></tr><tr><td class="line">691</td><td class="hits"></td><td class="source">      });</td></tr><tr class="hit"><td class="line">692</td><td class="hits">7</td><td class="source">      return;</td></tr><tr><td class="line">693</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">694</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">695</td><td class="hits">31</td><td class="source">    src = self.options.loader.load(pathname);</td></tr><tr class="hit"><td class="line">696</td><td class="hits">29</td><td class="source">    return self.compile(src, options);</td></tr><tr><td class="line">697</td><td class="hits"></td><td class="source">  };</td></tr><tr><td class="line">698</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">699</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">700</td><td class="hits"></td><td class="source">   * Run a pre-compiled template function. This is most useful in the browser when you've pre-compiled your templates with the Swig command-line tool.</td></tr><tr><td class="line">701</td><td class="hits"></td><td class="source">   *</td></tr><tr><td class="line">702</td><td class="hits"></td><td class="source">   * @example</td></tr><tr><td class="line">703</td><td class="hits"></td><td class="source">   * $ swig compile ./mytpl.html --wrap-start=&quot;var mytpl = &quot; &gt; mytpl.js</td></tr><tr><td class="line">704</td><td class="hits"></td><td class="source">   * @example</td></tr><tr><td class="line">705</td><td class="hits"></td><td class="source">   * &lt;script src=&quot;mytpl.js&quot;&gt;&lt;/script&gt;</td></tr><tr><td class="line">706</td><td class="hits"></td><td class="source">   * &lt;script&gt;</td></tr><tr><td class="line">707</td><td class="hits"></td><td class="source">   *   swig.run(mytpl, {});</td></tr><tr><td class="line">708</td><td class="hits"></td><td class="source">   *   // =&gt; &quot;rendered template...&quot;</td></tr><tr><td class="line">709</td><td class="hits"></td><td class="source">   * &lt;/script&gt;</td></tr><tr><td class="line">710</td><td class="hits"></td><td class="source">   *</td></tr><tr><td class="line">711</td><td class="hits"></td><td class="source">   * @param  {function} tpl       Pre-compiled Swig template function. Use the Swig CLI to compile your templates.</td></tr><tr><td class="line">712</td><td class="hits"></td><td class="source">   * @param  {object} [locals={}] Template variable context.</td></tr><tr><td class="line">713</td><td class="hits"></td><td class="source">   * @param  {string} [filepath]  Filename used for caching the template.</td></tr><tr><td class="line">714</td><td class="hits"></td><td class="source">   * @return {string}             Rendered output.</td></tr><tr><td class="line">715</td><td class="hits"></td><td class="source">   */</td></tr><tr class="hit"><td class="line">716</td><td class="hits">26</td><td class="source">  this.run = function (tpl, locals, filepath) {</td></tr><tr class="hit"><td class="line">717</td><td class="hits">5</td><td class="source">    var context = getLocals({ locals: locals });</td></tr><tr class="hit"><td class="line">718</td><td class="hits">5</td><td class="source">    if (filepath) {</td></tr><tr class="hit"><td class="line">719</td><td class="hits">1</td><td class="source">      cacheSet(filepath, {}, tpl);</td></tr><tr><td class="line">720</td><td class="hits"></td><td class="source">    }</td></tr><tr class="hit"><td class="line">721</td><td class="hits">5</td><td class="source">    return tpl(self, context, filters, utils, efn);</td></tr><tr><td class="line">722</td><td class="hits"></td><td class="source">  };</td></tr><tr><td class="line">723</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">724</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">725</td><td class="hits"></td><td class="source">/*!</td></tr><tr><td class="line">726</td><td class="hits"></td><td class="source"> * Export methods publicly</td></tr><tr><td class="line">727</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">728</td><td class="hits">1</td><td class="source">defaultInstance = new exports.Swig();</td></tr><tr class="hit"><td class="line">729</td><td class="hits">1</td><td class="source">exports.setFilter = defaultInstance.setFilter;</td></tr><tr class="hit"><td class="line">730</td><td class="hits">1</td><td class="source">exports.setTag = defaultInstance.setTag;</td></tr><tr class="hit"><td class="line">731</td><td class="hits">1</td><td class="source">exports.setExtension = defaultInstance.setExtension;</td></tr><tr class="hit"><td class="line">732</td><td class="hits">1</td><td class="source">exports.parseFile = defaultInstance.parseFile;</td></tr><tr class="hit"><td class="line">733</td><td class="hits">1</td><td class="source">exports.precompile = defaultInstance.precompile;</td></tr><tr class="hit"><td class="line">734</td><td class="hits">1</td><td class="source">exports.compile = defaultInstance.compile;</td></tr><tr class="hit"><td class="line">735</td><td class="hits">1</td><td class="source">exports.compileFile = defaultInstance.compileFile;</td></tr><tr class="hit"><td class="line">736</td><td class="hits">1</td><td class="source">exports.render = defaultInstance.render;</td></tr><tr class="hit"><td class="line">737</td><td class="hits">1</td><td class="source">exports.renderFile = defaultInstance.renderFile;</td></tr><tr class="hit"><td class="line">738</td><td class="hits">1</td><td class="source">exports.run = defaultInstance.run;</td></tr><tr class="hit"><td class="line">739</td><td class="hits">1</td><td class="source">exports.invalidateCache = defaultInstance.invalidateCache;</td></tr><tr class="hit"><td class="line">740</td><td class="hits">1</td><td class="source">exports.loaders = loaders;</td></tr><tr><td class="line">741</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="/lib/tags/autoescape.js">/lib/tags/autoescape.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">13</div><div class="hits">13</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr class="hit"><td class="line">1</td><td class="hits">1</td><td class="source">var utils = require('../utils'),</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source">  strings = ['html', 'js'];</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * Control auto-escaping of variable output from within your templates.</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> * @alias autoescape</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * @example</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> * // myvar = '&lt;foo&gt;';</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> * {% autoescape true %}{{ myvar }}{% endautoescape %}</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source"> * // =&gt; &lt;foo&gt;</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source"> * {% autoescape false %}{{ myvar }}{% endautoescape %}</td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source"> * // =&gt; &lt;foo&gt;</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source"> * @param {boolean|string} control One of `true`, `false`, `&quot;js&quot;` or `&quot;html&quot;`.</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">18</td><td class="hits">1</td><td class="source">exports.compile = function (compiler, args, content, parents, options, blockName) {</td></tr><tr class="hit"><td class="line">19</td><td class="hits">6</td><td class="source">  return compiler(content, parents, options, blockName);</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source">};</td></tr><tr class="hit"><td class="line">21</td><td class="hits">1</td><td class="source">exports.parse = function (str, line, parser, types, stack, opts) {</td></tr><tr class="hit"><td class="line">22</td><td class="hits">11</td><td class="source">  var matched;</td></tr><tr class="hit"><td class="line">23</td><td class="hits">11</td><td class="source">  parser.on('*', function (token) {</td></tr><tr class="hit"><td class="line">24</td><td class="hits">12</td><td class="source">    if (!matched &amp;&amp;</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source">        (token.type === types.BOOL ||</td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source">          (token.type === types.STRING &amp;&amp; strings.indexOf(token.match) === -1))</td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source">        ) {</td></tr><tr class="hit"><td class="line">28</td><td class="hits">10</td><td class="source">      this.out.push(token.match);</td></tr><tr class="hit"><td class="line">29</td><td class="hits">10</td><td class="source">      matched = true;</td></tr><tr class="hit"><td class="line">30</td><td class="hits">10</td><td class="source">      return;</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source">    }</td></tr><tr class="hit"><td class="line">32</td><td class="hits">2</td><td class="source">    utils.throwError('Unexpected token &quot;' + token.match + '&quot; in autoescape tag', line, opts.filename);</td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source">  });</td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">35</td><td class="hits">11</td><td class="source">  return true;</td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source">};</td></tr><tr class="hit"><td class="line">37</td><td class="hits">1</td><td class="source">exports.ends = true;</td></tr><tr><td class="line">38</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="/lib/tags/block.js">/lib/tags/block.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">8</div><div class="hits">8</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> * Defines a block in a template that can be overridden by a template extending this one and/or will override the current template's parent template block of the same name.</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * See &lt;a href=&quot;#inheritance&quot;&gt;Template Inheritance&lt;/a&gt; for more information.</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> * @alias block</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source"> * @example</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * {% block body %}...{% endblock %}</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> * @param {literal}  name   Name of the block for use in parent and extended templates.</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">13</td><td class="hits">1</td><td class="source">exports.compile = function (compiler, args, content, parents, options) {</td></tr><tr class="hit"><td class="line">14</td><td class="hits">24</td><td class="source">  return compiler(content, parents, options, args.join(''));</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">17</td><td class="hits">1</td><td class="source">exports.parse = function (str, line, parser) {</td></tr><tr class="hit"><td class="line">18</td><td class="hits">42</td><td class="source">  parser.on('*', function (token) {</td></tr><tr class="hit"><td class="line">19</td><td class="hits">42</td><td class="source">    this.out.push(token.match);</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source">  });</td></tr><tr class="hit"><td class="line">21</td><td class="hits">42</td><td class="source">  return true;</td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">23</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">24</td><td class="hits">1</td><td class="source">exports.ends = true;</td></tr><tr class="hit"><td class="line">25</td><td class="hits">1</td><td class="source">exports.block = true;</td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="/lib/tags/else.js">/lib/tags/else.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">6</div><div class="hits">6</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> * Used within an &lt;code data-language=&quot;swig&quot;&gt;{% if %}&lt;/code&gt; tag, the code block following this tag up until &lt;code data-language=&quot;swig&quot;&gt;{% endif %}&lt;/code&gt; will be rendered if the &lt;i&gt;if&lt;/i&gt; statement returns false.</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * @alias else</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> * @example</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> * {% if false %}</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source"> *   statement1</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * {% else %}</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> *   statement2</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> * {% endif %}</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source"> * // =&gt; statement2</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">15</td><td class="hits">1</td><td class="source">exports.compile = function () {</td></tr><tr class="hit"><td class="line">16</td><td class="hits">3</td><td class="source">  return '} else {\n';</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">19</td><td class="hits">1</td><td class="source">exports.parse = function (str, line, parser, types, stack) {</td></tr><tr class="hit"><td class="line">20</td><td class="hits">5</td><td class="source">  parser.on('*', function (token) {</td></tr><tr class="hit"><td class="line">21</td><td class="hits">1</td><td class="source">    throw new Error('&quot;else&quot; tag does not accept any tokens. Found &quot;' + token.match + '&quot; on line ' + line + '.');</td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source">  });</td></tr><tr><td class="line">23</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">24</td><td class="hits">5</td><td class="source">  return (stack.length &amp;&amp; stack[stack.length - 1].name === 'if');</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="/lib/tags/elseif.js">/lib/tags/elseif.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">6</div><div class="hits">6</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr class="hit"><td class="line">1</td><td class="hits">1</td><td class="source">var ifparser = require('./if').parse;</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * Like &lt;code data-language=&quot;swig&quot;&gt;{% else %}&lt;/code&gt;, except this tag can take more conditional statements.</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> * @alias elseif</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> * @alias elif</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * @example</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> * {% if false %}</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> *   Tacos</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source"> * {% elseif true %}</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source"> *   Burritos</td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source"> * {% else %}</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source"> *   Churros</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source"> * {% endif %}</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source"> * // =&gt; Burritos</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source"> * @param {...mixed} conditional  Conditional statement that returns a truthy or falsy value.</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">21</td><td class="hits">1</td><td class="source">exports.compile = function (compiler, args) {</td></tr><tr class="hit"><td class="line">22</td><td class="hits">5</td><td class="source">  return '} else if (' + args.join(' ') + ') {\n';</td></tr><tr><td class="line">23</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">25</td><td class="hits">1</td><td class="source">exports.parse = function (str, line, parser, types, stack) {</td></tr><tr class="hit"><td class="line">26</td><td class="hits">7</td><td class="source">  var okay = ifparser(str, line, parser, types, stack);</td></tr><tr class="hit"><td class="line">27</td><td class="hits">6</td><td class="source">  return okay &amp;&amp; (stack.length &amp;&amp; stack[stack.length - 1].name === 'if');</td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="/lib/tags/extends.js">/lib/tags/extends.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">4</div><div class="hits">4</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> * Makes the current template extend a parent template. This tag must be the first item in your template.</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * See &lt;a href=&quot;#inheritance&quot;&gt;Template Inheritance&lt;/a&gt; for more information.</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> * @alias extends</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source"> * @example</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * {% extends &quot;./layout.html&quot; %}</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> * @param {string} parentFile  Relative path to the file that this template extends.</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">13</td><td class="hits">1</td><td class="source">exports.compile = function () {};</td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">15</td><td class="hits">1</td><td class="source">exports.parse = function () {</td></tr><tr class="hit"><td class="line">16</td><td class="hits">26</td><td class="source">  return true;</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">19</td><td class="hits">1</td><td class="source">exports.ends = false;</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="/lib/tags/filter.js">/lib/tags/filter.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">29</div><div class="hits">29</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr class="hit"><td class="line">1</td><td class="hits">1</td><td class="source">var filters = require('../filters');</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * Apply a filter to an entire block of template.</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> * @alias filter</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source"> * @example</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * {% filter uppercase %}oh hi, {{ name }}{% endfilter %}</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> * // =&gt; OH HI, PAUL</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source"> * @example</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source"> * {% filter replace(&quot;.&quot;, &quot;!&quot;, &quot;g&quot;) %}Hi. My name is Paul.{% endfilter %}</td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source"> * // =&gt; Hi! My name is Paul!</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source"> * @param {function} filter  The filter that should be applied to the contents of the tag.</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">19</td><td class="hits">1</td><td class="source">exports.compile = function (compiler, args, content, parents, options, blockName) {</td></tr><tr class="hit"><td class="line">20</td><td class="hits">5</td><td class="source">  var filter = args.shift().replace(/\($/, ''),</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source">    val = '(function () {\n' +</td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source">      '  var _output = &quot;&quot;;\n' +</td></tr><tr><td class="line">23</td><td class="hits"></td><td class="source">      compiler(content, parents, options, blockName) +</td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source">      '  return _output;\n' +</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source">      '})()';</td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">27</td><td class="hits">5</td><td class="source">  if (args[args.length - 1] === ')') {</td></tr><tr class="hit"><td class="line">28</td><td class="hits">4</td><td class="source">    args.pop();</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">31</td><td class="hits">5</td><td class="source">  args = (args.length) ? ', ' + args.join('') : '';</td></tr><tr class="hit"><td class="line">32</td><td class="hits">5</td><td class="source">  return '_output += _filters[&quot;' + filter + '&quot;](' + val + args + ');\n';</td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">35</td><td class="hits">1</td><td class="source">exports.parse = function (str, line, parser, types) {</td></tr><tr class="hit"><td class="line">36</td><td class="hits">6</td><td class="source">  var filter;</td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">38</td><td class="hits">6</td><td class="source">  function check(filter) {</td></tr><tr class="hit"><td class="line">39</td><td class="hits">6</td><td class="source">    if (!filters.hasOwnProperty(filter)) {</td></tr><tr class="hit"><td class="line">40</td><td class="hits">1</td><td class="source">      throw new Error('Filter &quot;' + filter + '&quot; does not exist on line ' + line + '.');</td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">42</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">43</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">44</td><td class="hits">6</td><td class="source">  parser.on(types.FUNCTION, function (token) {</td></tr><tr class="hit"><td class="line">45</td><td class="hits">5</td><td class="source">    if (!filter) {</td></tr><tr class="hit"><td class="line">46</td><td class="hits">4</td><td class="source">      filter = token.match.replace(/\($/, '');</td></tr><tr class="hit"><td class="line">47</td><td class="hits">4</td><td class="source">      check(filter);</td></tr><tr class="hit"><td class="line">48</td><td class="hits">4</td><td class="source">      this.out.push(token.match);</td></tr><tr class="hit"><td class="line">49</td><td class="hits">4</td><td class="source">      this.state.push(token.type);</td></tr><tr class="hit"><td class="line">50</td><td class="hits">4</td><td class="source">      return;</td></tr><tr><td class="line">51</td><td class="hits"></td><td class="source">    }</td></tr><tr class="hit"><td class="line">52</td><td class="hits">1</td><td class="source">    return true;</td></tr><tr><td class="line">53</td><td class="hits"></td><td class="source">  });</td></tr><tr><td class="line">54</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">55</td><td class="hits">6</td><td class="source">  parser.on(types.VAR, function (token) {</td></tr><tr class="hit"><td class="line">56</td><td class="hits">3</td><td class="source">    if (!filter) {</td></tr><tr class="hit"><td class="line">57</td><td class="hits">2</td><td class="source">      filter = token.match;</td></tr><tr class="hit"><td class="line">58</td><td class="hits">2</td><td class="source">      check(filter);</td></tr><tr class="hit"><td class="line">59</td><td class="hits">1</td><td class="source">      this.out.push(filter);</td></tr><tr class="hit"><td class="line">60</td><td class="hits">1</td><td class="source">      return;</td></tr><tr><td class="line">61</td><td class="hits"></td><td class="source">    }</td></tr><tr class="hit"><td class="line">62</td><td class="hits">1</td><td class="source">    return true;</td></tr><tr><td class="line">63</td><td class="hits"></td><td class="source">  });</td></tr><tr><td class="line">64</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">65</td><td class="hits">6</td><td class="source">  return true;</td></tr><tr><td class="line">66</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">67</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">68</td><td class="hits">1</td><td class="source">exports.ends = true;</td></tr><tr><td class="line">69</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="/lib/tags/for.js">/lib/tags/for.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">34</div><div class="hits">34</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr class="hit"><td class="line">1</td><td class="hits">1</td><td class="source">var ctx = '_ctx.',</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source">  ctxloop = ctx + 'loop';</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * Loop over objects and arrays.</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> * @alias for</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * @example</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> * // obj = { one: 'hi', two: 'bye' };</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> * {% for x in obj %}</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source"> *   {% if loop.first %}&lt;ul&gt;{% endif %}</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source"> *   &lt;li&gt;{{ loop.index }} - {{ loop.key }}: {{ x }}&lt;/li&gt;</td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source"> *   {% if loop.last %}&lt;/ul&gt;{% endif %}</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source"> * {% endfor %}</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source"> * // =&gt; &lt;ul&gt;</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source"> * //    &lt;li&gt;1 - one: hi&lt;/li&gt;</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source"> * //    &lt;li&gt;2 - two: bye&lt;/li&gt;</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source"> * //    &lt;/ul&gt;</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source"> * @example</td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source"> * // arr = [1, 2, 3]</td></tr><tr><td class="line">23</td><td class="hits"></td><td class="source"> * // Reverse the array, shortcut the key/index to `key`</td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source"> * {% for key, val in arr|reverse %}</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source"> * {{ key }} -- {{ val }}</td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source"> * {% endfor %}</td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source"> * // =&gt; 0 -- 3</td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source"> * //    1 -- 2</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source"> * //    2 -- 1</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source"> * @param {literal} [key]     A shortcut to the index of the array or current key accessor.</td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source"> * @param {literal} variable  The current value will be assigned to this variable name temporarily. The variable will be reset upon ending the for tag.</td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source"> * @param {literal} in        Literally, &quot;in&quot;. This token is required.</td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source"> * @param {object}  object    An enumerable object that will be iterated over.</td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source"> * @return {loop.index} The current iteration of the loop (1-indexed)</td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source"> * @return {loop.index0} The current iteration of the loop (0-indexed)</td></tr><tr><td class="line">38</td><td class="hits"></td><td class="source"> * @return {loop.revindex} The number of iterations from the end of the loop (1-indexed)</td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source"> * @return {loop.revindex0} The number of iterations from the end of the loop (0-indexed)</td></tr><tr><td class="line">40</td><td class="hits"></td><td class="source"> * @return {loop.key} If the iterator is an object, this will be the key of the current item, otherwise it will be the same as the loop.index.</td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source"> * @return {loop.first} True if the current object is the first in the object or array.</td></tr><tr><td class="line">42</td><td class="hits"></td><td class="source"> * @return {loop.last} True if the current object is the last in the object or array.</td></tr><tr><td class="line">43</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">44</td><td class="hits">1</td><td class="source">exports.compile = function (compiler, args, content, parents, options, blockName) {</td></tr><tr class="hit"><td class="line">45</td><td class="hits">30</td><td class="source">  var val = args.shift(),</td></tr><tr><td class="line">46</td><td class="hits"></td><td class="source">    key = '__k',</td></tr><tr><td class="line">47</td><td class="hits"></td><td class="source">    ctxloopcache = (ctx + '__loopcache' + Math.random()).replace(/\./g, ''),</td></tr><tr><td class="line">48</td><td class="hits"></td><td class="source">    last;</td></tr><tr><td class="line">49</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">50</td><td class="hits">30</td><td class="source">  if (args[0] &amp;&amp; args[0] === ',') {</td></tr><tr class="hit"><td class="line">51</td><td class="hits">5</td><td class="source">    args.shift();</td></tr><tr class="hit"><td class="line">52</td><td class="hits">5</td><td class="source">    key = val;</td></tr><tr class="hit"><td class="line">53</td><td class="hits">5</td><td class="source">    val = args.shift();</td></tr><tr><td class="line">54</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">55</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">56</td><td class="hits">30</td><td class="source">  last = args.join('');</td></tr><tr><td class="line">57</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">58</td><td class="hits">30</td><td class="source">  return [</td></tr><tr><td class="line">59</td><td class="hits"></td><td class="source">    '(function () {\n',</td></tr><tr><td class="line">60</td><td class="hits"></td><td class="source">    '  var __l = ' + last + ', __len = (_utils.isArray(__l) || typeof __l === &quot;string&quot;) ? __l.length : _utils.keys(__l).length;\n',</td></tr><tr><td class="line">61</td><td class="hits"></td><td class="source">    '  if (!__l) { return; }\n',</td></tr><tr><td class="line">62</td><td class="hits"></td><td class="source">    '    var ' + ctxloopcache + ' = { loop: ' + ctxloop + ', ' + val + ': ' + ctx + val + ', ' + key + ': ' + ctx + key + ' };\n',</td></tr><tr><td class="line">63</td><td class="hits"></td><td class="source">    '    ' + ctxloop + ' = { first: false, index: 1, index0: 0, revindex: __len, revindex0: __len - 1, length: __len, last: false };\n',</td></tr><tr><td class="line">64</td><td class="hits"></td><td class="source">    '  _utils.each(__l, function (' + val + ', ' + key + ') {\n',</td></tr><tr><td class="line">65</td><td class="hits"></td><td class="source">    '    ' + ctx + val + ' = ' + val + ';\n',</td></tr><tr><td class="line">66</td><td class="hits"></td><td class="source">    '    ' + ctx + key + ' = ' + key + ';\n',</td></tr><tr><td class="line">67</td><td class="hits"></td><td class="source">    '    ' + ctxloop + '.key = ' + key + ';\n',</td></tr><tr><td class="line">68</td><td class="hits"></td><td class="source">    '    ' + ctxloop + '.first = (' + ctxloop + '.index0 === 0);\n',</td></tr><tr><td class="line">69</td><td class="hits"></td><td class="source">    '    ' + ctxloop + '.last = (' + ctxloop + '.revindex0 === 0);\n',</td></tr><tr><td class="line">70</td><td class="hits"></td><td class="source">    '    ' + compiler(content, parents, options, blockName),</td></tr><tr><td class="line">71</td><td class="hits"></td><td class="source">    '    ' + ctxloop + '.index += 1; ' + ctxloop + '.index0 += 1; ' + ctxloop + '.revindex -= 1; ' + ctxloop + '.revindex0 -= 1;\n',</td></tr><tr><td class="line">72</td><td class="hits"></td><td class="source">    '  });\n',</td></tr><tr><td class="line">73</td><td class="hits"></td><td class="source">    '  ' + ctxloop + ' = ' + ctxloopcache + '.loop;\n',</td></tr><tr><td class="line">74</td><td class="hits"></td><td class="source">    '  ' + ctx + val + ' = ' + ctxloopcache + '.' + val + ';\n',</td></tr><tr><td class="line">75</td><td class="hits"></td><td class="source">    '  ' + ctx + key + ' = ' + ctxloopcache + '.' + key + ';\n',</td></tr><tr><td class="line">76</td><td class="hits"></td><td class="source">    '  ' + ctxloopcache + ' = undefined;\n',</td></tr><tr><td class="line">77</td><td class="hits"></td><td class="source">    '})();\n'</td></tr><tr><td class="line">78</td><td class="hits"></td><td class="source">  ].join('');</td></tr><tr><td class="line">79</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">80</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">81</td><td class="hits">1</td><td class="source">exports.parse = function (str, line, parser, types) {</td></tr><tr class="hit"><td class="line">82</td><td class="hits">32</td><td class="source">  var firstVar, ready;</td></tr><tr><td class="line">83</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">84</td><td class="hits">32</td><td class="source">  parser.on(types.NUMBER, function (token) {</td></tr><tr class="hit"><td class="line">85</td><td class="hits">4</td><td class="source">    var lastState = this.state.length ? this.state[this.state.length - 1] : null;</td></tr><tr class="hit"><td class="line">86</td><td class="hits">4</td><td class="source">    if (!ready ||</td></tr><tr><td class="line">87</td><td class="hits"></td><td class="source">        (lastState !== types.ARRAYOPEN &amp;&amp;</td></tr><tr><td class="line">88</td><td class="hits"></td><td class="source">          lastState !== types.CURLYOPEN &amp;&amp;</td></tr><tr><td class="line">89</td><td class="hits"></td><td class="source">          lastState !== types.CURLYCLOSE &amp;&amp;</td></tr><tr><td class="line">90</td><td class="hits"></td><td class="source">          lastState !== types.FUNCTION &amp;&amp;</td></tr><tr><td class="line">91</td><td class="hits"></td><td class="source">          lastState !== types.FILTER)</td></tr><tr><td class="line">92</td><td class="hits"></td><td class="source">        ) {</td></tr><tr class="hit"><td class="line">93</td><td class="hits">1</td><td class="source">      throw new Error('Unexpected number &quot;' + token.match + '&quot; on line ' + line + '.');</td></tr><tr><td class="line">94</td><td class="hits"></td><td class="source">    }</td></tr><tr class="hit"><td class="line">95</td><td class="hits">3</td><td class="source">    return true;</td></tr><tr><td class="line">96</td><td class="hits"></td><td class="source">  });</td></tr><tr><td class="line">97</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">98</td><td class="hits">32</td><td class="source">  parser.on(types.VAR, function (token) {</td></tr><tr class="hit"><td class="line">99</td><td class="hits">65</td><td class="source">    if (ready &amp;&amp; firstVar) {</td></tr><tr class="hit"><td class="line">100</td><td class="hits">28</td><td class="source">      return true;</td></tr><tr><td class="line">101</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">102</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">103</td><td class="hits">37</td><td class="source">    if (!this.out.length) {</td></tr><tr class="hit"><td class="line">104</td><td class="hits">32</td><td class="source">      firstVar = true;</td></tr><tr><td class="line">105</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">106</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">107</td><td class="hits">37</td><td class="source">    this.out.push(token.match);</td></tr><tr><td class="line">108</td><td class="hits"></td><td class="source">  });</td></tr><tr><td class="line">109</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">110</td><td class="hits">32</td><td class="source">  parser.on(types.COMMA, function (token) {</td></tr><tr class="hit"><td class="line">111</td><td class="hits">7</td><td class="source">    if (firstVar &amp;&amp; this.prevToken.type === types.VAR) {</td></tr><tr class="hit"><td class="line">112</td><td class="hits">5</td><td class="source">      this.out.push(token.match);</td></tr><tr class="hit"><td class="line">113</td><td class="hits">5</td><td class="source">      return;</td></tr><tr><td class="line">114</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">115</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">116</td><td class="hits">2</td><td class="source">    return true;</td></tr><tr><td class="line">117</td><td class="hits"></td><td class="source">  });</td></tr><tr><td class="line">118</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">119</td><td class="hits">32</td><td class="source">  parser.on(types.COMPARATOR, function (token) {</td></tr><tr class="hit"><td class="line">120</td><td class="hits">32</td><td class="source">    if (token.match !== 'in' || !firstVar) {</td></tr><tr class="hit"><td class="line">121</td><td class="hits">1</td><td class="source">      throw new Error('Unexpected token &quot;' + token.match + '&quot; on line ' + line + '.');</td></tr><tr><td class="line">122</td><td class="hits"></td><td class="source">    }</td></tr><tr class="hit"><td class="line">123</td><td class="hits">31</td><td class="source">    ready = true;</td></tr><tr class="hit"><td class="line">124</td><td class="hits">31</td><td class="source">    this.filterApplyIdx.push(this.out.length);</td></tr><tr><td class="line">125</td><td class="hits"></td><td class="source">  });</td></tr><tr><td class="line">126</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">127</td><td class="hits">32</td><td class="source">  return true;</td></tr><tr><td class="line">128</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">129</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">130</td><td class="hits">1</td><td class="source">exports.ends = true;</td></tr><tr><td class="line">131</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="/lib/tags/if.js">/lib/tags/if.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">25</div><div class="hits">25</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> * Used to create conditional statements in templates. Accepts most JavaScript valid comparisons.</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * Can be used in conjunction with &lt;a href=&quot;#elseif&quot;&gt;&lt;code data-language=&quot;swig&quot;&gt;{% elseif ... %}&lt;/code&gt;&lt;/a&gt; and &lt;a href=&quot;#else&quot;&gt;&lt;code data-language=&quot;swig&quot;&gt;{% else %}&lt;/code&gt;&lt;/a&gt; tags.</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> * @alias if</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source"> * @example</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * {% if x %}{% endif %}</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> * {% if !x %}{% endif %}</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> * {% if not x %}{% endif %}</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source"> * @example</td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source"> * {% if x and y %}{% endif %}</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source"> * {% if x &amp;&amp; y %}{% endif %}</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source"> * {% if x or y %}{% endif %}</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source"> * {% if x || y %}{% endif %}</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source"> * {% if x || (y &amp;&amp; z) %}{% endif %}</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> * @example</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source"> * {% if x [operator] y %}</td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source"> *   Operators: ==, !=, &lt;, &lt;=, &gt;, &gt;=, ===, !==</td></tr><tr><td class="line">23</td><td class="hits"></td><td class="source"> * {% endif %}</td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source"> * @example</td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source"> * {% if x == 'five' %}</td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source"> *   The operands can be also be string or number literals</td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source"> * {% endif %}</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source"> * @example</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source"> * {% if x|lower === 'tacos' %}</td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source"> *   You can use filters on any operand in the statement.</td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source"> * {% endif %}</td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source"> * @example</td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source"> * {% if x in y %}</td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source"> *   If x is a value that is present in y, this will return true.</td></tr><tr><td class="line">38</td><td class="hits"></td><td class="source"> * {% endif %}</td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">40</td><td class="hits"></td><td class="source"> * @param {...mixed} conditional Conditional statement that returns a truthy or falsy value.</td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">42</td><td class="hits">1</td><td class="source">exports.compile = function (compiler, args, content, parents, options, blockName) {</td></tr><tr class="hit"><td class="line">43</td><td class="hits">52</td><td class="source">  return 'if (' + args.join(' ') + ') { \n' +</td></tr><tr><td class="line">44</td><td class="hits"></td><td class="source">    compiler(content, parents, options, blockName) + '\n' +</td></tr><tr><td class="line">45</td><td class="hits"></td><td class="source">    '}';</td></tr><tr><td class="line">46</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">47</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">48</td><td class="hits">1</td><td class="source">exports.parse = function (str, line, parser, types) {</td></tr><tr class="hit"><td class="line">49</td><td class="hits">68</td><td class="source">  if (typeof str === &quot;undefined&quot;) {</td></tr><tr class="hit"><td class="line">50</td><td class="hits">2</td><td class="source">    throw new Error('No conditional statement provided on line ' + line + '.');</td></tr><tr><td class="line">51</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">52</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">53</td><td class="hits">66</td><td class="source">  parser.on(types.COMPARATOR, function (token) {</td></tr><tr class="hit"><td class="line">54</td><td class="hits">24</td><td class="source">    if (this.isLast) {</td></tr><tr class="hit"><td class="line">55</td><td class="hits">1</td><td class="source">      throw new Error('Unexpected logic &quot;' + token.match + '&quot; on line ' + line + '.');</td></tr><tr><td class="line">56</td><td class="hits"></td><td class="source">    }</td></tr><tr class="hit"><td class="line">57</td><td class="hits">23</td><td class="source">    if (this.prevToken.type === types.NOT) {</td></tr><tr class="hit"><td class="line">58</td><td class="hits">1</td><td class="source">      throw new Error('Attempted logic &quot;not ' + token.match + '&quot; on line ' + line + '. Use !(foo ' + token.match + ') instead.');</td></tr><tr><td class="line">59</td><td class="hits"></td><td class="source">    }</td></tr><tr class="hit"><td class="line">60</td><td class="hits">22</td><td class="source">    this.out.push(token.match);</td></tr><tr class="hit"><td class="line">61</td><td class="hits">22</td><td class="source">    this.filterApplyIdx.push(this.out.length);</td></tr><tr><td class="line">62</td><td class="hits"></td><td class="source">  });</td></tr><tr><td class="line">63</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">64</td><td class="hits">66</td><td class="source">  parser.on(types.NOT, function (token) {</td></tr><tr class="hit"><td class="line">65</td><td class="hits">7</td><td class="source">    if (this.isLast) {</td></tr><tr class="hit"><td class="line">66</td><td class="hits">1</td><td class="source">      throw new Error('Unexpected logic &quot;' + token.match + '&quot; on line ' + line + '.');</td></tr><tr><td class="line">67</td><td class="hits"></td><td class="source">    }</td></tr><tr class="hit"><td class="line">68</td><td class="hits">6</td><td class="source">    this.out.push(token.match);</td></tr><tr><td class="line">69</td><td class="hits"></td><td class="source">  });</td></tr><tr><td class="line">70</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">71</td><td class="hits">66</td><td class="source">  parser.on(types.BOOL, function (token) {</td></tr><tr class="hit"><td class="line">72</td><td class="hits">20</td><td class="source">    this.out.push(token.match);</td></tr><tr><td class="line">73</td><td class="hits"></td><td class="source">  });</td></tr><tr><td class="line">74</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">75</td><td class="hits">66</td><td class="source">  parser.on(types.LOGIC, function (token) {</td></tr><tr class="hit"><td class="line">76</td><td class="hits">6</td><td class="source">    if (!this.out.length || this.isLast) {</td></tr><tr class="hit"><td class="line">77</td><td class="hits">2</td><td class="source">      throw new Error('Unexpected logic &quot;' + token.match + '&quot; on line ' + line + '.');</td></tr><tr><td class="line">78</td><td class="hits"></td><td class="source">    }</td></tr><tr class="hit"><td class="line">79</td><td class="hits">4</td><td class="source">    this.out.push(token.match);</td></tr><tr class="hit"><td class="line">80</td><td class="hits">4</td><td class="source">    this.filterApplyIdx.pop();</td></tr><tr><td class="line">81</td><td class="hits"></td><td class="source">  });</td></tr><tr><td class="line">82</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">83</td><td class="hits">66</td><td class="source">  return true;</td></tr><tr><td class="line">84</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">85</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">86</td><td class="hits">1</td><td class="source">exports.ends = true;</td></tr><tr><td class="line">87</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="/lib/tags/import.js">/lib/tags/import.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">36</div><div class="hits">36</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr class="hit"><td class="line">1</td><td class="hits">1</td><td class="source">var utils = require('../utils');</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * Allows you to import macros from another file directly into your current context.</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * The import tag is specifically designed for importing macros into your template with a specific context scope. This is very useful for keeping your macros from overriding template context that is being injected by your server-side page generation.</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> * @alias import</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * @example</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> * {% import './formmacros.html' as forms %}</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> * {{ form.input(&quot;text&quot;, &quot;name&quot;) }}</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source"> * // =&gt; &lt;input type=&quot;text&quot; name=&quot;name&quot;&gt;</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source"> * @example</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source"> * {% import &quot;../shared/tags.html&quot; as tags %}</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source"> * {{ tags.stylesheet('global') }}</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source"> * // =&gt; &lt;link rel=&quot;stylesheet&quot; href=&quot;/global.css&quot;&gt;</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source"> * @param {string|var}  file      Relative path from the current template file to the file to import macros from.</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> * @param {literal}     as        Literally, &quot;as&quot;.</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source"> * @param {literal}     varname   Local-accessible object name to assign the macros to.</td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">23</td><td class="hits">1</td><td class="source">exports.compile = function (compiler, args) {</td></tr><tr class="hit"><td class="line">24</td><td class="hits">2</td><td class="source">  var ctx = args.pop(),</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source">    out = '_ctx.' + ctx + ' = {};\n  var _output = &quot;&quot;;\n',</td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source">    replacements = utils.map(args, function (arg) {</td></tr><tr class="hit"><td class="line">27</td><td class="hits">8</td><td class="source">      return {</td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source">        ex: new RegExp('_ctx.' + arg.name, 'g'),</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source">        re: '_ctx.' + ctx + '.' + arg.name</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source">      };</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source">  // Replace all occurrences of all macros in this file with</td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source">  // proper namespaced definitions and calls</td></tr><tr class="hit"><td class="line">35</td><td class="hits">2</td><td class="source">  utils.each(args, function (arg) {</td></tr><tr class="hit"><td class="line">36</td><td class="hits">8</td><td class="source">    var c = arg.compiled;</td></tr><tr class="hit"><td class="line">37</td><td class="hits">8</td><td class="source">    utils.each(replacements, function (re) {</td></tr><tr class="hit"><td class="line">38</td><td class="hits">32</td><td class="source">      c = c.replace(re.ex, re.re);</td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source">    });</td></tr><tr class="hit"><td class="line">40</td><td class="hits">8</td><td class="source">    out += c;</td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source">  });</td></tr><tr><td class="line">42</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">43</td><td class="hits">2</td><td class="source">  return out;</td></tr><tr><td class="line">44</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">45</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">46</td><td class="hits">1</td><td class="source">exports.parse = function (str, line, parser, types, stack, opts, swig) {</td></tr><tr class="hit"><td class="line">47</td><td class="hits">5</td><td class="source">  var compiler = require('../parser').compile,</td></tr><tr><td class="line">48</td><td class="hits"></td><td class="source">    parseOpts = { resolveFrom: opts.filename },</td></tr><tr><td class="line">49</td><td class="hits"></td><td class="source">    compileOpts = utils.extend({}, opts, parseOpts),</td></tr><tr><td class="line">50</td><td class="hits"></td><td class="source">    tokens,</td></tr><tr><td class="line">51</td><td class="hits"></td><td class="source">    ctx;</td></tr><tr><td class="line">52</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">53</td><td class="hits">5</td><td class="source">  parser.on(types.STRING, function (token) {</td></tr><tr class="hit"><td class="line">54</td><td class="hits">5</td><td class="source">    var self = this;</td></tr><tr class="hit"><td class="line">55</td><td class="hits">5</td><td class="source">    if (!tokens) {</td></tr><tr class="hit"><td class="line">56</td><td class="hits">4</td><td class="source">      tokens = swig.parseFile(token.match.replace(/^(&quot;|')|(&quot;|')$/g, ''), parseOpts).tokens;</td></tr><tr class="hit"><td class="line">57</td><td class="hits">4</td><td class="source">      utils.each(tokens, function (token) {</td></tr><tr class="hit"><td class="line">58</td><td class="hits">38</td><td class="source">        var out = '',</td></tr><tr><td class="line">59</td><td class="hits"></td><td class="source">          macroName;</td></tr><tr class="hit"><td class="line">60</td><td class="hits">38</td><td class="source">        if (!token || token.name !== 'macro' || !token.compile) {</td></tr><tr class="hit"><td class="line">61</td><td class="hits">26</td><td class="source">          return;</td></tr><tr><td class="line">62</td><td class="hits"></td><td class="source">        }</td></tr><tr class="hit"><td class="line">63</td><td class="hits">12</td><td class="source">        macroName = token.args[0];</td></tr><tr class="hit"><td class="line">64</td><td class="hits">12</td><td class="source">        out += token.compile(compiler, token.args, token.content, [], compileOpts) + '\n';</td></tr><tr class="hit"><td class="line">65</td><td class="hits">12</td><td class="source">        self.out.push({compiled: out, name: macroName});</td></tr><tr><td class="line">66</td><td class="hits"></td><td class="source">      });</td></tr><tr class="hit"><td class="line">67</td><td class="hits">4</td><td class="source">      return;</td></tr><tr><td class="line">68</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">69</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">70</td><td class="hits">1</td><td class="source">    throw new Error('Unexpected string ' + token.match + ' on line ' + line + '.');</td></tr><tr><td class="line">71</td><td class="hits"></td><td class="source">  });</td></tr><tr><td class="line">72</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">73</td><td class="hits">5</td><td class="source">  parser.on(types.VAR, function (token) {</td></tr><tr class="hit"><td class="line">74</td><td class="hits">7</td><td class="source">    var self = this;</td></tr><tr class="hit"><td class="line">75</td><td class="hits">7</td><td class="source">    if (!tokens || ctx) {</td></tr><tr class="hit"><td class="line">76</td><td class="hits">1</td><td class="source">      throw new Error('Unexpected variable &quot;' + token.match + '&quot; on line ' + line + '.');</td></tr><tr><td class="line">77</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">78</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">79</td><td class="hits">6</td><td class="source">    if (token.match === 'as') {</td></tr><tr class="hit"><td class="line">80</td><td class="hits">3</td><td class="source">      return;</td></tr><tr><td class="line">81</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">82</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">83</td><td class="hits">3</td><td class="source">    ctx = token.match;</td></tr><tr class="hit"><td class="line">84</td><td class="hits">3</td><td class="source">    self.out.push(ctx);</td></tr><tr class="hit"><td class="line">85</td><td class="hits">3</td><td class="source">    return false;</td></tr><tr><td class="line">86</td><td class="hits"></td><td class="source">  });</td></tr><tr><td class="line">87</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">88</td><td class="hits">5</td><td class="source">  return true;</td></tr><tr><td class="line">89</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">90</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">91</td><td class="hits">1</td><td class="source">exports.block = true;</td></tr><tr><td class="line">92</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="/lib/tags/include.js">/lib/tags/include.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">35</div><div class="hits">35</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr class="hit"><td class="line">1</td><td class="hits">1</td><td class="source">var ignore = 'ignore',</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source">  missing = 'missing',</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source">  only = 'only';</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> * Includes a template partial in place. The template is rendered within the current locals variable context.</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source"> * @alias include</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> * @example</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> * // food = 'burritos';</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source"> * // drink = 'lemonade';</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source"> * {% include &quot;./partial.html&quot; %}</td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source"> * // =&gt; I like burritos and lemonade.</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source"> * @example</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source"> * // my_obj = { food: 'tacos', drink: 'horchata' };</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source"> * {% include &quot;./partial.html&quot; with my_obj only %}</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source"> * // =&gt; I like tacos and horchata.</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source"> * @example</td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source"> * {% include &quot;/this/file/does/not/exist&quot; ignore missing %}</td></tr><tr><td class="line">23</td><td class="hits"></td><td class="source"> * // =&gt; (Nothing! empty string)</td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source"> * @param {string|var}  file      The path, relative to the template root, to render into the current context.</td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source"> * @param {literal}     [with]    Literally, &quot;with&quot;.</td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source"> * @param {object}      [context] Local variable key-value object context to provide to the included file.</td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source"> * @param {literal}     [only]    Restricts to &lt;strong&gt;only&lt;/strong&gt; passing the &lt;code&gt;with context&lt;/code&gt; as local variablesthe included template will not be aware of any other local variables in the parent template. For best performance, usage of this option is recommended if possible.</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source"> * @param {literal}     [ignore missing] Will output empty string if not found instead of throwing an error.</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">31</td><td class="hits">1</td><td class="source">exports.compile = function (compiler, args) {</td></tr><tr class="hit"><td class="line">32</td><td class="hits">12</td><td class="source">  var file = args.shift(),</td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source">    onlyIdx = args.indexOf(only),</td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source">    onlyCtx = onlyIdx !== -1 ? args.splice(onlyIdx, 1) : false,</td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source">    parentFile = (args.pop() || '').replace(/\\/g, '\\\\'),</td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source">    ignore = args[args.length - 1] === missing ? (args.pop()) : false,</td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source">    w = args.join('');</td></tr><tr><td class="line">38</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">39</td><td class="hits">12</td><td class="source">  return (ignore ? '  try {\n' : '') +</td></tr><tr><td class="line">40</td><td class="hits"></td><td class="source">    '_output += _swig.compileFile(' + file + ', {' +</td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source">    'resolveFrom: &quot;' + parentFile + '&quot;' +</td></tr><tr><td class="line">42</td><td class="hits"></td><td class="source">    '})(' +</td></tr><tr><td class="line">43</td><td class="hits"></td><td class="source">    ((onlyCtx &amp;&amp; w) ? w : (!w ? '_ctx' : '_utils.extend({}, _ctx, ' + w + ')')) +</td></tr><tr><td class="line">44</td><td class="hits"></td><td class="source">    ');\n' +</td></tr><tr><td class="line">45</td><td class="hits"></td><td class="source">    (ignore ? '} catch (e) {}\n' : '');</td></tr><tr><td class="line">46</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">47</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">48</td><td class="hits">1</td><td class="source">exports.parse = function (str, line, parser, types, stack, opts) {</td></tr><tr class="hit"><td class="line">49</td><td class="hits">14</td><td class="source">  var file, w;</td></tr><tr class="hit"><td class="line">50</td><td class="hits">14</td><td class="source">  parser.on(types.STRING, function (token) {</td></tr><tr class="hit"><td class="line">51</td><td class="hits">17</td><td class="source">    if (!file) {</td></tr><tr class="hit"><td class="line">52</td><td class="hits">13</td><td class="source">      file = token.match;</td></tr><tr class="hit"><td class="line">53</td><td class="hits">13</td><td class="source">      this.out.push(file);</td></tr><tr class="hit"><td class="line">54</td><td class="hits">13</td><td class="source">      return;</td></tr><tr><td class="line">55</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">56</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">57</td><td class="hits">4</td><td class="source">    return true;</td></tr><tr><td class="line">58</td><td class="hits"></td><td class="source">  });</td></tr><tr><td class="line">59</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">60</td><td class="hits">14</td><td class="source">  parser.on(types.VAR, function (token) {</td></tr><tr class="hit"><td class="line">61</td><td class="hits">15</td><td class="source">    if (!file) {</td></tr><tr class="hit"><td class="line">62</td><td class="hits">1</td><td class="source">      file = token.match;</td></tr><tr class="hit"><td class="line">63</td><td class="hits">1</td><td class="source">      return true;</td></tr><tr><td class="line">64</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">65</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">66</td><td class="hits">14</td><td class="source">    if (!w &amp;&amp; token.match === 'with') {</td></tr><tr class="hit"><td class="line">67</td><td class="hits">2</td><td class="source">      w = true;</td></tr><tr class="hit"><td class="line">68</td><td class="hits">2</td><td class="source">      return;</td></tr><tr><td class="line">69</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">70</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">71</td><td class="hits">12</td><td class="source">    if (w &amp;&amp; token.match === only &amp;&amp; this.prevToken.match !== 'with') {</td></tr><tr class="hit"><td class="line">72</td><td class="hits">1</td><td class="source">      this.out.push(token.match);</td></tr><tr class="hit"><td class="line">73</td><td class="hits">1</td><td class="source">      return;</td></tr><tr><td class="line">74</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">75</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">76</td><td class="hits">11</td><td class="source">    if (token.match === ignore) {</td></tr><tr class="hit"><td class="line">77</td><td class="hits">3</td><td class="source">      return false;</td></tr><tr><td class="line">78</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">79</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">80</td><td class="hits">8</td><td class="source">    if (token.match === missing) {</td></tr><tr class="hit"><td class="line">81</td><td class="hits">3</td><td class="source">      if (this.prevToken.match !== ignore) {</td></tr><tr class="hit"><td class="line">82</td><td class="hits">1</td><td class="source">        throw new Error('Unexpected token &quot;' + missing + '&quot; on line ' + line + '.');</td></tr><tr><td class="line">83</td><td class="hits"></td><td class="source">      }</td></tr><tr class="hit"><td class="line">84</td><td class="hits">2</td><td class="source">      this.out.push(token.match);</td></tr><tr class="hit"><td class="line">85</td><td class="hits">2</td><td class="source">      return false;</td></tr><tr><td class="line">86</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">87</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">88</td><td class="hits">5</td><td class="source">    if (this.prevToken.match === ignore) {</td></tr><tr class="hit"><td class="line">89</td><td class="hits">1</td><td class="source">      throw new Error('Expected &quot;' + missing + '&quot; on line ' + line + ' but found &quot;' + token.match + '&quot;.');</td></tr><tr><td class="line">90</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">91</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">92</td><td class="hits">4</td><td class="source">    return true;</td></tr><tr><td class="line">93</td><td class="hits"></td><td class="source">  });</td></tr><tr><td class="line">94</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">95</td><td class="hits">14</td><td class="source">  parser.on('end', function () {</td></tr><tr class="hit"><td class="line">96</td><td class="hits">12</td><td class="source">    this.out.push(opts.filename || null);</td></tr><tr><td class="line">97</td><td class="hits"></td><td class="source">  });</td></tr><tr><td class="line">98</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">99</td><td class="hits">14</td><td class="source">  return true;</td></tr><tr><td class="line">100</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">101</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="/lib/tags/index.js">/lib/tags/index.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">16</div><div class="hits">16</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr class="hit"><td class="line">1</td><td class="hits">1</td><td class="source">exports.autoescape = require('./autoescape');</td></tr><tr class="hit"><td class="line">2</td><td class="hits">1</td><td class="source">exports.block = require('./block');</td></tr><tr class="hit"><td class="line">3</td><td class="hits">1</td><td class="source">exports[&quot;else&quot;] = require('./else');</td></tr><tr class="hit"><td class="line">4</td><td class="hits">1</td><td class="source">exports.elseif = require('./elseif');</td></tr><tr class="hit"><td class="line">5</td><td class="hits">1</td><td class="source">exports.elif = exports.elseif;</td></tr><tr class="hit"><td class="line">6</td><td class="hits">1</td><td class="source">exports[&quot;extends&quot;] = require('./extends');</td></tr><tr class="hit"><td class="line">7</td><td class="hits">1</td><td class="source">exports.filter = require('./filter');</td></tr><tr class="hit"><td class="line">8</td><td class="hits">1</td><td class="source">exports[&quot;for&quot;] = require('./for');</td></tr><tr class="hit"><td class="line">9</td><td class="hits">1</td><td class="source">exports[&quot;if&quot;] = require('./if');</td></tr><tr class="hit"><td class="line">10</td><td class="hits">1</td><td class="source">exports[&quot;import&quot;] = require('./import');</td></tr><tr class="hit"><td class="line">11</td><td class="hits">1</td><td class="source">exports.include = require('./include');</td></tr><tr class="hit"><td class="line">12</td><td class="hits">1</td><td class="source">exports.macro = require('./macro');</td></tr><tr class="hit"><td class="line">13</td><td class="hits">1</td><td class="source">exports.parent = require('./parent');</td></tr><tr class="hit"><td class="line">14</td><td class="hits">1</td><td class="source">exports.raw = require('./raw');</td></tr><tr class="hit"><td class="line">15</td><td class="hits">1</td><td class="source">exports.set = require('./set');</td></tr><tr class="hit"><td class="line">16</td><td class="hits">1</td><td class="source">exports.spaceless = require('./spaceless');</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="/lib/tags/macro.js">/lib/tags/macro.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">29</div><div class="hits">29</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> * Create custom, reusable snippets within your templates.</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * Can be imported from one template to another using the &lt;a href=&quot;#import&quot;&gt;&lt;code data-language=&quot;swig&quot;&gt;{% import ... %}&lt;/code&gt;&lt;/a&gt; tag.</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * @alias macro</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> * @example</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source"> * {% macro input(type, name, id, label, value, error) %}</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> *   &lt;label for=&quot;{{ name }}&quot;&gt;{{ label }}&lt;/label&gt;</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> *   &lt;input type=&quot;{{ type }}&quot; name=&quot;{{ name }}&quot; id=&quot;{{ id }}&quot; value=&quot;{{ value }}&quot;{% if error %} class=&quot;error&quot;{% endif %}&gt;</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> * {% endmacro %}</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source"> * {{ input(&quot;text&quot;, &quot;fname&quot;, &quot;fname&quot;, &quot;First Name&quot;, fname.value, fname.errors) }}</td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source"> * // =&gt; &lt;label for=&quot;fname&quot;&gt;First Name&lt;/label&gt;</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source"> * //    &lt;input type=&quot;text&quot; name=&quot;fname&quot; id=&quot;fname&quot; value=&quot;&quot;&gt;</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source"> * @param {...arguments} arguments  User-defined arguments.</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">19</td><td class="hits">1</td><td class="source">exports.compile = function (compiler, args, content, parents, options, blockName) {</td></tr><tr class="hit"><td class="line">20</td><td class="hits">32</td><td class="source">  var fnName = args.shift();</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">22</td><td class="hits">32</td><td class="source">  return '_ctx.' + fnName + ' = function (' + args.join('') + ') {\n' +</td></tr><tr><td class="line">23</td><td class="hits"></td><td class="source">    '  var _output = &quot;&quot;,\n' +</td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source">    '    __ctx = _utils.extend({}, _ctx);\n' +</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source">    '  _utils.each(_ctx, function (v, k) {\n' +</td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source">    '    if ([&quot;' + args.join('&quot;,&quot;') + '&quot;].indexOf(k) !== -1) { delete _ctx[k]; }\n' +</td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source">    '  });\n' +</td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source">    compiler(content, parents, options, blockName) + '\n' +</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source">    ' _ctx = _utils.extend(_ctx, __ctx);\n' +</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source">    '  return _output;\n' +</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source">    '};\n' +</td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source">    '_ctx.' + fnName + '.safe = true;\n';</td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">35</td><td class="hits">1</td><td class="source">exports.parse = function (str, line, parser, types) {</td></tr><tr class="hit"><td class="line">36</td><td class="hits">34</td><td class="source">  var name;</td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">38</td><td class="hits">34</td><td class="source">  parser.on(types.VAR, function (token) {</td></tr><tr class="hit"><td class="line">39</td><td class="hits">27</td><td class="source">    if (token.match.indexOf('.') !== -1) {</td></tr><tr class="hit"><td class="line">40</td><td class="hits">1</td><td class="source">      throw new Error('Unexpected dot in macro argument &quot;' + token.match + '&quot; on line ' + line + '.');</td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source">    }</td></tr><tr class="hit"><td class="line">42</td><td class="hits">26</td><td class="source">    this.out.push(token.match);</td></tr><tr><td class="line">43</td><td class="hits"></td><td class="source">  });</td></tr><tr><td class="line">44</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">45</td><td class="hits">34</td><td class="source">  parser.on(types.FUNCTION, function (token) {</td></tr><tr class="hit"><td class="line">46</td><td class="hits">16</td><td class="source">    if (!name) {</td></tr><tr class="hit"><td class="line">47</td><td class="hits">16</td><td class="source">      name = token.match;</td></tr><tr class="hit"><td class="line">48</td><td class="hits">16</td><td class="source">      this.out.push(name);</td></tr><tr class="hit"><td class="line">49</td><td class="hits">16</td><td class="source">      this.state.push(types.FUNCTION);</td></tr><tr><td class="line">50</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">51</td><td class="hits"></td><td class="source">  });</td></tr><tr><td class="line">52</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">53</td><td class="hits">34</td><td class="source">  parser.on(types.FUNCTIONEMPTY, function (token) {</td></tr><tr class="hit"><td class="line">54</td><td class="hits">15</td><td class="source">    if (!name) {</td></tr><tr class="hit"><td class="line">55</td><td class="hits">15</td><td class="source">      name = token.match;</td></tr><tr class="hit"><td class="line">56</td><td class="hits">15</td><td class="source">      this.out.push(name);</td></tr><tr><td class="line">57</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">58</td><td class="hits"></td><td class="source">  });</td></tr><tr><td class="line">59</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">60</td><td class="hits">34</td><td class="source">  parser.on(types.PARENCLOSE, function () {</td></tr><tr class="hit"><td class="line">61</td><td class="hits">15</td><td class="source">    if (this.isLast) {</td></tr><tr class="hit"><td class="line">62</td><td class="hits">14</td><td class="source">      return;</td></tr><tr><td class="line">63</td><td class="hits"></td><td class="source">    }</td></tr><tr class="hit"><td class="line">64</td><td class="hits">1</td><td class="source">    throw new Error('Unexpected parenthesis close on line ' + line + '.');</td></tr><tr><td class="line">65</td><td class="hits"></td><td class="source">  });</td></tr><tr><td class="line">66</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">67</td><td class="hits">34</td><td class="source">  parser.on(types.COMMA, function () {</td></tr><tr class="hit"><td class="line">68</td><td class="hits">8</td><td class="source">    return true;</td></tr><tr><td class="line">69</td><td class="hits"></td><td class="source">  });</td></tr><tr><td class="line">70</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">71</td><td class="hits">34</td><td class="source">  parser.on('*', function () {</td></tr><tr class="hit"><td class="line">72</td><td class="hits">8</td><td class="source">    return;</td></tr><tr><td class="line">73</td><td class="hits"></td><td class="source">  });</td></tr><tr><td class="line">74</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">75</td><td class="hits">34</td><td class="source">  return true;</td></tr><tr><td class="line">76</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">77</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">78</td><td class="hits">1</td><td class="source">exports.ends = true;</td></tr><tr class="hit"><td class="line">79</td><td class="hits">1</td><td class="source">exports.block = true;</td></tr><tr><td class="line">80</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="/lib/tags/parent.js">/lib/tags/parent.js</h2><div id="stats" class="high"><div class="percentage">94%</div><div class="sloc">17</div><div class="hits">16</div><div class="misses">1</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> * Inject the content from the parent template's block of the same name into the current block.</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * See &lt;a href=&quot;#inheritance&quot;&gt;Template Inheritance&lt;/a&gt; for more information.</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> * @alias parent</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source"> * @example</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * {% extends &quot;./foo.html&quot; %}</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> * {% block content %}</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> *   My content.</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source"> *   {% parent %}</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source"> * {% endblock %}</td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">16</td><td class="hits">1</td><td class="source">exports.compile = function (compiler, args, content, parents, options, blockName) {</td></tr><tr class="hit"><td class="line">17</td><td class="hits">5</td><td class="source">  if (!parents || !parents.length) {</td></tr><tr class="hit"><td class="line">18</td><td class="hits">1</td><td class="source">    return '';</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">21</td><td class="hits">4</td><td class="source">  var parentFile = args[0],</td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source">    breaker = true,</td></tr><tr><td class="line">23</td><td class="hits"></td><td class="source">    l = parents.length,</td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source">    i = 0,</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source">    parent,</td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source">    block;</td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">28</td><td class="hits">4</td><td class="source">  for (i; i &lt; l; i += 1) {</td></tr><tr class="hit"><td class="line">29</td><td class="hits">5</td><td class="source">    parent = parents[i];</td></tr><tr class="hit"><td class="line">30</td><td class="hits">5</td><td class="source">    if (!parent.blocks || !parent.blocks.hasOwnProperty(blockName)) {</td></tr><tr class="miss"><td class="line">31</td><td class="hits">0</td><td class="source">      continue;</td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source">    // Silly JSLint &quot;Strange Loop&quot; requires return to be in a conditional</td></tr><tr class="hit"><td class="line">34</td><td class="hits">5</td><td class="source">    if (breaker &amp;&amp; parentFile !== parent.name) {</td></tr><tr class="hit"><td class="line">35</td><td class="hits">4</td><td class="source">      block = parent.blocks[blockName];</td></tr><tr class="hit"><td class="line">36</td><td class="hits">4</td><td class="source">      return block.compile(compiler, [blockName], block.content, parents.slice(i + 1), options) + '\n';</td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">38</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">40</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">41</td><td class="hits">1</td><td class="source">exports.parse = function (str, line, parser, types, stack, opts) {</td></tr><tr class="hit"><td class="line">42</td><td class="hits">8</td><td class="source">  parser.on('*', function (token) {</td></tr><tr class="hit"><td class="line">43</td><td class="hits">1</td><td class="source">    throw new Error('Unexpected argument &quot;' + token.match + '&quot; on line ' + line + '.');</td></tr><tr><td class="line">44</td><td class="hits"></td><td class="source">  });</td></tr><tr><td class="line">45</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">46</td><td class="hits">8</td><td class="source">  parser.on('end', function () {</td></tr><tr class="hit"><td class="line">47</td><td class="hits">7</td><td class="source">    this.out.push(opts.filename);</td></tr><tr><td class="line">48</td><td class="hits"></td><td class="source">  });</td></tr><tr><td class="line">49</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">50</td><td class="hits">8</td><td class="source">  return true;</td></tr><tr><td class="line">51</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">52</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="/lib/tags/raw.js">/lib/tags/raw.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">7</div><div class="hits">7</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source">// Magic tag, hardcoded into parser</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * Forces the content to not be auto-escaped. All swig instructions will be ignored and the content will be rendered exactly as it was given.</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> * @alias raw</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source"> * @example</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * // foobar = '&lt;p&gt;'</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> * {% raw %}{{ foobar }}{% endraw %}</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> * // =&gt; {{ foobar }}</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">14</td><td class="hits">1</td><td class="source">exports.compile = function (compiler, args, content, parents, options, blockName) {</td></tr><tr class="hit"><td class="line">15</td><td class="hits">4</td><td class="source">  return compiler(content, parents, options, blockName);</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source">};</td></tr><tr class="hit"><td class="line">17</td><td class="hits">1</td><td class="source">exports.parse = function (str, line, parser) {</td></tr><tr class="hit"><td class="line">18</td><td class="hits">5</td><td class="source">  parser.on('*', function (token) {</td></tr><tr class="hit"><td class="line">19</td><td class="hits">1</td><td class="source">    throw new Error('Unexpected token &quot;' + token.match + '&quot; in raw tag on line ' + line + '.');</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source">  });</td></tr><tr class="hit"><td class="line">21</td><td class="hits">5</td><td class="source">  return true;</td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source">};</td></tr><tr class="hit"><td class="line">23</td><td class="hits">1</td><td class="source">exports.ends = true;</td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="/lib/tags/set.js">/lib/tags/set.js</h2><div id="stats" class="high"><div class="percentage">97%</div><div class="sloc">41</div><div class="hits">40</div><div class="misses">1</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> * Set a variable for re-use in the current context. This will over-write any value already set to the context for the given &lt;var&gt;varname&lt;/var&gt;.</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * @alias set</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> * @example</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> * {% set foo = &quot;anything!&quot; %}</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source"> * {{ foo }}</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * // =&gt; anything!</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> * @example</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source"> * // index = 2;</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source"> * {% set bar = 1 %}</td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source"> * {% set bar += index|default(3) %}</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source"> * // =&gt; 3</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source"> * @example</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source"> * // foods = {};</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source"> * // food = 'chili';</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> * {% set foods[food] = &quot;con queso&quot; %}</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source"> * {{ foods.chili }}</td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source"> * // =&gt; con queso</td></tr><tr><td class="line">23</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source"> * @example</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source"> * // foods = { chili: 'chili con queso' }</td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source"> * {% set foods.chili = &quot;guatamalan insanity pepper&quot; %}</td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source"> * {{ foods.chili }}</td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source"> * // =&gt; guatamalan insanity pepper</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source"> * @param {literal} varname   The variable name to assign the value to.</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source"> * @param {literal} assignement   Any valid JavaScript assignement. &lt;code data-language=&quot;js&quot;&gt;=, +=, *=, /=, -=&lt;/code&gt;</td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source"> * @param {*}   value     Valid variable output.</td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">34</td><td class="hits">1</td><td class="source">exports.compile = function (compiler, args) {</td></tr><tr class="hit"><td class="line">35</td><td class="hits">41</td><td class="source">  return args.join(' ') + ';\n';</td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">38</td><td class="hits">1</td><td class="source">exports.parse = function (str, line, parser, types) {</td></tr><tr class="hit"><td class="line">39</td><td class="hits">43</td><td class="source">  var nameSet = '',</td></tr><tr><td class="line">40</td><td class="hits"></td><td class="source">    propertyName;</td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">42</td><td class="hits">43</td><td class="source">  parser.on(types.VAR, function (token) {</td></tr><tr class="hit"><td class="line">43</td><td class="hits">50</td><td class="source">    if (propertyName) {</td></tr><tr><td class="line">44</td><td class="hits"></td><td class="source">      // Tell the parser where to find the variable</td></tr><tr class="hit"><td class="line">45</td><td class="hits">1</td><td class="source">      propertyName += '_ctx.' + token.match;</td></tr><tr class="hit"><td class="line">46</td><td class="hits">1</td><td class="source">      return;</td></tr><tr><td class="line">47</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">48</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">49</td><td class="hits">49</td><td class="source">    if (!parser.out.length) {</td></tr><tr class="hit"><td class="line">50</td><td class="hits">42</td><td class="source">      nameSet += token.match;</td></tr><tr class="hit"><td class="line">51</td><td class="hits">42</td><td class="source">      return;</td></tr><tr><td class="line">52</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">53</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">54</td><td class="hits">7</td><td class="source">    return true;</td></tr><tr><td class="line">55</td><td class="hits"></td><td class="source">  });</td></tr><tr><td class="line">56</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">57</td><td class="hits">43</td><td class="source">  parser.on(types.BRACKETOPEN, function (token) {</td></tr><tr class="hit"><td class="line">58</td><td class="hits">9</td><td class="source">    if (!propertyName &amp;&amp; !this.out.length) {</td></tr><tr class="hit"><td class="line">59</td><td class="hits">8</td><td class="source">      propertyName = token.match;</td></tr><tr class="hit"><td class="line">60</td><td class="hits">8</td><td class="source">      return;</td></tr><tr><td class="line">61</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">62</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">63</td><td class="hits">1</td><td class="source">    return true;</td></tr><tr><td class="line">64</td><td class="hits"></td><td class="source">  });</td></tr><tr><td class="line">65</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">66</td><td class="hits">43</td><td class="source">  parser.on(types.STRING, function (token) {</td></tr><tr class="hit"><td class="line">67</td><td class="hits">34</td><td class="source">    if (propertyName &amp;&amp; !this.out.length) {</td></tr><tr class="hit"><td class="line">68</td><td class="hits">7</td><td class="source">      propertyName += token.match;</td></tr><tr class="hit"><td class="line">69</td><td class="hits">7</td><td class="source">      return;</td></tr><tr><td class="line">70</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">71</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">72</td><td class="hits">27</td><td class="source">    return true;</td></tr><tr><td class="line">73</td><td class="hits"></td><td class="source">  });</td></tr><tr><td class="line">74</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">75</td><td class="hits">43</td><td class="source">  parser.on(types.BRACKETCLOSE, function (token) {</td></tr><tr class="hit"><td class="line">76</td><td class="hits">9</td><td class="source">    if (propertyName &amp;&amp; !this.out.length) {</td></tr><tr class="hit"><td class="line">77</td><td class="hits">8</td><td class="source">      nameSet += propertyName + token.match;</td></tr><tr class="hit"><td class="line">78</td><td class="hits">8</td><td class="source">      propertyName = undefined;</td></tr><tr class="hit"><td class="line">79</td><td class="hits">8</td><td class="source">      return;</td></tr><tr><td class="line">80</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">81</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">82</td><td class="hits">1</td><td class="source">    return true;</td></tr><tr><td class="line">83</td><td class="hits"></td><td class="source">  });</td></tr><tr><td class="line">84</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">85</td><td class="hits">43</td><td class="source">  parser.on(types.DOTKEY, function (token) {</td></tr><tr class="hit"><td class="line">86</td><td class="hits">1</td><td class="source">    if (!propertyName &amp;&amp; !nameSet) {</td></tr><tr class="miss"><td class="line">87</td><td class="hits">0</td><td class="source">      return true;</td></tr><tr><td class="line">88</td><td class="hits"></td><td class="source">    }</td></tr><tr class="hit"><td class="line">89</td><td class="hits">1</td><td class="source">    nameSet += '.' + token.match;</td></tr><tr class="hit"><td class="line">90</td><td class="hits">1</td><td class="source">    return;</td></tr><tr><td class="line">91</td><td class="hits"></td><td class="source">  });</td></tr><tr><td class="line">92</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">93</td><td class="hits">43</td><td class="source">  parser.on(types.ASSIGNMENT, function (token) {</td></tr><tr class="hit"><td class="line">94</td><td class="hits">44</td><td class="source">    if (this.out.length || !nameSet) {</td></tr><tr class="hit"><td class="line">95</td><td class="hits">2</td><td class="source">      throw new Error('Unexpected assignment &quot;' + token.match + '&quot; on line ' + line + '.');</td></tr><tr><td class="line">96</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">97</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">98</td><td class="hits">42</td><td class="source">    this.out.push(</td></tr><tr><td class="line">99</td><td class="hits"></td><td class="source">      // Prevent the set from spilling into global scope</td></tr><tr><td class="line">100</td><td class="hits"></td><td class="source">      '_ctx.' + nameSet</td></tr><tr><td class="line">101</td><td class="hits"></td><td class="source">    );</td></tr><tr class="hit"><td class="line">102</td><td class="hits">42</td><td class="source">    this.out.push(token.match);</td></tr><tr class="hit"><td class="line">103</td><td class="hits">42</td><td class="source">    this.filterApplyIdx.push(this.out.length);</td></tr><tr><td class="line">104</td><td class="hits"></td><td class="source">  });</td></tr><tr><td class="line">105</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">106</td><td class="hits">43</td><td class="source">  return true;</td></tr><tr><td class="line">107</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">108</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">109</td><td class="hits">1</td><td class="source">exports.block = true;</td></tr><tr><td class="line">110</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="/lib/tags/spaceless.js">/lib/tags/spaceless.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">14</div><div class="hits">14</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr class="hit"><td class="line">1</td><td class="hits">1</td><td class="source">var utils = require('../utils');</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * Attempts to remove whitespace between HTML tags. Use at your own risk.</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> * @alias spaceless</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source"> * @example</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * {% spaceless %}</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> *   {% for num in foo %}</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> *   &lt;li&gt;{{ loop.index }}&lt;/li&gt;</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source"> *   {% endfor %}</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source"> * {% endspaceless %}</td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source"> * // =&gt; &lt;li&gt;1&lt;/li&gt;&lt;li&gt;2&lt;/li&gt;&lt;li&gt;3&lt;/li&gt;</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">17</td><td class="hits">1</td><td class="source">exports.compile = function (compiler, args, content, parents, options, blockName) {</td></tr><tr class="hit"><td class="line">18</td><td class="hits">5</td><td class="source">  function stripWhitespace(tokens) {</td></tr><tr class="hit"><td class="line">19</td><td class="hits">10</td><td class="source">    return utils.map(tokens, function (token) {</td></tr><tr class="hit"><td class="line">20</td><td class="hits">9</td><td class="source">      if (token.content || typeof token !== 'string') {</td></tr><tr class="hit"><td class="line">21</td><td class="hits">5</td><td class="source">        token.content = stripWhitespace(token.content);</td></tr><tr class="hit"><td class="line">22</td><td class="hits">5</td><td class="source">        return token;</td></tr><tr><td class="line">23</td><td class="hits"></td><td class="source">      }</td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">25</td><td class="hits">4</td><td class="source">      return token.replace(/^\s+/, '')</td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source">        .replace(/&gt;\s+&lt;/g, '&gt;&lt;')</td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source">        .replace(/\s+$/, '');</td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">31</td><td class="hits">5</td><td class="source">  return compiler(stripWhitespace(content), parents, options, blockName);</td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">34</td><td class="hits">1</td><td class="source">exports.parse = function (str, line, parser) {</td></tr><tr class="hit"><td class="line">35</td><td class="hits">6</td><td class="source">  parser.on('*', function (token) {</td></tr><tr class="hit"><td class="line">36</td><td class="hits">1</td><td class="source">    throw new Error('Unexpected token &quot;' + token.match + '&quot; on line ' + line + '.');</td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source">  });</td></tr><tr><td class="line">38</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">39</td><td class="hits">6</td><td class="source">  return true;</td></tr><tr><td class="line">40</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">42</td><td class="hits">1</td><td class="source">exports.ends = true;</td></tr><tr><td class="line">43</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="/lib/utils.js">/lib/utils.js</h2><div id="stats" class="high"><div class="percentage">83%</div><div class="sloc">65</div><div class="hits">54</div><div class="misses">11</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr class="hit"><td class="line">1</td><td class="hits">1</td><td class="source">var isArray;</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * Strip leading and trailing whitespace from a string.</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * @param  {string} input</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> * @return {string}       Stripped input.</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">8</td><td class="hits">1</td><td class="source">exports.strip = function (input) {</td></tr><tr class="hit"><td class="line">9</td><td class="hits">664</td><td class="source">  return input.replace(/^\s+|\s+$/g, '');</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source"> * Test if a string starts with a given prefix.</td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source"> * @param  {string} str    String to test against.</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source"> * @param  {string} prefix Prefix to check for.</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source"> * @return {boolean}</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">18</td><td class="hits">1</td><td class="source">exports.startsWith = function (str, prefix) {</td></tr><tr class="hit"><td class="line">19</td><td class="hits">2888</td><td class="source">  return str.indexOf(prefix) === 0;</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">23</td><td class="hits"></td><td class="source"> * Test if a string ends with a given suffix.</td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source"> * @param  {string} str    String to test against.</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source"> * @param  {string} suffix Suffix to check for.</td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source"> * @return {boolean}</td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">28</td><td class="hits">1</td><td class="source">exports.endsWith = function (str, suffix) {</td></tr><tr class="hit"><td class="line">29</td><td class="hits">1199</td><td class="source">  return str.indexOf(suffix, str.length - suffix.length) !== -1;</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source"> * Iterate over an array or object.</td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source"> * @param  {array|object} obj Enumerable object.</td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source"> * @param  {Function}     fn  Callback function executed for each item.</td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source"> * @return {array|object}     The original input object.</td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">38</td><td class="hits">1</td><td class="source">exports.each = function (obj, fn) {</td></tr><tr class="hit"><td class="line">39</td><td class="hits">4931</td><td class="source">  var i, l;</td></tr><tr><td class="line">40</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">41</td><td class="hits">4931</td><td class="source">  if (isArray(obj)) {</td></tr><tr class="hit"><td class="line">42</td><td class="hits">4873</td><td class="source">    i = 0;</td></tr><tr class="hit"><td class="line">43</td><td class="hits">4873</td><td class="source">    l = obj.length;</td></tr><tr class="hit"><td class="line">44</td><td class="hits">4873</td><td class="source">    for (i; i &lt; l; i += 1) {</td></tr><tr class="hit"><td class="line">45</td><td class="hits">12431</td><td class="source">      if (fn(obj[i], i, obj) === false) {</td></tr><tr class="miss"><td class="line">46</td><td class="hits">0</td><td class="source">        break;</td></tr><tr><td class="line">47</td><td class="hits"></td><td class="source">      }</td></tr><tr><td class="line">48</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">49</td><td class="hits"></td><td class="source">  } else {</td></tr><tr class="hit"><td class="line">50</td><td class="hits">58</td><td class="source">    for (i in obj) {</td></tr><tr class="hit"><td class="line">51</td><td class="hits">139</td><td class="source">      if (obj.hasOwnProperty(i)) {</td></tr><tr class="hit"><td class="line">52</td><td class="hits">139</td><td class="source">        if (fn(obj[i], i, obj) === false) {</td></tr><tr class="miss"><td class="line">53</td><td class="hits">0</td><td class="source">          break;</td></tr><tr><td class="line">54</td><td class="hits"></td><td class="source">        }</td></tr><tr><td class="line">55</td><td class="hits"></td><td class="source">      }</td></tr><tr><td class="line">56</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">57</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">58</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">59</td><td class="hits">4786</td><td class="source">  return obj;</td></tr><tr><td class="line">60</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">61</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">62</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">63</td><td class="hits"></td><td class="source"> * Test if an object is an Array.</td></tr><tr><td class="line">64</td><td class="hits"></td><td class="source"> * @param {object} obj</td></tr><tr><td class="line">65</td><td class="hits"></td><td class="source"> * @return {boolean}</td></tr><tr><td class="line">66</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">67</td><td class="hits">1</td><td class="source">exports.isArray = isArray = (Array.hasOwnProperty('isArray')) ? Array.isArray : function (obj) {</td></tr><tr class="miss"><td class="line">68</td><td class="hits">0</td><td class="source">  return (obj) ? (typeof obj === 'object' &amp;&amp; Object.prototype.toString.call(obj).indexOf() !== -1) : false;</td></tr><tr><td class="line">69</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">70</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">71</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">72</td><td class="hits"></td><td class="source"> * Test if an item in an enumerable matches your conditions.</td></tr><tr><td class="line">73</td><td class="hits"></td><td class="source"> * @param  {array|object}   obj   Enumerable object.</td></tr><tr><td class="line">74</td><td class="hits"></td><td class="source"> * @param  {Function}       fn    Executed for each item. Return true if your condition is met.</td></tr><tr><td class="line">75</td><td class="hits"></td><td class="source"> * @return {boolean}</td></tr><tr><td class="line">76</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">77</td><td class="hits">1</td><td class="source">exports.some = function (obj, fn) {</td></tr><tr class="hit"><td class="line">78</td><td class="hits">21778</td><td class="source">  var i = 0,</td></tr><tr><td class="line">79</td><td class="hits"></td><td class="source">    result,</td></tr><tr><td class="line">80</td><td class="hits"></td><td class="source">    l;</td></tr><tr class="hit"><td class="line">81</td><td class="hits">21778</td><td class="source">  if (isArray(obj)) {</td></tr><tr class="hit"><td class="line">82</td><td class="hits">21778</td><td class="source">    l = obj.length;</td></tr><tr><td class="line">83</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">84</td><td class="hits">21778</td><td class="source">    for (i; i &lt; l; i += 1) {</td></tr><tr class="hit"><td class="line">85</td><td class="hits">47214</td><td class="source">      result = fn(obj[i], i, obj);</td></tr><tr class="hit"><td class="line">86</td><td class="hits">47214</td><td class="source">      if (result) {</td></tr><tr class="hit"><td class="line">87</td><td class="hits">4150</td><td class="source">        break;</td></tr><tr><td class="line">88</td><td class="hits"></td><td class="source">      }</td></tr><tr><td class="line">89</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">90</td><td class="hits"></td><td class="source">  } else {</td></tr><tr class="miss"><td class="line">91</td><td class="hits">0</td><td class="source">    exports.each(obj, function (value, index) {</td></tr><tr class="miss"><td class="line">92</td><td class="hits">0</td><td class="source">      result = fn(value, index, obj);</td></tr><tr class="miss"><td class="line">93</td><td class="hits">0</td><td class="source">      return !(result);</td></tr><tr><td class="line">94</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">95</td><td class="hits"></td><td class="source">  }</td></tr><tr class="hit"><td class="line">96</td><td class="hits">21778</td><td class="source">  return !!result;</td></tr><tr><td class="line">97</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">98</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">99</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">100</td><td class="hits"></td><td class="source"> * Return a new enumerable, mapped by a given iteration function.</td></tr><tr><td class="line">101</td><td class="hits"></td><td class="source"> * @param  {object}   obj Enumerable object.</td></tr><tr><td class="line">102</td><td class="hits"></td><td class="source"> * @param  {Function} fn  Executed for each item. Return the item to replace the original item with.</td></tr><tr><td class="line">103</td><td class="hits"></td><td class="source"> * @return {object}       New mapped object.</td></tr><tr><td class="line">104</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">105</td><td class="hits">1</td><td class="source">exports.map = function (obj, fn) {</td></tr><tr class="hit"><td class="line">106</td><td class="hits">87</td><td class="source">  var i = 0,</td></tr><tr><td class="line">107</td><td class="hits"></td><td class="source">    result = [],</td></tr><tr><td class="line">108</td><td class="hits"></td><td class="source">    l;</td></tr><tr><td class="line">109</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">110</td><td class="hits">87</td><td class="source">  if (isArray(obj)) {</td></tr><tr class="hit"><td class="line">111</td><td class="hits">86</td><td class="source">    l = obj.length;</td></tr><tr class="hit"><td class="line">112</td><td class="hits">86</td><td class="source">    for (i; i &lt; l; i += 1) {</td></tr><tr class="hit"><td class="line">113</td><td class="hits">190</td><td class="source">      result[i] = fn(obj[i], i);</td></tr><tr><td class="line">114</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">115</td><td class="hits"></td><td class="source">  } else {</td></tr><tr class="hit"><td class="line">116</td><td class="hits">1</td><td class="source">    for (i in obj) {</td></tr><tr class="miss"><td class="line">117</td><td class="hits">0</td><td class="source">      if (obj.hasOwnProperty(i)) {</td></tr><tr class="miss"><td class="line">118</td><td class="hits">0</td><td class="source">        result[i] = fn(obj[i], i);</td></tr><tr><td class="line">119</td><td class="hits"></td><td class="source">      }</td></tr><tr><td class="line">120</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">121</td><td class="hits"></td><td class="source">  }</td></tr><tr class="hit"><td class="line">122</td><td class="hits">87</td><td class="source">  return result;</td></tr><tr><td class="line">123</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">124</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">125</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">126</td><td class="hits"></td><td class="source"> * Copy all of the properties in the source objects over to the destination object, and return the destination object. It's in-order, so the last source will override properties of the same name in previous arguments.</td></tr><tr><td class="line">127</td><td class="hits"></td><td class="source"> * @param {...object} arguments</td></tr><tr><td class="line">128</td><td class="hits"></td><td class="source"> * @return {object}</td></tr><tr><td class="line">129</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">130</td><td class="hits">1</td><td class="source">exports.extend = function () {</td></tr><tr class="hit"><td class="line">131</td><td class="hits">6705</td><td class="source">  var args = arguments,</td></tr><tr><td class="line">132</td><td class="hits"></td><td class="source">    target = args[0],</td></tr><tr><td class="line">133</td><td class="hits"></td><td class="source">    objs = (args.length &gt; 1) ? Array.prototype.slice.call(args, 1) : [],</td></tr><tr><td class="line">134</td><td class="hits"></td><td class="source">    i = 0,</td></tr><tr><td class="line">135</td><td class="hits"></td><td class="source">    l = objs.length,</td></tr><tr><td class="line">136</td><td class="hits"></td><td class="source">    key,</td></tr><tr><td class="line">137</td><td class="hits"></td><td class="source">    obj;</td></tr><tr><td class="line">138</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">139</td><td class="hits">6705</td><td class="source">  for (i; i &lt; l; i += 1) {</td></tr><tr class="hit"><td class="line">140</td><td class="hits">7795</td><td class="source">    obj = objs[i] || {};</td></tr><tr class="hit"><td class="line">141</td><td class="hits">7795</td><td class="source">    for (key in obj) {</td></tr><tr class="hit"><td class="line">142</td><td class="hits">14428</td><td class="source">      if (obj.hasOwnProperty(key)) {</td></tr><tr class="hit"><td class="line">143</td><td class="hits">14428</td><td class="source">        target[key] = obj[key];</td></tr><tr><td class="line">144</td><td class="hits"></td><td class="source">      }</td></tr><tr><td class="line">145</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">146</td><td class="hits"></td><td class="source">  }</td></tr><tr class="hit"><td class="line">147</td><td class="hits">6705</td><td class="source">  return target;</td></tr><tr><td class="line">148</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">149</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">150</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">151</td><td class="hits"></td><td class="source"> * Get all of the keys on an object.</td></tr><tr><td class="line">152</td><td class="hits"></td><td class="source"> * @param  {object} obj</td></tr><tr><td class="line">153</td><td class="hits"></td><td class="source"> * @return {array}</td></tr><tr><td class="line">154</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">155</td><td class="hits">1</td><td class="source">exports.keys = function (obj) {</td></tr><tr class="hit"><td class="line">156</td><td class="hits">464</td><td class="source">  if (!obj) {</td></tr><tr class="miss"><td class="line">157</td><td class="hits">0</td><td class="source">    return [];</td></tr><tr><td class="line">158</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">159</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">160</td><td class="hits">464</td><td class="source">  if (Object.keys) {</td></tr><tr class="hit"><td class="line">161</td><td class="hits">464</td><td class="source">    return Object.keys(obj);</td></tr><tr><td class="line">162</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">163</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">164</td><td class="hits">0</td><td class="source">  return exports.map(obj, function (v, k) {</td></tr><tr class="miss"><td class="line">165</td><td class="hits">0</td><td class="source">    return k;</td></tr><tr><td class="line">166</td><td class="hits"></td><td class="source">  });</td></tr><tr><td class="line">167</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">168</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">169</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">170</td><td class="hits"></td><td class="source"> * Throw an error with possible line number and source file.</td></tr><tr><td class="line">171</td><td class="hits"></td><td class="source"> * @param  {string} message Error message</td></tr><tr><td class="line">172</td><td class="hits"></td><td class="source"> * @param  {number} [line]  Line number in template.</td></tr><tr><td class="line">173</td><td class="hits"></td><td class="source"> * @param  {string} [file]  Template file the error occured in.</td></tr><tr><td class="line">174</td><td class="hits"></td><td class="source"> * @throws {Error} No seriously, the point is to throw an error.</td></tr><tr><td class="line">175</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">176</td><td class="hits">1</td><td class="source">exports.throwError = function (message, line, file) {</td></tr><tr class="hit"><td class="line">177</td><td class="hits">46</td><td class="source">  if (line) {</td></tr><tr class="hit"><td class="line">178</td><td class="hits">44</td><td class="source">    message += ' on line ' + line;</td></tr><tr><td class="line">179</td><td class="hits"></td><td class="source">  }</td></tr><tr class="hit"><td class="line">180</td><td class="hits">46</td><td class="source">  if (file) {</td></tr><tr class="hit"><td class="line">181</td><td class="hits">29</td><td class="source">    message += ' in file ' + file;</td></tr><tr><td class="line">182</td><td class="hits"></td><td class="source">  }</td></tr><tr class="hit"><td class="line">183</td><td class="hits">46</td><td class="source">  throw new Error(message + '.');</td></tr><tr><td class="line">184</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">185</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div></div></div></body></html>
